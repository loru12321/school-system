<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <script>
        // âœ… å…œåº•åˆå§‹åŒ– Supabaseï¼Œé˜²æ­¢ sbClient æœªå®šä¹‰
        var sbClient = window.sbClient || null;
        window.SUPABASE_URL = localStorage.getItem('SUPABASE_URL') || "https://okwcciujnfvobbwaydiv.supabase.co";
        window.SUPABASE_KEY = localStorage.getItem('SUPABASE_KEY') || "sb_publishable_NQqut_NdTW2z1_R27rJ8jA_S3fTh2r4";
        window.initSupabase = function() {
            if (window.supabase && !sbClient) {
                sbClient = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_KEY);
                window.sbClient = sbClient;
                console.log("âœ… Supabase è¿æ¥åˆå§‹åŒ–æˆåŠŸ");
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js" crossorigin="anonymous" onload="window.initSupabase()"></script>
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js" crossorigin="anonymous" onerror="this.onerror=null;this.src='https://unpkg.com/lz-string@1.5.0/libs/lz-string.min.js'"></script>
    <!-- ğŸŸ¢ [ä¿®å¤] æ·»åŠ  XLSX åº“æ”¯æŒ Excel å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" crossorigin="anonymous" onerror="this.onerror=null;this.src='https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js'"></script>
    <!-- ğŸŸ¢ [ä¿®å¤] æ·»åŠ  Alpine.jsï¼ˆæ•™å¸ˆå¡ç‰‡ä¾èµ–ï¼‰ -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" crossorigin="anonymous" onerror="this.onerror=null;this.src='https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js'"></script>
    <!-- ğŸŸ¢ [ä¿®å¤] æ·»åŠ  Chart.jsï¼ˆæŠ¥å‘Šå›¾è¡¨ä¾èµ–ï¼‰ -->
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" crossorigin="anonymous" onerror="this.onerror=null;this.src='https://unpkg.com/chart.js@4.4.1/dist/chart.umd.min.js'"></script>
    <!-- ğŸŸ¢ [ä¿®å¤] æ·»åŠ  SweetAlert2ï¼ˆSwal ä¾èµ–ï¼‰ -->
    <script defer src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js" crossorigin="anonymous" onerror="this.onerror=null;this.src='https://unpkg.com/sweetalert2@11/dist/sweetalert2.all.min.js'"></script>
    <!-- ğŸŸ¢ [æ–°å¢] æ·»åŠ  jsPDFï¼ˆPDFå¯¼å‡ºï¼‰ -->
    <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" crossorigin="anonymous" onerror="this.onerror=null;this.src='https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js'"></script>
    <script src="./assets/js/cloud.js"></script>

    <!-- ================== æ ·å¼å®šä¹‰ (CSS) ================== -->


    <!-- ================== Windows 11 Fluent Design UI é‡æ„åŒ… ================== -->
    <style>
        /* 1. å…¨å±€å­—ä½“ä¸èƒŒæ™¯ (Mica æè´¨æ¨¡æ‹Ÿ) */
        body {
            font-family: "Segoe UI Variable", "Segoe UI", "Microsoft YaHei", sans-serif !important;
            background-color: #f0f3f9 !important; /* Win11 æµ…è‰²èƒŒæ™¯ */
            background-image: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,0) 0, hsla(253,16%,7%,0) 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,0) 0, hsla(225,39%,30%,0) 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,0) 0, hsla(339,49%,30%,0) 50%) !important;
            color: #202020 !important;
            -webkit-font-smoothing: antialiased;
        }

        /* 2. å¡ç‰‡ä¸å®¹å™¨ï¼šäºšå…‹åŠ›ç£¨ç ‚ç»ç’ƒæ•ˆæœ */
        .card-box, .section, .nav-wrapper, .modal-content, .spotlight-box, .side-nav, .control-panel {
            background: rgba(255, 255, 255, 0.75) !important; /* åŠé€æ˜ç™½ */
            backdrop-filter: blur(20px) saturate(125%) !important; /* æ ¸å¿ƒï¼šé«˜æ–¯æ¨¡ç³Š */
            border: 1px solid rgba(255, 255, 255, 0.6) !important; /* ç»ç’ƒè¾¹ç¼˜å…‰ */
            box-shadow: 0 4px 24px -1px rgba(0, 0, 0, 0.06) !important; /* å¼¥æ•£é˜´å½± */
            border-radius: 12px !important; /* Win11 æ ‡å‡†åœ†è§’ */
        }

        /* 3. é¡¶éƒ¨ Headerï¼šå»é™¤é‡è‰²ï¼Œæ”¹ä¸ºæ¸…çˆ½é£æ ¼ */
        header {
            background: rgba(255, 255, 255, 0.85) !important;
            backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(255, 255, 255, 0.5) !important;
            box-shadow: 0 2px 12px rgba(0,0,0,0.03) !important;
            color: #333 !important;
            margin-bottom: 20px !important;
        }
        /* å¼ºåˆ¶æ ‡é¢˜æ–‡å­—é¢œè‰²å˜æ·±ï¼Œé€‚åº”æµ…è‰²èƒŒæ™¯ */
        header h1, header p, header .btn {
            color: #1a1a1a !important;
            text-shadow: none !important;
        }
        header .btn {
            background: rgba(255,255,255,0.5) !important;
            border: 1px solid rgba(0,0,0,0.1) !important;
        }
        header .btn:hover {
            background: white !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
        }

        /* 4. æŒ‰é’®ï¼šæ‰å¹³åŒ– + å¾®åŠ¨æ•ˆ */
        .btn {
            border-radius: 6px !important; /* Win11 æŒ‰é’®åœ†è§’ */
            border: 1px solid transparent !important;
            font-weight: 600 !important;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05) !important;
        }
        .btn:active {
            transform: scale(0.96) !important; /* ç‚¹å‡»ç¼©æ”¾ */
            opacity: 0.8;
        }
        /* ä¸»è‰²æŒ‰é’® */
        .btn-primary, button[onclick*="login"] {
            background-color: #0067c0 !important; /* Win11 é»˜è®¤è“ */
            color: white !important;
        }
        .btn:not(.btn-primary):not(.btn-danger):not(.btn-success):not(.btn-purple):not(.btn-orange) {
            background-color: #ffffff !important;
            border: 1px solid #d1d5db !important;
            color: #333 !important;
        }
        .btn:not(.btn-primary):not(.btn-danger):hover {
            background-color: #f3f4f6 !important;
        }

        /* 5. è¾“å…¥æ¡†ï¼šåº•éƒ¨é«˜äº®çº¿é£æ ¼ */
        input[type="text"], input[type="number"], input[type="password"], select, textarea {
            background-color: rgba(255,255,255,0.6) !important;
            border: 1px solid #d1d5db !important;
            border-bottom: 2px solid #d1d5db !important; /* åº•éƒ¨åŠ ç²— */
            border-radius: 6px !important;
            transition: all 0.2s !important;
            color: #333 !important;
        }
        input:focus, select:focus, textarea:focus {
            background-color: #fff !important;
            border-color: #d1d5db !important;
            border-bottom-color: #0067c0 !important; /* èšç„¦å˜è“ */
            box-shadow: none !important;
        }

        /* 6. è¡¨æ ¼ï¼šæç®€é£ï¼Œå»ç«–çº¿ */
        table {
            border-collapse: separate !important;
            border-spacing: 0 !important;
        }
        thead th {
            background: transparent !important;
            <!DOCTYPE html>
            <html lang="zh-CN">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width,initial-scale=1.0">
                <title>å°é¢å¢™</title>
                <style>
                    html, body {
                        margin: 0;
                        padding: 0;
                        background: #fff;
                        font-family: 'Inter', 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;
                    }
                    .nav-header {
                        width: 100vw;
                        background: #fff;
                        box-shadow: 0 2px 12px #e9e4e1cc;
                        position: sticky;
                        top: 0; left: 0;
                        z-index: 100;
                        min-height: 62px;
                    }
                    .nav-inner {
                        max-width: 1400px;
                        margin: 0 auto;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        height: 62px;
                        padding: 0 32px;
                    }
                    .nav-left .logo {
                        font-size: 1.7rem;
                        font-weight: 700;
                        color: #b48c5a;
                        letter-spacing: 0.08em;
                        display: flex;
                        align-items: center;
                    }
                    .logo-icon {
                        font-size: 1.5rem;
                        margin-right: 0.3em;
                    }
                    .nav-menu {
                        display: flex;
                        align-items: center;
                        gap: 1.2rem;
                        flex: 1 1 auto;
                        margin: 0 2vw;
                    }
                    .nav-link {
                        color: #6d5c4d;
                        text-decoration: none;
                        font-size: 1.08rem;
                        padding: 0.2em 0.7em;
                        border-radius: 0.3em;
                        transition: background 0.15s, color 0.15s;
                        position: relative;
                    }
                    .nav-link:hover, .nav-link:focus {
                        background: #f7f2ed;
                        color: #b48c5a;
                    }
                    .nav-dropdown {
                        position: relative;
                        display: inline-block;
                    }
                    .nav-dropdown-toggle::after {
                        content: '';
                        display: inline-block;
                        margin-left: 0.2em;
                    }
                    .nav-dropdown-menu {
                        display: none;
                        position: absolute;
                        left: 0;
                        top: 2.1em;
                        min-width: 8em;
                        background: #fff;
                        border-radius: 0.5em;
                        box-shadow: 0 4px 24px #e9e4e1cc;
                        border: 1px solid #f2e7d7;
                        padding: 0.5em 0;
                        z-index: 10;
                    }
                    .nav-dropdown:hover .nav-dropdown-menu {
                        display: block;
                    }
                    .nav-dropdown-item {
                        display: block;
                        color: #6d5c4d;
                        text-decoration: none;
                        padding: 0.5em 1.5em;
                        font-size: 1.05rem;
                        transition: background 0.15s, color 0.15s;
                    }
                    .nav-dropdown-item:hover {
                        background: #f7f2ed;
                        color: #b48c5a;
                    }
                    .nav-right {
                        display: flex;
                        align-items: center;
                        gap: 0.7em;
                    }
                    .nav-btn {
                        background: none;
                        border: none;
                        color: #6d5c4d;
                        font-size: 1.08rem;
                        padding: 0.2em 0.8em;
                        border-radius: 0.3em;
                        cursor: pointer;
                        transition: background 0.15s, color 0.15s;
                    }
                    .nav-btn:hover, .nav-btn:focus {
                        background: #f7f2ed;
                        color: #b48c5a;
                    }
                    .vip-badge {
                        background: #f7e3b2;
                        color: #b48c5a;
                        font-weight: bold;
                        font-size: 1.02rem;
                        border-radius: 0.3em;
                        padding: 0.2em 0.7em;
                        margin: 0 0.2em;
                        letter-spacing: 0.05em;
                    }
                    .nav-support {
                        background: #f7e3b2;
                        color: #b48c5a;
                        font-weight: bold;
                        margin-left: 0.5em;
                    }
                    @media (max-width: 900px) {
                        .nav-inner { padding: 0 10px; }
                        .nav-menu { gap: 0.5rem; margin: 0 0.5vw; }
                        .nav-left .logo { font-size: 1.1rem; }
                        .nav-btn, .vip-badge { font-size: 0.95rem; padding: 0.2em 0.5em; }
                    }
                    @media (max-width: 600px) {
                        .nav-inner { flex-wrap: wrap; height: auto; padding: 0 2vw; }
                        .nav-menu { flex-wrap: wrap; gap: 0.2rem; }
                        .nav-left .logo { font-size: 1rem; }
                        .nav-btn, .vip-badge { font-size: 0.85rem; padding: 0.15em 0.4em; }
                    }
                    .masonry {
                        column-count: 5;
                        column-gap: 12px;
                        max-width: 1400px;
                        margin: 0 auto;
                        padding: 24px 0 32px 0;
                    }
                    @media (max-width: 1200px) { .masonry { column-count: 4; } }
                    @media (max-width: 900px)  { .masonry { column-count: 3; } }
                    @media (max-width: 600px)  { .masonry { column-count: 2; } }
                    @media (max-width: 400px)  { .masonry { column-count: 1; } }
                    .masonry-item {
                        break-inside: avoid;
                        margin-bottom: 12px;
                        position: relative;
                        cursor: pointer;
                        overflow: hidden;
                        border-radius: 0;
                        box-shadow: none;
                        background: none;
                        transition: transform 0.18s cubic-bezier(.4,1.6,.6,1), filter 0.18s;
                    }
                    .masonry-item img {
                        width: 100%;
                        display: block;
                        border-radius: 0;
                        box-shadow: none;
                        background: #f3f3f3;
                        transition: filter 0.18s, transform 0.18s;
                        filter: brightness(0.98) contrast(1.08);
                        min-height: 120px;
                        aspect-ratio: 2/3;
                        object-fit: cover;
                        will-change: filter, transform;
                        opacity: 0;
                        animation: fadein 0.7s cubic-bezier(.4,1.6,.6,1) forwards;
                    }
                    .masonry-item:hover img {
                        filter: brightness(1.08) contrast(1.15) saturate(1.1);
                        transform: scale(1.035);
                        z-index: 2;
                    }
                    @keyframes fadein {
                        to { opacity: 1; }
                    }
                    /* å¼¹çª—é¢„è§ˆ */
                    .modal {
                        display: none;
                        position: fixed;
                        z-index: 99;
                        left: 0; top: 0; width: 100vw; height: 100vh;
                        background: rgba(0,0,0,0.82);
                        align-items: center;
                        justify-content: center;
                        animation: modalIn 0.2s;
                    }
                    .modal.active { display: flex; }
                    .modal-img {
                        max-width: 92vw;
                        max-height: 92vh;
                        border-radius: 0.5rem;
                        box-shadow: 0 8px 40px #0008;
                        background: #fff;
                        animation: imgIn 0.2s;
                    }
                    @keyframes modalIn { from { opacity: 0; } to { opacity: 1; } }
                    @keyframes imgIn { from { transform: scale(0.95); opacity: 0.5; } to { transform: scale(1); opacity: 1; } }
                    .modal-close {
                        position: absolute;
                        top: 2.5vh; right: 3vw;
                        font-size: 2.2rem;
                        color: #fff;
                        background: none;
                        border: none;
                        cursor: pointer;
                        z-index: 100;
                        opacity: 0.7;
                        transition: opacity 0.15s;
                    }
                    .modal-close:hover { opacity: 1; }
                </style>
            </head>
            <body>
                <header class="nav-header">
                    <div class="nav-inner">
                        <div class="nav-left">
                            <span class="logo"><span class="logo-icon">ğŸ¬</span>é†ç”µå½±</span>
                        </div>
                        <nav class="nav-menu">
                            <a href="#" class="nav-link">ç­–å±•ä¸“é¢˜</a>
                            <a href="#" class="nav-link">ä¼šå‘˜é™å®š</a>
                            <a href="#" class="nav-link">ç”µå½±</a>
                            <a href="#" class="nav-link">å½±é›†</a>
                            <div class="nav-dropdown">
                                <span class="nav-link nav-dropdown-toggle">äººç‰© â–¾</span>
                                <div class="nav-dropdown-menu">
                                    <a href="#" class="nav-dropdown-item">ç”µå½±ç‰‡å•</a>
                                    <a href="#" class="nav-dropdown-item">ç§ä¿¡å¯¹å†™</a>
                                    <a href="#" class="nav-dropdown-item">è‰ºæœ¯è¯„è®º</a>
                                    <a href="#" class="nav-dropdown-item">ä¹¦ç±è¯„è®º</a>
                                    <a href="#" class="nav-dropdown-item">å½±å±•ç‰¹æŠ¥</a>
                                    <a href="#" class="nav-dropdown-item">äº§ä¸šåŠ¨æ€</a>
                                </div>
                            </div>
                            <a href="#" class="nav-link">ç‰¹ç¨¿</a>
                            <a href="#" class="nav-link">ç¼–è¾‘å®¤</a>
                            <a href="#" class="nav-link">ä½œè€…ç¾¤</a>
                            <a href="#" class="nav-link">é†é€‰å“</a>
                            <a href="#" class="nav-link">é†æ´»åŠ¨</a>
                        </nav>
                        <div class="nav-right">
                            <button class="nav-btn" title="æœç´¢">ğŸ”</button>
                            <button class="nav-btn" title="ç™»å½•">ç™»å½•</button>
                            <span class="vip-badge">VIP</span>
                            <button class="nav-btn nav-support">æ”¯æŒæ–¹æ¡ˆ</button>
                        </div>
                    </div>
                </header>
                <div class="masonry" id="masonry"></div>
                <div class="modal" id="modal">
                    <button class="modal-close" id="modalClose" title="å…³é—­">Ã—</button>
                    <img class="modal-img" id="modalImg" src="" alt="cover preview">
                </div>
                <script>
                    // ä¼˜åŒ–ï¼šå›¾ç‰‡æ‡’åŠ è½½ã€å“åº”å¼ã€å¼¹çª—é¢„è§ˆ
                    const covers = [
                        { src: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80', h: 320 },
                        { src: 'https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=400&q=80', h: 260 },
                        { src: 'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=400&q=80', h: 400 },
                        { src: 'https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=400&q=80', h: 280 },
                        { src: 'https://images.unsplash.com/photo-1465101178521-c1a9136a3b99?auto=format&fit=crop&w=400&q=80', h: 350 },
                        { src: 'https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=400&q=80', h: 220 },
                        { src: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80', h: 370 },
                        { src: 'https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=400&q=80', h: 310 },
                        { src: 'https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=400&q=80', h: 260 },
                        { src: 'https://images.unsplash.com/photo-1465101178521-c1a9136a3b99?auto=format&fit=crop&w=400&q=80', h: 340 },
                        { src: 'https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=400&q=80', h: 210 },
                        { src: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=400&q=80', h: 390 }
                    ];
                    const masonry = document.getElementById('masonry');
                    covers.forEach((c, i) => {
                        const item = document.createElement('div');
                        item.className = 'masonry-item';
                        const img = document.createElement('img');
                        img.src = c.src;
                        img.alt = 'cover';
                        img.loading = 'lazy';
                        img.style.height = (c.h + Math.floor(Math.random()*40-20)) + 'px';
                        item.appendChild(img);
                        item.addEventListener('click', () => showModal(c.src));
                        masonry.appendChild(item);
                    });
                    // å¼¹çª—é¢„è§ˆ
                    const modal = document.getElementById('modal');
                    const modalImg = document.getElementById('modalImg');
                    const modalClose = document.getElementById('modalClose');
                    function showModal(src) {
                        modalImg.src = src;
                        modal.classList.add('active');
                    }
                    modalClose.onclick = () => modal.classList.remove('active');
                    modal.onclick = e => { if (e.target === modal) modal.classList.remove('active'); };
                    document.addEventListener('keydown', e => { if (e.key === 'Escape') modal.classList.remove('active'); });
                </script>
            </body>
            </html>
        color: #e0e0e0 !important;
    }

    /* 2. æ ¸å¿ƒå®¹å™¨å˜é»‘ (å¡ç‰‡ã€å¤´éƒ¨ã€å¯¼èˆªã€å¼¹çª—ã€ä¾§è¾¹æ ) */
    body.dark-mode .card-box, 
    body.dark-mode .section, 
    body.dark-mode .nav-wrapper, 
    body.dark-mode .modal-content, 
    body.dark-mode .spotlight-box,
    body.dark-mode .side-nav, 
    body.dark-mode .control-panel,
    body.dark-mode .upload-box,
    body.dark-mode header,
    body.dark-mode .teacher-card,  /* æ•™å¸ˆå¡ç‰‡ */
    body.dark-mode .mob-card,      /* æ‰‹æœºç«¯å¡ç‰‡ */
    body.dark-mode .sub-header     /* å°æ ‡é¢˜æ  */
    {
        background: rgba(30, 30, 30, 0.85) !important; /* æ·±ç°è‰²èƒŒæ™¯ */
        backdrop-filter: blur(20px) !important;
        border: 1px solid rgba(255, 255, 255, 0.08) !important; /* æç»†çš„äº®è¾¹ */
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6) !important; /* æ·±è‰²é˜´å½± */
        color: #e0e0e0 !important;
    }

    /* 3. å¼ºåˆ¶æ–‡å­—åç™½ */
    body.dark-mode h1, body.dark-mode h2, body.dark-mode h3, body.dark-mode h4,
    body.dark-mode p, body.dark-mode span, body.dark-mode label, 
    body.dark-mode div, body.dark-mode strong, body.dark-mode b,
    body.dark-mode .nav-cat-item, 
    body.dark-mode .side-nav-link {
        color: #e0e0e0 !important;
    }
    /* å¼±åŒ–æ¬¡è¦æ–‡å­— */
    body.dark-mode .text-gray, body.dark-mode small, body.dark-mode .nav-link {
        color: #a0a0a0 !important;
    }

    /* 4. è¾“å…¥æ¡†ã€ä¸‹æ‹‰æ¡†ï¼šæ·±ç°åº•ç™½å­— */
    body.dark-mode input, 
    body.dark-mode select, 
    body.dark-mode textarea {
        background-color: rgba(0, 0, 0, 0.4) !important;
        border: 1px solid rgba(255, 255, 255, 0.15) !important;
        color: #fff !important;
    }
    body.dark-mode input:focus, body.dark-mode select:focus {
        border-color: #3b82f6 !important; /* èšç„¦æ—¶äº®è“è¾¹ */
        background-color: rgba(0, 0, 0, 0.6) !important;
    }

    /* 5. æŒ‰é’®ï¼šå¾®è°ƒ */
    body.dark-mode .btn:not(.btn-primary):not(.btn-danger):not(.btn-success) {
        background-color: rgba(255, 255, 255, 0.1) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
        color: #fff !important;
    }

    /* 6. è¡¨æ ¼ç‰¹æ®Šå¤„ç† */
    body.dark-mode thead th {
        background-color: rgba(45, 45, 45, 0.9) !important; /* è¡¨å¤´ç¨äº® */
        color: #ccc !important;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
    }
    body.dark-mode td {
        border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
        color: #e0e0e0 !important;
    }
    /* å†»ç»“åˆ—èƒŒæ™¯å¿…é¡»å˜é»‘ï¼Œå¦åˆ™æ»šåŠ¨æ—¶ä¼šé€å‡ºæ–‡å­— */
    body.dark-mode table th:first-child, 
    body.dark-mode table td:first-child {
        background: #1e1e1e !important;
        border-right: 1px solid rgba(255,255,255,0.1) !important;
    }
    /* é¼ æ ‡æ‚¬åœè¡Œé«˜äº® */
    body.dark-mode tbody tr:hover td {
        background-color: rgba(255, 255, 255, 0.08) !important;
    }

    /* 7. å¯¼èˆªæ æ¿€æ´»çŠ¶æ€ */
    body.dark-mode .nav-cat-item.active,
    body.dark-mode .nav-link.active,
    body.dark-mode .side-nav-link.active {
        background-color: #3b82f6 !important; /* äº®è“è‰² */
        color: white !important;
        box-shadow: 0 0 15px rgba(59, 130, 246, 0.4) !important; /* å‘å…‰æ•ˆæœ */
    }
    
    /* 8. å»é™¤ç™½è‰²èƒŒæ™¯çš„è¡¥ä¸ */
    body.dark-mode .bg-gray-50, 
    body.dark-mode .bg-white {
        background-color: transparent !important;
    }

    /* ================== 3. å­—ä½“å±‚çº§ä¸é—´è·ä¼˜åŒ– (Typography & Spacing) ================== */
    
    /* A. å¢åŠ è¡¨æ ¼èˆ’é€‚åº¦ (Loose Display) */
    td, th {
        padding: 14px 12px !important; /* å¢åŠ ä¸Šä¸‹å†…è¾¹è·ï¼Œè®©æ•°æ®ä¸æ‹¥æŒ¤ */
        font-size: 13px !important;    /* ç¨å¾®è°ƒå°å­—å·ï¼Œæ˜¾å¾—æ›´ç²¾è‡´ */
    }

    /* B. å¼ºè°ƒæ•°å­—åˆ—å­—ä½“ (Tabular Nums) */
    /* ä»ç¬¬3åˆ—å¼€å§‹é€šå¸¸æ˜¯æ•°å­—ï¼Œä½¿ç”¨ç­‰å®½å­—ä½“å¯¹é½æ›´æ•´é½ */
    td:nth-child(n+3) {
        font-family: "Cascadia Code", "Consolas", "Roboto Mono", "Menlo", monospace !important;
        letter-spacing: -0.5px; /* æ•°å­—ç¨å¾®ç´§å‡‘ä¸€ç‚¹ */
        font-feature-settings: "tnum"; /* å¼€å¯ç­‰å®½æ•°å­—ç‰¹æ€§ */
    }

    /* C. æ¨¡å—æ ‡é¢˜å¢åŠ å‘¼å¸æ„Ÿ */
    .sec-head {
        margin-bottom: 25px !important;
        padding-bottom: 15px !important;
        border-bottom-width: 1px !important; /* ç»†çº¿æ›´ç°ä»£ */
    }

    /* D. ä¼˜åŒ–å¡ç‰‡å†…é—´è· */
    .card-box, .section {
        padding: 25px !important; /* åŠ å¤§å¡ç‰‡å†…è¾¹è· */
    }
    
    /* E. ä¼˜åŒ–ç»Ÿè®¡æ•°å­—å­—é‡ */
    .stat-value, .fb-val, .total-val {
        font-weight: 700 !important;
        letter-spacing: -1px !important; /* å¤§æ•°å­—ç´§å‡‘æ›´å…·å¼ åŠ› */
    }

    /* ================== 4. éª¨æ¶å±åŠ è½½æ•ˆæœ (Skeleton Loading) ================== */
    
    /* A. å®šä¹‰å¾®å…‰æµä½“åŠ¨ç”» (Shimmer Animation) */
    @keyframes skeleton-shimmer {
        0% { background-position: 100% 50%; }
        100% { background-position: 0 50%; }
    }

    /* B. è¡¨æ ¼åŠ è½½æ€å®¹å™¨ */
    /* å½“ç»™ table æˆ– div åŠ ä¸Š class="loading-mask" æ—¶è§¦å‘ */
    .loading-mask {
        position: relative;
        pointer-events: none; /* ç¦æ­¢ç‚¹å‡» */
        min-height: 200px;
    }

    /* C. è¦†ç›–åœ¨å†…å®¹ä¸Šçš„éª¨æ¶å±‚ */
    .loading-mask::after {
        content: "";
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        z-index: 10;
        /* æµ…è‰²æ¨¡å¼ä¸‹çš„éª¨æ¶èƒŒæ™¯ï¼šç°ç™½ç›¸é—´æµå…‰ */
        background: linear-gradient(
            90deg,
            rgba(255, 255, 255, 0) 0%,
            rgba(255, 255, 255, 0.8) 20%,
            rgba(240, 240, 240, 0.9) 50%,
            rgba(255, 255, 255, 0.8) 80%,
            rgba(255, 255, 255, 0) 100%
        );
        background-size: 200% 100%;
        animation: skeleton-shimmer 1.5s infinite linear;
        backdrop-filter: blur(2px); /* è½»å¾®æ¨¡ç³Šåº•å±‚æ–‡å­— */
        border-radius: 8px;
    }

    /* D. é’ˆå¯¹è¡¨æ ¼è¡Œçš„æ¡çº¹éª¨æ¶ (æ›´é€¼çœŸ) */
    /* è‡ªåŠ¨åŒ¹é…ç©ºè¡¨æ ¼æˆ–åŠ è½½ä¸­çš„è¡¨æ ¼ */
    .loading-mask tbody tr td {
        position: relative;
        color: transparent !important; /* éšè—çœŸå®æ–‡å­— */
    }
    .loading-mask tbody tr td::before {
        content: "";
        position: absolute;
        top: 12px; bottom: 12px; left: 10px; right: 10px;
        background: #e2e8f0;
        border-radius: 4px;
        /* éª¨æ¶æ¡çš„å¾®å…‰æ•ˆæœ */
        background-image: linear-gradient(
            90deg, 
            rgba(255,255,255, 0) 0, 
            rgba(255,255,255, 0.5) 20%, 
            rgba(255,255,255, 0.8) 60%, 
            rgba(255,255,255, 0) 
        );
        background-size: 200% 100%;
        animation: skeleton-shimmer 2s infinite linear;
    }

    /* E. æ·±è‰²æ¨¡å¼é€‚é… (Dark Mode Skeleton) */
    body.dark-mode .loading-mask::after {
        /* æ·±è‰²æ¨¡å¼ä¸‹çš„æµå…‰ï¼šæ·±ç°åˆ°é»‘ */
        background: linear-gradient(
            90deg,
            rgba(30, 30, 30, 0) 0%,
            rgba(50, 50, 50, 0.5) 50%,
            rgba(30, 30, 30, 0) 100%
        );
    }
    body.dark-mode .loading-mask tbody tr td::before {
        background: #2d2d2d; /* æ·±è‰²éª¨æ¶æ¡åº•è‰² */
        background-image: linear-gradient(
            90deg, 
            rgba(255,255,255, 0) 0, 
            rgba(255,255,255, 0.05) 50%, 
            rgba(255,255,255, 0) 
        );
    }
    /* ================== 5. ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªè´¨æ„Ÿå¢å¼º (Mobile Glassmorphism) ================== */
    @media screen and (max-width: 768px) {
        .mob-bottom-nav {
            background: rgba(255, 255, 255, 0.85) !important; /* é«˜é€ç™½ */
            backdrop-filter: blur(20px) saturate(180%) !important; /* iOS é£æ ¼æ¯›ç»ç’ƒ */
            -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
            border-top: 1px solid rgba(0,0,0,0.05) !important;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05) !important;
            /* é€‚é…å…¨é¢å±åº•éƒ¨æ¨ªæ¡ (Safe Area) */
            padding-bottom: max(10px, env(safe-area-inset-bottom)) !important; 
            height: auto !important;
            min-height: 65px;
            z-index: 99999 !important; /* ç¡®ä¿æœ€é¡¶å±‚ */
        }

        .mob-nav-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0.6;
            padding-top: 8px;
        }

        .mob-nav-item.active {
            color: #0067c0 !important;
            opacity: 1;
            transform: translateY(-2px); /* é€‰ä¸­å¾®æµ®åŠ¨ */
        }

        /* é€‰ä¸­æ—¶å›¾æ ‡åŠ ä¸ªèƒ¶å›Šå¾®å…‰èƒŒæ™¯ */
        .mob-nav-item.active i {
            background: rgba(0, 103, 192, 0.1);
            border-radius: 16px;
            padding: 6px 20px;
            margin-bottom: 2px;
            transition: 0.3s;
        }

        /* --- æ·±è‰²æ¨¡å¼é€‚é… (Dark Mode Mobile Nav) --- */
        body.dark-mode .mob-bottom-nav {
            background: rgba(30, 30, 30, 0.85) !important;
            border-top-color: rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5) !important;
        }
        
        body.dark-mode .mob-nav-item {
            color: #a0a0a0 !important;
        }

        body.dark-mode .mob-nav-item.active {
            color: #3b82f6 !important;
        }
        
        body.dark-mode .mob-nav-item.active i {
            background: rgba(59, 130, 246, 0.25);
            color: #ffffff !important;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.2);
        }
    }
    </style>
  <link rel="stylesheet" crossorigin href="./assets/index-D5LhYVn5.css">
</head>
<body>

    <!-- å…¨å±€åŠ è½½é®ç½© -->
    <div id="global-loader" class="hidden">
        <div class="loader-spinner"></div>
        <div class="loader-text" id="loader-text">ç³»ç»Ÿæ­£åœ¨å¤„ç†æ•°æ®ï¼Œè¯·ç¨å€™...</div>
    </div>

    <!-- âœ‹ ğŸ”´ [å·²ç§»é™¤]ï¼šåˆ é™¤äº† mobile-lite-interface æ•´ä¸ªå®¹å™¨ï¼Œæ‰‹æœºè®¿é—®å°†ç›´æ¥æ˜¾ç¤ºä¸‹æ–¹çš„ä¸»ç•Œé¢ ğŸ”´ -->

    <div id="login-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#f3f4f6; z-index:50000; display:flex; align-items:center; justify-content:center; background-image: radial-gradient(#e5e7eb 1px, transparent 1px); background-size: 20px 20px;">
        <div style="background:white; padding:40px; border-radius:16px; box-shadow:0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); width:100%; max-width:420px; border:1px solid #e5e7eb;">
            <div style="text-align:center; margin-bottom:30px;">
                <h1 style="color:var(--primary); font-size:24px; font-weight:800; margin-bottom:5px;">æ™ºæ…§æ•™åŠ¡ç®¡ç†ç³»ç»Ÿ</h1>
                <p style="color:#64748b; font-size:14px;">ç»Ÿä¸€èº«ä»½è®¤è¯å…¥å£</p>
            </div>

            <!-- ç™»å½•è¡¨å• -->
            <div id="login-form">
                
                <!-- 1. ç”¨æˆ·åè¾“å…¥æ¡† -->
                <div class="form-group">
                    <label style="display:block; font-size:12px; font-weight:bold; color:#475569; margin-bottom:5px;">
                        è´¦å· / å§“å
                    </label>
                    <input type="text" id="login-user" placeholder="ç®¡ç†å‘˜è´¦å· / æ•™å¸ˆå§“å / å­¦ç”Ÿå§“å" 
                           style="width:100%; padding:10px; border:1px solid #cbd5e1; border-radius:6px; outline:none;"
                           onkeydown="if(event.key==='Enter') Auth.login()">
                </div>

                <!-- 2. ç­çº§è¾“å…¥æ¡† (æ”¹ä¸ºå§‹ç»ˆæ˜¾ç¤ºï¼Œä½†åœ¨ JS é‡Œåˆ¤æ–­é€»è¾‘) -->
                <div class="form-group" style="margin-top:15px;">
                    <label style="display:block; font-size:12px; font-weight:bold; color:#475569; margin-bottom:5px;">
                        ç­çº§ <span style="color:#f59e0b; font-weight:normal; font-size:11px;">(æ•™èŒå·¥ç•™ç©ºï¼Œå®¶é•¿å¿…å¡«å¦‚:701)</span>
                    </label>
                    <input type="text" id="login-class" placeholder="è¯·è¾“å…¥ç­çº§ (ä»…å®¶é•¿/å­¦ç”Ÿå¿…å¡«)" 
                           style="width:100%; padding:10px; border:1px solid #cbd5e1; border-radius:6px; outline:none;"
                           onkeydown="if(event.key==='Enter') Auth.login()">
                </div>

                <!-- 3. å¯†ç è¾“å…¥æ¡† -->
                <div class="form-group" style="margin-top:15px;">
                    <label style="display:block; font-size:12px; font-weight:bold; color:#475569; margin-bottom:5px;">å¯†ç </label>
                    <input type="password" id="login-pass" placeholder="è¾“å…¥å¯†ç " 
                           style="width:100%; padding:10px; border:1px solid #cbd5e1; border-radius:6px; outline:none;"
                           onkeydown="if(event.key==='Enter') window.Auth?.login()">
                </div>

                <button onclick="window.Auth?.login()" style="width:100%; background:var(--primary); color:white; border:none; padding:12px; border-radius:6px; font-size:16px; font-weight:bold; margin-top:25px; cursor:pointer; transition:0.2s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                    ç«‹å³ç™»å½•
                </button>
                
                <!-- å·²æ·»åŠ  display:none éšè—é»˜è®¤æç¤º -->
                <div style="display:none; text-align:center; margin-top:15px; font-size:12px; color:#94a3b8; line-height: 1.6;">
                    ç®¡ç†å‘˜é»˜è®¤: admin / admin123<br>
                    å…¶ä»–è§’è‰²é»˜è®¤å¯†ç : 123456
                </div>
            </div>
        </div>

        <!-- çºµå‘æˆé•¿æ¡£æ¡ˆ (Cohort Growth) -->
        <div id="cohort-growth" class="section card-box">
            <div class="module-desc-bar" style="border-color: var(--color-diag)">
                <h3><i class="ti ti-timeline"></i> çºµå‘æˆé•¿æ¡£æ¡ˆ <span class="badge" style="background:#0ea5e9;">ğŸ“ˆ ç­ä¸»ä»»å¿…çœ‹</span></h3>
                <p><strong>ä¸€å¥è¯ç›®çš„ï¼š</strong>åŸºäºå±Šåˆ«IDæ„å»ºå­¦ç”Ÿæˆé•¿æ›²çº¿ä¸ç¨³å®šæ€§ç”»åƒã€‚</p>
                <p><strong>æ¨èé¡ºåºï¼š</strong>å®Œæˆå¤šæ¬¡è€ƒè¯•å¯¼å…¥åä½¿ç”¨ã€‚</p>
            </div>
            <div class="sec-head">
                <h2><i class="ti ti-timeline"></i> æˆé•¿è½¨è¿¹ä¸ç¨³å®šæ€§åˆ†æ</h2>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-purple" onclick="CohortGrowth.render()">ğŸ” ç”Ÿæˆæˆé•¿æ¡£æ¡ˆ</button>
                    <button class="btn btn-gray" onclick="CohortGrowth.exportVolatility()">ğŸ“¥ å¯¼å‡ºæ³¢åŠ¨åå•</button>
                </div>
            </div>
            <div class="info-bar">
                <span>åŸºäºå±Šåˆ«å†å²è€ƒè¯•ï¼Œè®¡ç®— $Z$ åˆ†æ•°æ³¢åŠ¨ç‡ã€æ’åç™¾åˆ†ä½å˜åŒ–ã€‚</span>
                <span style="margin-left:auto; font-size:12px;">å»ºè®®è‡³å°‘ 4 æ¬¡è€ƒè¯•æ•°æ®</span>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <div class="card-box" style="border-left:4px solid #38bdf8; background:#f0f9ff;">
                    <div class="sub-header">ğŸŒŠ Z-Score æ³¢åŠ¨ç‡ (ç¨³å®šæ€§)</div>
                    <div class="table-wrap">
                        <table id="cohort-volatility-table">
                            <thead><tr><th>å§“å</th><th>ç­çº§</th><th>è€ƒè¯•æ¬¡æ•°</th><th>æ³¢åŠ¨ç‡(Ïƒ)</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="card-box" style="border-left:4px solid #22c55e; background:#f0fdf4;">
                    <div class="sub-header">ğŸš€ æ’åç™¾åˆ†ä½æˆé•¿ (é¦–å°¾å¯¹æ¯”)</div>
                    <div class="table-wrap">
                        <table id="cohort-growth-table">
                            <thead><tr><th>å§“å</th><th>ç­çº§</th><th>èµ·å§‹ç™¾åˆ†ä½</th><th>æœ€æ–°ç™¾åˆ†ä½</th><th>å˜åŒ–</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¶ˆæ¯æç¤ºå®¹å™¨ -->
    <div id="toast-container" class="toast-container"></div>

    <!-- å±Šåˆ«å…¥å£å¼¹çª— -->
    <div id="mode-mask">
        <div class="mode-box">
            <h2 style="color:var(--primary); margin-bottom:15px; font-size:24px;">ğŸ“‚ è¿›å…¥å±Šåˆ«æ¡£æ¡ˆ</h2>
            <p style="color:#64748b;">ä»¥â€œå…¥å­¦å¹´ä»½â€ä¸ºä¸»çº¿å»ºç«‹å®Œæ•´æˆé•¿å‘¨æœŸï¼Œç³»ç»Ÿå°†è‡ªåŠ¨åŒ¹é…å¹´çº§ä¸æ ¸ç®—æ¨¡å¼</p>
            <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
                <input id="entry-cohort-year" type="number" min="2000" max="2100" placeholder="å…¥å­¦å¹´ä»½ (å¦‚ 2022)" style="padding:8px 10px; border:1px solid #cbd5e1; border-radius:6px; width:200px;">
                <button class="btn btn-primary" onclick="enterCohortFromMask()">è¿›å…¥å±Šåˆ«</button>
            </div>
            <div style="margin-top:10px; font-size:12px; color:#64748b;">å·²æœ‰å±Šåˆ«å¯åœ¨é¡¶éƒ¨ä¸‹æ‹‰ç›´æ¥åˆ‡æ¢</div>
        </div>
    </div>

    <!-- æ‰‹æœºç«¯ç®¡ç†ä¸»ç•Œé¢ (é»˜è®¤éšè—ï¼Œé€šè¿‡ JS æ¿€æ´») -->
    <div id="mobile-manager-app">
        <!-- 1. é¡¶éƒ¨æ ‡é¢˜æ  -->
        <div class="mob-header-bar">
            <div class="mob-header-title" id="mob-page-title">ğŸ“± æ•™åŠ¡å·¥ä½œå°</div>
            <div onclick="Auth.logout()" style="color:#ef4444; font-size:12px; font-weight:bold; cursor: pointer;">é€€å‡º</div>
        </div>

        <!-- 2. å†…å®¹åŒºåŸŸ (é€šè¿‡ JS åˆ‡æ¢æ˜¾ç¤º) -->
        
        <!-- A. é¦–é¡µ/æ¦‚è§ˆ -->
        <div id="mob-view-home" class="mob-view active">
            <div style="background: linear-gradient(135deg, #4f46e5, #818cf8); border-radius: 12px; padding: 20px; color: white; margin-bottom: 20px; text-align: center;">
                <div style="font-size: 12px; opacity: 0.8;">å½“å‰ç™»å½•</div>
                <div style="font-size: 24px; font-weight: bold; margin: 5px 0;" id="mob-user-name">è€å¸ˆ</div>
                <div style="font-size: 12px; background: rgba(255,255,255,0.2); display: inline-block; padding: 2px 10px; border-radius: 20px;" id="mob-user-role">ç§‘ä»»æ•™å¸ˆ</div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                <div class="mob-list-item" style="flex-direction: column; align-items: center; text-align: center; padding: 15px;" onclick="MobMgr.switchTab('students')">
                    <div class="mob-avatar" style="background: #dbeafe; color: #2563eb;"><i class="ti ti-users"></i></div>
                    <div style="font-weight: bold; margin-top: 5px;">å­¦ç”Ÿç®¡ç†</div>
                </div>
                <div class="mob-list-item" style="flex-direction: column; align-items: center; text-align: center; padding: 15px;" onclick="MobMgr.switchTab('analysis')">
                    <div class="mob-avatar" style="background: #fef3c7; color: #d97706;"><i class="ti ti-chart-bar"></i></div>
                    <div style="font-weight: bold; margin-top: 5px;">æˆç»©åˆ†æ</div>
                </div>
            </div>
            
            <div style="background: white; border-radius: 12px; padding: 15px;">
                <h4 style="margin-bottom: 10px; color: #334155;">ğŸ“¢ ç³»ç»Ÿå…¬å‘Š</h4>
                <div style="font-size: 12px; color: #64748b; line-height: 1.6;">
                    æ¬¢è¿ä½¿ç”¨ç§»åŠ¨ç«¯ç®¡ç†ç³»ç»Ÿã€‚ç›®å‰æ”¯æŒæŸ¥çœ‹å­¦ç”Ÿåå•ã€å¿«é€ŸæŸ¥è¯¢æˆç»©ä»¥åŠåŸºç¡€çš„æ•°æ®åˆ†æåŠŸèƒ½ã€‚æ›´å¤šé«˜çº§åŠŸèƒ½è¯·ç™»å½• PC ç«¯æ“ä½œã€‚
                </div>
            </div>
        </div>

        <!-- B. å­¦ç”Ÿåˆ—è¡¨ -->
        <div id="mob-view-students" class="mob-view">
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <input type="text" id="mob-search-input" placeholder="ğŸ” æœå§“å/è€ƒå·..." style="flex: 1; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px;" oninput="MobMgr.renderStudentList()">
            </div>
            <div id="mob-student-list" class="mob-list-container" style="padding: 0;">
                <!-- åŠ¨æ€ç”Ÿæˆåˆ—è¡¨ -->
                <div style="text-align: center; color: #999; padding: 20px;">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- C. ç®€æŠ¥åˆ†æ -->
        <div id="mob-view-analysis" class="mob-view">
            <div class="mob-list-item" style="display: block; padding: 15px;">
                <h3 style="margin-bottom: 15px; border-left: 4px solid #4f46e5; padding-left: 8px; font-size: 16px;">ğŸ“Š å¿«é€Ÿæ¦‚è§ˆ</h3>
                <div id="mob-analysis-content">
                    <p style="color: #999; text-align: center;">è¯·å…ˆåœ¨ PC ç«¯ä¸Šä¼ å¹¶å¤„ç†æ•°æ®...</p>
                </div>
            </div>
        </div>

        <!-- 3. åº•éƒ¨å¯¼èˆªæ  -->
        <div class="mob-bottom-bar">
            <button class="mob-nav-btn active" onclick="MobMgr.switchTab('home')">
                <i class="ti ti-home"></i>
                <span>é¦–é¡µ</span>
            </button>
            <button class="mob-nav-btn" onclick="MobMgr.switchTab('students')">
                <i class="ti ti-users"></i>
                <span>å­¦ç”Ÿ</span>
            </button>
            <button class="mob-nav-btn" onclick="MobMgr.switchTab('analysis')">
                <i class="ti ti-chart-pie"></i>
                <span>åˆ†æ</span>
            </button>
        </div>
    </div>


    <!-- ä¸»åº”ç”¨ç•Œé¢ -->
    <div id="watermark-layer" aria-hidden="true"></div>
    <div class="container hidden" id="app">
        <header id="main-header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <!-- Logo å®¹å™¨ (é»˜è®¤éšè—ï¼Œä¸Šä¼ åæ˜¾ç¤º) -->
                <img id="custom-logo-img" src="" loading="lazy" decoding="async" style="display:none; height: 60px; width: auto; border-radius: 6px; background: rgba(255,255,255,0.95); padding: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);" alt="æ ¡å¾½">
                
                <!-- æ ‡é¢˜æ–‡å­—åŒºåŸŸ -->
                <div style="flex: 1;">
                    <h1 id="app-title" style="margin:0; font-size:24px; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">ä¹¡é•‡å­¦æ ¡æˆç»©åˆ†æä¸æ•™åŠ¡ç®¡ç†ç³»ç»Ÿ <span id="mode-badge" class="badge"></span></h1>
                    <p id="app-subtitle" style="margin:5px 0 0 0; opacity: 0.9; font-size: 13px;">é›†æˆï¼šä¹¡é•‡å­¦æ ¡æ¨ªå‘å¯¹æ¯” Â· æ•™å¸ˆæ•™å­¦æ·±åº¦åˆ†æ Â· åç§‘æŒ–æ˜ Â· è€ƒåŠ¡ç¼–æ’</p>
                </div>

                <!-- å³ä¸Šè§’å·¥å…·æ  -->
                <div style="display:flex; gap:10px; align-items:center;">
                    <span id="role-hint" style="font-size:12px; color:#fff; background:rgba(0,0,0,0.15); padding:4px 8px; border-radius:999px; border:1px solid rgba(255,255,255,0.25);">è§’è‰²: æœªç™»å½•</span>
                    <select id="cohort-selector" onchange="CohortManager.switchTo(this.value)" 
                            style="background:rgba(255,255,255,0.2); color:white; border:1px solid rgba(255,255,255,0.5); padding:5px; border-radius:4px; font-size:14px; font-weight:bold; cursor:pointer; outline:none;">
                        <option value="" style="color:#333">ğŸ“‚ è¯·é€‰æ‹©å±Šåˆ«</option>
                    </select>
                    <button class="btn" style="background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.4); color:white;" onclick="scrollToAnchor('upload', this)" title="å‰å¾€å±Šåˆ«ç®¡ç†">
                        <i class="ti ti-users-group"></i> å±Šåˆ«
                    </button>
                    <div id="admin-msg-btn" class="notification-btn" style="display:none;" onclick="IssueManager.openAdminPanel()">
                        <button class="btn" style="background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.4); color:white;" title="æŸ¥çœ‹ç”³è¯‰åé¦ˆ">
                            <i class="ti ti-bell"></i>
                        </button>
                        <div id="msg-badge" class="notification-badge hidden">0</div>
                    </div>
                    <!-- æ³¨æ„ï¼šæ­¤æŒ‰é’®é»˜è®¤é€šè¿‡ CSS #admin-panel-btn {display:none} éšè—ï¼Œåªæœ‰ body[data-role="admin"] æ—¶æ‰æ˜¾ç¤º -->
                    <button class="btn" id="admin-panel-btn" onclick="document.getElementById('admin-modal').style.display='flex'" 
                            style="background:#b91c1c; color:white; border:1px solid rgba(255,255,255,0.4); display:none;">
                        <i class="ti ti-settings"></i> è´¦å·ç®¡ç†
                    </button>
                    <button class="btn" id="btn-cloud-rollback" onclick="openCloudRollback()" title="ç®¡ç†å‘˜ä¸“ç”¨ï¼šæ‰“å¼€äº‘ç«¯å¿«ç…§å›æ»š" style="background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.4); color:white; display:none;">
                        <i class="ti ti-rotate"></i> äº‘ç«¯å›æ»š
                    </button>
                    <button class="btn" style="background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.4); backdrop-filter:blur(5px); color:white;" onclick="HelpSystem.startTour()" title="æ–°æ‰‹å¼•å¯¼">
                        <i class="ti ti-help-circle"></i> æ•™ç¨‹
                    </button>
                    <!-- [æ–°å¢] å¤–è§‚è®¾ç½®æŒ‰é’® -->
                    <button class="btn" style="background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.4); backdrop-filter:blur(5px); color:white;" onclick="openSkinModal()" title="è‡ªå®šä¹‰å¤–è§‚">
                        <i class="ti ti-palette"></i> å¤–è§‚è®¾ç½®
                    </button>
                    
                    <!-- æ·±è‰²æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
                    <button class="btn" style="background:rgba(255,255,255,0.15); border:1px solid rgba(255,255,255,0.2); padding: 6px 10px;" onclick="toggleDarkMode()" title="åˆ‡æ¢æ·±è‰²æ¨¡å¼">
                        <i class="ti ti-moon"></i>
                    </button>
                    <!-- å…¨å±€æœç´¢æç¤ºæŒ‰é’® -->
                    <div style="color:rgba(255,255,255,0.9); font-size:12px; border:1px solid rgba(255,255,255,0.3); padding:6px 12px; border-radius:6px; cursor:pointer; background: rgba(0,0,0,0.1);" onclick="openSpotlight()">
                        <i class="ti ti-search"></i> æœç´¢
                    </div>
                                        
                    <button class="btn" id="btn-guest-mode" onclick="toggleGuestMode()" style="background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.4); color:white; font-size:12px; padding:5px 10px; margin-left:5px;" title="ä¸ä¿å­˜ä»»ä½•æ•°æ®ï¼Œå…³é—­å³æ¶ˆå¤±">
                        <i class="ti ti-flame"></i> é˜…åå³ç„š
                    </button>
                </div>
            </div>
        </header>

        <!-- åŒå±‚é¡¶éƒ¨å¯¼èˆªèœå• -->
        <div class="nav-wrapper">
            <div class="nav-categories" id="navCategories"></div>
            <div class="nav-sub-items" id="navSubItems"></div>
        </div>

        <!-- 0. æ–°æ•™å¸ˆä¸Šæ‰‹å…¥å£ -->
        <div id="starter-hub" class="section active card-box">
            <div class="module-desc-bar" style="border-color: var(--color-data)">
                <h3><i class="ti ti-rocket"></i> 00 æ–°æ•™å¸ˆä¸Šæ‰‹å…¥å£ <span class="badge" style="background:#0ea5e9;">æ–°æ‰‹å¿…çœ‹</span>
                    <span class="module-help-btn" onclick="showModuleHelp('starter-hub')">ğŸ“˜ æ¨¡å‹è¯´æ˜</span>
                </h3>
                <p><strong>ä¸€å¥è¯ç›®çš„ï¼š</strong>ç”¨æœ€çŸ­è·¯å¾„å®Œæˆâ€œé€‰å­¦æœŸ â†’ å¯¼å…¥æ•°æ® â†’ ä»»è¯¾è¡¨ â†’ æ•™å¸ˆç”»åƒâ€çš„é—­ç¯ã€‚</p>
                <p><strong>æ¨èé¡ºåºï¼š</strong>å¼•å¯¼å‘å¯¼ â†’ å¯¼å…¥æˆç»© â†’ ä»»è¯¾åŒæ­¥ â†’ æ•™å¸ˆç”»åƒã€‚</p>
            </div>

            <div class="starter-grid">
                <div class="starter-card">
                    <h4><i class="ti ti-activity"></i> æ•°æ®çŠ¶æ€é¢æ¿</h4>
                    <div id="starter-status-panel" class="status-grid"></div>
                    <div style="margin-top:10px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                        <span style="font-size:12px; color:#475569;">æœ¬æ ¡ï¼š</span>
                        <select id="mySchoolSelect" style="padding:6px 8px; border:1px solid #cbd5e1; border-radius:6px; min-width:160px;"></select>
                        <button class="btn btn-gray" onclick="autoDetectMySchool()">è‡ªåŠ¨è¯†åˆ«</button>
                    </div>
                </div>
                <div class="starter-card">
                    <h4><i class="ti ti-checklist"></i> ä»»åŠ¡æ¸…å•</h4>
                    <ul id="starter-task-list" class="task-list">
                        <li class="task-item" data-task="term"><span class="dot"></span>é€‰æ‹©å­¦æœŸä¸å±Šåˆ«</li>
                        <li class="task-item" data-task="scores"><span class="dot"></span>å¯¼å…¥æˆç»©æ•°æ®</li>
                        <li class="task-item" data-task="teacher"><span class="dot"></span>å¯¼å…¥ä»»è¯¾è¡¨å¹¶åŒæ­¥</li>
                        <li class="task-item" data-task="school"><span class="dot"></span>é€‰æ‹©æœ¬æ ¡</li>
                        <li class="task-item" data-task="analysis"><span class="dot"></span>æŸ¥çœ‹æ•™å¸ˆç”»åƒ</li>
                    </ul>
                    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
                        <button class="btn btn-blue" onclick="openStarterGuide()"><i class="ti ti-compass"></i> å¼•å¯¼å‘å¯¼</button>
                        <button class="btn btn-gray" onclick="loadDemoData()"><i class="ti ti-flask"></i> æ¼”ç¤ºæ•°æ®</button>
                    </div>
                </div>
                <div class="starter-card">
                    <h4><i class="ti ti-link"></i> ç»Ÿä¸€å…¥å£</h4>
                    <div style="display:flex; gap:8px; flex-wrap:wrap;">
                        <button class="btn btn-purple" onclick="switchTab('upload')"><i class="ti ti-file-upload"></i> æ•°æ®å¯¼å…¥</button>
                        <button class="btn btn-orange" onclick="openTeacherSync()"><i class="ti ti-users"></i> æ•™å¸ˆä»»è¯¾</button>
                        <button class="btn btn-green" onclick="switchTab('teacher-analysis')"><i class="ti ti-school"></i> æ•™å¸ˆç”»åƒ</button>
                    </div>
                </div>
                <div class="starter-card">
                    <h4><i class="ti ti-stethoscope"></i> è‡ªåŠ¨è¯Šæ–­</h4>
                    <div id="starter-diagnose-result" style="font-size:12px; color:#64748b;">ç‚¹å‡»æŒ‰é’®å¼€å§‹è¯Šæ–­ã€‚</div>
                    <div style="margin-top:10px;">
                        <button class="btn btn-red" onclick="runAutoDiagnosis()"><i class="ti ti-shield-check"></i> ä¸€é”®è¯Šæ–­</button>
                    </div>
                </div>
                <div class="starter-card">
                    <h4><i class="ti ti-alert-circle"></i> æ•°æ®å¼‚å¸¸ä¸­å¿ƒ</h4>
                    <ul id="starter-issue-list" class="issue-list">
                        <li class="issue-item" style="color:#64748b; background:#f8fafc; border-color:#e2e8f0;">ç‚¹å‡»æ‰«ææŸ¥çœ‹å¼‚å¸¸</li>
                    </ul>
                    <div style="margin-top:10px;">
                        <button class="btn btn-orange" onclick="scanDataIssues()"><i class="ti ti-scan"></i> æ‰«æå¼‚å¸¸</button>
                    </div>
                </div>
                <div class="starter-card">
                    <h4><i class="ti ti-history"></i> æ“ä½œè®°å½•</h4>
                    <ul id="starter-log-list" class="log-list"></ul>
                    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
                        <button class="btn btn-gray" onclick="clearActionLogs()"><i class="ti ti-trash"></i> æ¸…ç©ºè®°å½•</button>
                    </div>
                </div>
                <div class="starter-card">
                    <h4><i class="ti ti-database-export"></i> å¤‡ä»½ä¸æ¢å¤</h4>
                    <div style="font-size:12px; color:#64748b;">å»ºè®®åœ¨åˆ‡æ¢å±Šåˆ«æˆ–å¤§æ‰¹é‡ä¿®æ”¹å‰æ‰‹åŠ¨å¤‡ä»½ã€‚</div>
                    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
                        <button class="btn btn-blue" onclick="manualBackup()"><i class="ti ti-device-floppy"></i> ä¸€é”®å¤‡ä»½</button>
                        <button class="btn btn-gray" onclick="manualRestore()"><i class="ti ti-rotate"></i> ä¸€é”®æ¢å¤</button>
                    </div>
                </div>
                <div class="starter-card">
                    <h4><i class="ti ti-download"></i> æ¨¡æ¿ä¸‹è½½</h4>
                    <div style="display:flex; gap:8px; flex-wrap:wrap;">
                        <button class="btn btn-green" onclick="downloadTemplate('junior')">æˆç»©æ¨¡æ¿(6-8)</button>
                        <button class="btn btn-green" onclick="downloadTemplate('grade9')">æˆç»©æ¨¡æ¿(9å¹´çº§)</button>
                        <button class="btn btn-orange" onclick="downloadTemplate('teacher')">ä»»è¯¾æ¨¡æ¿</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 1. æ•°æ®ä¸Šä¼  & é¡¹ç›®ç®¡ç† -->
        <div id="upload" class="section card-box">
            <div class="module-desc-bar" style="border-color: var(--color-data)">
                <h3><i class="ti ti-database-import"></i> 01 æ•°æ®æ¢çº½ä¸­å¿ƒ <span class="badge" style="background:#16a34a;">â­ æ•™åŠ¡å¸¸ç”¨</span></h3>
                <p><strong>ä¸€å¥è¯ç›®çš„ï¼š</strong>å¯¼å…¥å¹¶è§„èŒƒåŒ–æˆç»©æ•°æ®ï¼Œå»ºç«‹åˆ†æåŸºç¡€ã€‚</p>
                <p><strong>æ¨èé¡ºåºï¼š</strong>ç¬¬1æ­¥ï¼ˆå¯¼å…¥æ•°æ®ï¼‰â†’ ç¬¬2æ­¥ï¼ˆç”Ÿæˆåˆ†æï¼‰â†’ ç¬¬3æ­¥ï¼ˆå¯¼å‡ºç»“æœï¼‰ã€‚</p>
            </div>
            <div class="sec-head">
                <h2>
                    <i class="ti ti-file-upload"></i> æ•°æ®æ–‡ä»¶ä¸Šä¼  
                    <span class="module-help-btn" onclick="showModuleHelp('upload')">ğŸ“˜ ä½¿ç”¨è¯´æ˜</span>
                </h2>
                <div style="margin-left: auto;">
                    <button class="btn btn-orange" onclick="runDataDoctor()">
                        <i class="ti ti-stethoscope"></i> æ•°æ®ä½“æ£€
                    </button>
                </div>
            </div>
            <div class="info-bar"><span>å½“å‰æ¨¡å¼ï¼š<strong id="mode-info"></strong>ã€‚ç³»ç»Ÿå°†è‡ªåŠ¨è¿‡æ»¤æ— å…³æ•°æ®ã€‚</span></div>
            <div class="card-box" style="border-left:4px solid #7c3aed; background:#f5f3ff; margin-top:10px;">
                <div class="sec-head" style="border-bottom-color:#ddd6fe; margin-bottom:10px;">
                    <h2 style="color:#5b21b6;"><i class="ti ti-users-group"></i> å±Šåˆ«ç®¡ç† (Cohort)</h2>
                    <div style="font-size:12px; color:#6b7280;">ä»¥â€œå…¥å­¦å¹´ä»½â€ä¸ºä¸»è½´ï¼Œè´¯ç©¿ä¸‰å¹´æˆé•¿æ¡£æ¡ˆ</div>
                </div>
                <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                    <input id="cohort-year" type="number" min="2000" max="2100" placeholder="å…¥å­¦å¹´ä»½ (å¦‚ 2022)" style="padding:6px 8px; border:1px solid #cbd5e1; border-radius:6px; width:180px;">
                    <button class="btn btn-purple" onclick="CohortManager.addFromUI()">â• æ–°å»ºå±Šåˆ«</button>
                    <button class="btn btn-gray" onclick="resetCohortSelection()">â†© é‡æ–°é€‰æ‹©å±Šåˆ«</button>
                    <span id="cohort-status" style="font-size:12px; color:#64748b;"></span>
                </div>
                <div style="margin-top:8px; font-size:12px; color:#475569;">
                    å½“å‰å±Šåˆ«ï¼š<strong id="cohort-current-label">æœªé€‰æ‹©</strong>
                </div>
            </div>
            <div class="card-box" style="border-left:4px solid #0ea5e9; background:#f0f9ff; margin-top:10px;">
                <div class="sec-head" style="border-bottom-color:#bae6fd; margin-bottom:10px;">
                    <h2 style="color:#0369a1;"><i class="ti ti-archive"></i> è€ƒè¯•æ‰¹æ¬¡ / å­¦æœŸæ¡£æ¡ˆåŒ–</h2>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <span id="exam-archive-status" style="font-size:12px; color:#64748b;">æœªå°å­˜</span>
                    </div>
                </div>
                <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                    <span style="font-size:12px; color:#475569;">å±Šåˆ«ï¼š</span>
                    <span id="exam-cohort-label" style="font-size:12px; font-weight:bold; color:#1e3a8a;">æœªé€‰æ‹©</span>
                    <select id="exam-year" style="padding:6px 8px; border:1px solid #cbd5e1; border-radius:6px;" onchange="refreshExamGradePreview(); onExamTermChange();">
                        <option value="2025-2026">2025-2026</option>
                        <option value="2026-2027">2026-2027</option>
                        <option value="2027-2028">2027-2028</option>
                    </select>
                    <select id="exam-term" style="padding:6px 8px; border:1px solid #cbd5e1; border-radius:6px;" onchange="refreshExamGradePreview(); onExamTermChange();">
                        <option value="ä¸Šå­¦æœŸ">ä¸Šå­¦æœŸ</option>
                        <option value="ä¸‹å­¦æœŸ">ä¸‹å­¦æœŸ</option>
                    </select>
                    <select id="exam-type" style="padding:6px 8px; border:1px solid #cbd5e1; border-radius:6px;">
                        <option value="æœˆè€ƒ">æœˆè€ƒ</option>
                        <option value="æœŸä¸­">æœŸä¸­</option>
                        <option value="æœŸæœ«">æœŸæœ«</option>
                        <option value="æ¨¡æ‹Ÿ">æ¨¡æ‹Ÿ</option>
                    </select>
                    <input id="exam-date" type="date" style="padding:6px 8px; border:1px solid #cbd5e1; border-radius:6px;">
                    <input id="exam-name" type="text" placeholder="è€ƒè¯•åç§°(å¯é€‰)" style="padding:6px 8px; border:1px solid #cbd5e1; border-radius:6px; width:200px;">
                    <label style="display:flex; align-items:center; gap:6px; font-size:12px; color:#475569;">
                        <input type="checkbox" id="exam-reset-point"> æœ¬æ¬¡è€ƒè¯•ç»å†é‡æ–°åˆ†ç­
                    </label>
                    <span style="font-size:12px; color:#475569;">æœ¬æ¬¡å¹´çº§ï¼š</span>
                    <strong id="exam-grade-label" style="font-size:12px; color:#1e3a8a;">-</strong>
                    <button class="btn btn-primary" onclick="setCurrentExamMeta()">è®¾ä¸ºå½“å‰è€ƒè¯•</button>
                    <button class="btn btn-orange" onclick="archiveCurrentExam()">ä¸€é”®å°å­˜æœ¬æ¬¡è€ƒè¯•</button>
                    <button class="btn btn-gray" onclick="unlockArchive()">è§£é™¤å°å­˜</button>
                </div>
                <div style="margin-top:8px; font-size:12px; color:#475569;">
                    å½“å‰è€ƒè¯•IDï¼š<strong id="exam-key-display">æœªè®¾ç½®</strong>
                </div>
                <div style="margin-top:8px; font-size:12px; color:#475569; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                    å†å²è€ƒè¯•ï¼š
                    <select id="exam-history-select" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:6px; min-width:220px;"></select>
                    <button class="btn btn-sm btn-gray" onclick="CohortDB.loadExamFromSelect()">åˆ‡æ¢åˆ°è¯¥è€ƒè¯•</button>
                </div>
                <div id="exam-history-status" style="margin-top:6px; font-size:12px; color:#64748b;">
                    å†å²è€ƒè¯•: 0 æœŸï½œæœ€è¿‘å¿«ç…§: æ— 
                </div>
                <div style="margin-top:6px;">
                    <button class="btn btn-sm btn-gray" onclick="showMultiCompareDataSourceDiag()">å¤šæœŸæ•°æ®æºè¯Šæ–­</button>
                </div>
            </div>
            <div style="background: #f0fdf4; border: 1px dashed #86efac; padding: 10px 15px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                <div style="font-weight: bold; color: #166534; display: flex; align-items: center; gap: 5px;">
                    <i class="ti ti-template"></i> æ–°æ‰‹å¿…è¯»ï¼šæ ‡å‡†æ¨¡æ¿ä¸‹è½½
                </div>
                <div style="flex: 1; display: flex; gap: 8px; flex-wrap: wrap;">
                    <button class="btn btn-sm" style="background: white; color: #166534; border: 1px solid #166534; font-size: 12px;" onclick="downloadTemplate('primary')">
                        <i class="ti ti-download"></i> å°å­¦æœŸæœ«æ¨¡æ¿
                    </button>
                    <button class="btn btn-sm" style="background: white; color: #166534; border: 1px solid #166534; font-size: 12px;" onclick="downloadTemplate('junior')">
                        <i class="ti ti-download"></i> åˆä¸­æœˆè€ƒæ¨¡æ¿ (7-8å¹´çº§)
                    </button>
                    <button class="btn btn-sm" style="background: white; color: #166534; border: 1px solid #166534; font-size: 12px;" onclick="downloadTemplate('grade9')">
                        <i class="ti ti-download"></i> ä¸­è€ƒä¸€æ¨¡æ¨¡æ¿ (9å¹´çº§)
                    </button>
                    <button class="btn btn-sm" style="background: white; color: #0369a1; border: 1px solid #0369a1; font-size: 12px;" onclick="downloadTemplate('teacher')">
                        <i class="ti ti-id"></i> æ•™å¸ˆä»»è¯¾å¯¼å…¥æ¨¡æ¿
                    </button>
                </div>
            </div>
            <div class="upload-box" id="uploadBox" onclick="document.getElementById('fileInput').click()" tabindex="0" role="button" aria-label="ä¸Šä¼ æˆç»©æ–‡ä»¶ï¼ŒæŒ‰å›è½¦é”®å¯æ‰“å¼€æ–‡ä»¶é€‰æ‹©å™¨">
                <div class="upload-icon"><i class="ti ti-cloud-upload"></i></div>
                <p style="font-size:18px; margin-bottom:10px; font-weight:600;">ç‚¹å‡»ä¸Šä¼ æˆç»© Excel æ–‡ä»¶</p>
                <p style="color:#94a3b8;">æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼  (.xlsx, .xls)</p>
                <input type="file" id="fileInput" multiple accept=".xlsx,.xls" hidden>
            </div>
            
            <!-- [æ–°å¢] å±Šåˆ«å¿«ç…§ç®¡ç†åŒºåŸŸ -->
            <div class="control-panel" style="background: #eff6ff; border-color: #bfdbfe; margin-top: 15px;">
                <div style="flex: 1;">
                    <h3 style="margin: 0 0 5px 0; color: var(--primary); font-size: 15px;">
                        ğŸ’¾ å±Šåˆ«çŠ¶æ€ç®¡ç† <span id="auto-backup-status" style="font-size:11px; color:#64748b; font-weight:normal; margin-left:10px;"></span>
                    </h3>
                    <p style="font-size: 12px; color: #64748b; margin: 0;">ä¿å­˜å½“å‰å±Šåˆ«æ‰€æœ‰è¿›åº¦ï¼ˆå«æˆç»©ã€æ•™å¸ˆè®¾ç½®ã€æ’åº§ã€åˆ†ç­ç»“æœï¼‰ï¼Œä¸‹æ¬¡å¯ç›´æ¥æ¢å¤ã€‚</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" id="btn-save-project" onclick="saveProjectSnapshot()">
                        <i class="ti ti-download"></i> ä¿å­˜é¡¹ç›® (.json)
                    </button>
                    <button class="btn btn-orange" id="btn-load-project" onclick="document.getElementById('projectFileInput').click()">
                        <i class="ti ti-upload"></i> æ¢å¤é¡¹ç›®
                    </button>
                    <input type="file" id="projectFileInput" accept=".json" hidden onchange="loadProjectSnapshot(this)">
                    <button class="btn btn-danger" id="btn-reset-system" onclick="resetSystem()" style="background: #dc2626; color: white;">
                        <i class="ti ti-trash"></i> æ¸…ç©ºé‡ç½®
                    </button>
                </div>
            </div>

            <div class="control-panel" id="auto-snapshot-panel" style="background:#fff7ed; border-color:#fed7aa; margin-top:10px;">
                <div style="flex:1;">
                    <h3 style="margin:0 0 5px 0; color:#b45309; font-size:15px;">
                        ğŸ•˜ è‡ªåŠ¨å¿«ç…§ / å›æ»š
                    </h3>
                    <p style="font-size:12px; color:#64748b; margin:0;">æ¯æ¬¡ä¿å­˜å‰è‡ªåŠ¨ä¿ç•™æœ€è¿‘ 5 ç‰ˆï¼Œå¯ä¸€é”®å›æ»šã€‚</p>
                </div>
                <div style="display:flex; gap:10px; align-items:center;">
                    <button class="btn btn-sm btn-orange" onclick="createAutoSnapshot(getCurrentSnapshotPayload())">æ‰‹åŠ¨ç”Ÿæˆå¿«ç…§</button>
                </div>
                <div id="auto-snapshot-list" style="width:100%; margin-top:8px; font-size:12px; color:#7c2d12;"></div>
            </div>

            <div id="msg-box" style="margin-top:20px; font-weight:bold; color:var(--success); text-align:center; font-size:16px;"></div>
        </div>

        <!-- 2. ä¹¡é•‡å­¦æ ¡åˆ†æ -->
        <div id="analysis" class="section card-box">
            <div class="module-desc-bar" style="border-color: var(--color-macro)">
                <h3><i class="ti ti-world-latitude"></i> 02 é•‡åŸŸå®è§‚æ¨ªå‘è¯„ä»· <span class="badge" style="background:#0ea5e9;">ğŸ“Š ç­ä¸»ä»»å¿…çœ‹</span></h3>
                <p><strong>ä¸€å¥è¯ç›®çš„ï¼š</strong>å¿«é€Ÿæ¯”è¾ƒå­¦æ ¡/ç­çº§æ•´ä½“æ°´å¹³ä¸æ’åä½ç½®ã€‚</p>
                <p><strong>æ¨èé¡ºåºï¼š</strong>å¯¼å…¥å®Œæˆåä¼˜å…ˆæŸ¥çœ‹æœ¬æ¨¡å—ï¼Œç¡®å®šæ•´ä½“ç«™ä½ã€‚</p>
            </div>
            <div class="sec-head">
                <h2>
                    <i class="ti ti-chart-dots"></i> ä¹¡é•‡å­¦æ ¡åˆ†æ - ä¸¤ç‡ä¸€åˆ† 
                    <span class="module-help-btn" onclick="showModuleHelp('macro')">ğŸ“˜ ç®—æ³•è¯´æ˜</span>
                </h2>
                <div class="control-panel" style="margin-bottom:0; padding:5px;">
                    <input type="text" id="mySchool" placeholder="è¾“å…¥æœ¬æ ¡åç§°é«˜äº®" style="width:180px;">
                    <button class="btn" onclick="renderHorizontalTable()">ç”Ÿæˆæ¨ªå‘å¯¹æ¯”è¡¨</button>
                    <button class="btn btn-purple" onclick="toggleTableHeatmap('horizontal-table')">ğŸ¨ å¼€å¯çƒ­åŠ›å›¾</button>
                    <button class="btn btn-green" onclick="exportMacroTables()">å¯¼å‡ºå…¨ç§‘åˆ†æè¡¨</button>
                </div>
            </div>
            <div style="margin:12px 0 14px 0; padding:10px; border:1px solid #e2e8f0; border-radius:8px; background:#f8fafc;">
                <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
                    <div style="font-weight:600; color:#334155;">ğŸ§­ æ ¡é™…è”è€ƒå¤šæœŸå¯¹æ¯”ï¼ˆ2æœŸ/3æœŸï¼‰</div>
                    <div style="display:flex; gap:8px; align-items:center; font-size:12px;">
                        <label>æœŸæ•°ï¼š</label>
                        <select id="macroComparePeriodCount" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px;" onchange="onMacroComparePeriodCountChange()">
                            <option value="2">2æœŸ</option>
                            <option value="3">3æœŸ</option>
                        </select>
                    </div>
                </div>
                <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px;">
                    <label style="font-size:12px; color:#475569;">å­¦æ ¡ï¼š</label>
                    <select id="macroCompareSchool" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:130px;"></select>
                    <label style="font-size:12px; color:#475569;">ç¬¬1æœŸï¼š</label>
                    <select id="macroCompareExam1" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:180px;"></select>
                    <label style="font-size:12px; color:#475569;">ç¬¬2æœŸï¼š</label>
                    <select id="macroCompareExam2" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:180px;"></select>
                    <span id="macroCompareExam3Wrap" style="display:none;">
                        <label style="font-size:12px; color:#475569; margin-left:2px;">ç¬¬3æœŸï¼š</label>
                        <select id="macroCompareExam3" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:180px;"></select>
                    </span>
                    <button class="btn btn-sm btn-blue" onclick="renderMacroMultiPeriodComparison()">ç”Ÿæˆæ ¡é™…å¤šæœŸå¯¹æ¯”</button>
                    <button class="btn btn-sm btn-green" onclick="exportMacroMultiPeriodComparison()">å¯¼å‡ºæ ¡é™…å¤šæœŸå¯¹æ¯”</button>
                    <button class="btn btn-sm" style="background:#8b5cf6; color:white;" onclick="saveMacroMultiPeriodCompareToCloud()">â˜ï¸ ä¿å­˜äº‘ç«¯å¯¹æ¯”</button>
                    <button class="btn btn-sm" style="background:#06b6d4; color:white;" onclick="viewCloudMacroCompares()">ğŸ“‹ æŸ¥çœ‹äº‘ç«¯å¯¹æ¯”</button>
                </div>
                <div id="macroCompareHint" style="margin-top:6px; font-size:12px; color:#64748b;">è¯·é€‰æ‹©2æœŸæˆ–3æœŸè€ƒè¯•åç”Ÿæˆã€‚</div>
                <div id="macroCompareResult" style="margin-top:10px;"></div>
            </div>
            <div class="layout-grid">
                <div class="side-nav">
                    <div class="side-nav-title">å¿«é€Ÿå®šä½</div>
                    <div class="side-nav-link active" onclick="scrollToAnchor('anchor-total', this)">ğŸ† ç»¼åˆæ€»è¡¨</div>
                    <div class="side-nav-link" onclick="toggleSubNav(this)"><span>ğŸ“˜ å„ç§‘è¯¦æƒ…</span><i class="ti ti-chevron-right nav-caret"></i></div>
                    <div id="side-nav-subjects-container" class="side-nav-sub-container"></div>
                    <div class="side-nav-link" onclick="scrollToAnchor('horizontal-box', this)">â†”ï¸ æ¨ªå‘å¯¹æ¯”</div>
                </div>
                <div class="content-area">
                    <div id="anchor-total" class="anchor-target"><div class="sub-header" style="margin-top:0;"><span>ğŸ† <span class="label-total">å…¨ç§‘æ€»</span> - ç»¼åˆåˆ†æè¡¨</span></div><div class="table-wrap"><table id="tb-total"><thead><tr><th>å­¦æ ¡åç§°</th><th>å®è€ƒäººæ•°</th><th>å¹³å‡åˆ†</th><th>ä¼˜ç§€ç‡</th><th>åŠæ ¼ç‡</th><th>å¹³å‡åˆ†èµ‹åˆ†</th><th>ä¼˜ç§€ç‡èµ‹åˆ†</th><th>åŠæ ¼ç‡èµ‹åˆ†</th><th>ä¸¤ç‡ä¸€åˆ†æ€»åˆ†</th><th>æ’å</th></tr></thead><tbody></tbody></table></div></div>
                    <div id="subject-tables-container" class="anchor-target" style="padding-top:20px;"></div>
                    <div id="horizontal-box" class="hidden anchor-target" style="padding-top:20px;">
                        <div class="sub-header" style="display:flex; justify-content:space-between; align-items:center;">
                            <span>â†”ï¸ æ¨ªå‘å¯¹æ¯”ä¸€è§ˆè¡¨</span>
                            <button class="btn btn-green" onclick="exportHorizontalExcel()">å¯¼å‡ºæ¨ªå‘Excel</button>
                        </div>
                        <div class="table-wrap" id="horizontal-table"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2.1 é•‡åŸŸé¢„è­¦ä¸äº®ç‚¹çœ‹æ¿ -->
        <div id="macro-watch" class="section card-box">
            <div class="module-desc-bar" style="border-color: var(--color-macro)">
                <h3><i class="ti ti-alert-triangle"></i> 02A é•‡åŸŸé¢„è­¦ä¸äº®ç‚¹çœ‹æ¿</h3>
                <p>è¯´æ˜ï¼šé›†ä¸­å‘ˆç°å…¨é•‡æ ¸å¿ƒKPIä¸çº¢é»„ç»¿é¢„è­¦æ¸…å•ï¼Œä¾¿äºå¿«é€Ÿå®šä½é—®é¢˜å­¦æ ¡ä¸æ ‡æ†å­¦æ ¡ã€‚</p>
            </div>
            <div class="sec-head">
                <h2>
                    <i class="ti ti-dashboard"></i> é£é™©é¢„è­¦ä¸äº®ç‚¹æ€»è§ˆ
                    <span class="module-help-btn" onclick="showModuleHelp('macro')">ğŸ“˜ è§„åˆ™è¯´æ˜</span>
                </h2>
            </div>
            <div id="macro-dashboard" class="fb-dashboard" style="margin-bottom:25px;"></div>
            <div id="traffic-light-dashboard" class="traffic-grid hidden">
                <!-- çº¢ç¯åŒºï¼šä¸¥é‡é¢„è­¦ -->
                <div class="traffic-col red">
                    <div class="traffic-head red">
                        <span><i class="ti ti-alert-triangle-filled"></i> çº¢è‰²é¢„è­¦ (é‡ç‚¹æ•´æ”¹)</span>
                        <span id="count-red" class="badge" style="background:#b91c1c">0</span>
                    </div>
                    <div style="font-size:11px; color:#b91c1c; margin-bottom:10px; opacity:0.8;">
                        è§¦å‘æ¡ä»¶: åŠæ ¼ç‡&lt;60% æˆ– å•ç§‘æ’åå€’æ•°ç¬¬ä¸€
                    </div>
                    <div class="traffic-list" id="list-red"></div>
                </div>

                <!-- é»„ç¯åŒºï¼šé£é™©æç¤º -->
                <div class="traffic-col yellow">
                    <div class="traffic-head yellow">
                        <span><i class="ti ti-alert-circle-filled"></i> é»„è‰²å…³æ³¨ (åŸ¹ä¼˜æå‡)</span>
                        <span id="count-yellow" class="badge" style="background:#b45309">0</span>
                    </div>
                    <div style="font-size:11px; color:#b45309; margin-bottom:10px; opacity:0.8;">
                        è§¦å‘æ¡ä»¶: ä¼˜ç§€ç‡&lt;15% æˆ– ä¸´ç•Œç”Ÿå¯†é›†
                    </div>
                    <div class="traffic-list" id="list-yellow"></div>
                </div>

                <!-- ç»¿ç¯åŒºï¼šæ ‡æ†ç¤ºèŒƒ -->
                <div class="traffic-col green">
                    <div class="traffic-head green">
                        <span><i class="ti ti-thumb-up-filled"></i> ç»¿è‰²æ ‡æ† (ç»éªŒæ¨å¹¿)</span>
                        <span id="count-green" class="badge" style="background:#15803d">0</span>
                    </div>
                    <div style="font-size:11px; color:#15803d; margin-bottom:10px; opacity:0.8;">
                        è§¦å‘æ¡ä»¶: ä¼˜ç§€ç‡&gt;30% æˆ– ç»¼åˆæ’åç¬¬ä¸€
                    </div>
                    <div class="traffic-list" id="list-green"></div>
                </div>
            </div>
        </div>

        <!-- 2.1 æ–°å¢ï¼šé«˜åˆ†æ®µæ ¸ç®—ç‹¬ç«‹æ¨¡å— -->
        <div id="high-score" class="section card-box">
            <div class="module-desc-bar" style="border-color: #b45309">
                <h3><i class="ti ti-trophy"></i> 9å¹´çº§é«˜åˆ†æ®µæ ¸ç®—</h3>
                <p>è€ƒæ ¸æ ‡å‡†ï¼šæ€»åˆ†â‰¥490åˆ†ã€‚èµ‹åˆ†å…¬å¼ï¼š(æœ¬æ ¡é«˜åˆ†ç‡ / å…¨é•‡æœ€é«˜é«˜åˆ†ç‡) Ã— 70ã€‚</p>
            </div>
            <div class="sec-head">
                <h2>
                    <i class="ti ti-trophy"></i> é«˜åˆ†æ®µèµ‹åˆ†è¯¦æƒ…
                    <span class="module-help-btn" onclick="showModuleHelp('high-score')">ğŸ“˜ æ ¸ç®—è§„åˆ™</span>
                </h2>
                <button class="btn btn-green" onclick="exportHighScoreExcel()">ğŸ“Š å¯¼å‡ºExcel</button>
            </div>
            <details class="explain-panel">
                <summary>å£å¾„è¯´æ˜ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>
                <div class="explain-content">
                    <p>å®è€ƒäººæ•°ï¼šæœ¬æ¬¡æœ‰æœ‰æ•ˆæˆç»©çš„å­¦ç”Ÿæ•°ã€‚</p>
                    <p>é«˜åˆ†äººæ•°ï¼šæ€»åˆ†è¾¾åˆ°é«˜åˆ†çº¿ï¼ˆå½“å‰é»˜è®¤ â‰¥490ï¼‰çš„å­¦ç”Ÿæ•°ã€‚</p>
                    <p>é«˜åˆ†ç‡ï¼šé«˜åˆ†äººæ•° Ã· å®è€ƒäººæ•°ã€‚</p>
                    <p>é«˜åˆ†èµ‹åˆ†ï¼šä»¥é«˜åˆ†ç‡è¿›è¡Œæ ‡å‡†åŒ–æŠ˜ç®—ï¼Œç”¨äºæ¨ªå‘æ¯”è¾ƒã€‚</p>
                </div>
            </details>
            <div class="table-wrap">
                <table id="tb-high-score">
                    <thead>
                        <tr>
                            <th>å­¦æ ¡åç§°</th>
                            <th>å®è€ƒäººæ•°</th>
                            <th style="background:#fff7ed; color:#b45309;">é«˜åˆ†äººæ•° (â‰¥490)</th>
                            <th style="background:#fff7ed; color:#b45309;">é«˜åˆ†ç‡</th>
                            <th style="background:#fff7ed; color:#b45309;">é«˜åˆ†èµ‹åˆ† (æ»¡åˆ†70)</th>
                            <th>æ’å</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        
        <!-- 3. å1/3æ ¸ç®— -->
        <div id="bottom3" class="section card-box">
            <div class="sec-head">
                <h2>
                    <i class="ti ti-arrow-bar-to-down"></i> å1/3å­¦ç”Ÿæ ¸ç®—
                    <span class="module-help-btn" onclick="showModuleHelp('bottom3')">ğŸ“˜ å‰”é™¤è§„åˆ™</span>
                    <span style="font-size:14px; font-weight:normal; color:#666; margin-left:5px;">(å‰”é™¤ç‡: <span id="label-exc"></span>)</span>
                </h2>
                <button class="btn" onclick="exportExcel('bottom3')">å¯¼å‡ºç»“æœ</button>
            </div>
            <details class="explain-panel">
                <summary>å£å¾„è¯´æ˜ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>
                <div class="explain-content">
                    <p>æ€»äººæ•°ï¼šå­¦æ ¡åœ¨ç±äººæ•°ï¼ˆå«ç¼ºè€ƒï¼‰ã€‚</p>
                    <p>å1/3äººæ•°ï¼šæŒ‰æ€»åˆ†ä»ä½åˆ°é«˜æ’åºåçš„å 1/3 äººæ•°ã€‚</p>
                    <p>å‰”é™¤äººæ•°ï¼šæŒ‰ç…§å‰”é™¤ç‡ä»å 1/3 ä¸­å‰”é™¤çš„äººæ•°ã€‚</p>
                    <p>æœ‰æ•ˆå1/3å‡åˆ†ï¼šåœ¨å‰”é™¤åï¼Œå‰©ä½™å 1/3 å­¦ç”Ÿçš„å¹³å‡åˆ†ã€‚</p>
                    <p>æ ¸ç®—å¾—åˆ†ï¼šæœ‰æ•ˆå1/3å‡åˆ†æŒ‰å…¨é•‡æœ€é«˜å€¼æŠ˜ç®—ï¼Œç”¨äºæ’åã€‚</p>
                </div>
            </details>
            <div class="table-wrap"><table id="tb-bottom3"><thead><tr><th>å­¦æ ¡åç§°</th><th>æ€»äººæ•°</th><th>å1/3äººæ•°</th><th>å‰”é™¤äººæ•°</th><th>æœ‰æ•ˆå1/3å‡åˆ†</th><th>æ ¸ç®—å¾—åˆ†</th><th>æ’å</th></tr></thead><tbody></tbody></table></div>
        </div>

        <!-- 4. æŒ‡æ ‡ç”Ÿæ ¸ç®— -->
        <div id="indicator" class="section card-box">
            <div class="sec-head">
                <h2>
                    <i class="ti ti-target"></i> æŒ‡æ ‡ç”Ÿè¾¾æ ‡æ ¸ç®—
                    <span class="module-help-btn" onclick="showModuleHelp('indicator')">ğŸ“˜ è®¡åˆ†å…¬å¼</span>
                </h2>
                <div>
                    <button class="btn btn-blue" onclick="openTargetEditor()">
                        <i class="ti ti-edit"></i> åœ¨çº¿è°ƒæ•´ç›®æ ‡
                    </button>
                    <button class="btn btn-green" id="btn-indicator-calc" onclick="calcIndicators()">å¼€å§‹è®¡ç®—</button>
                    <button class="btn" onclick="exportExcel('indicator')">å¯¼å‡ºç»“æœ</button>
                </div>
            </div>
            <details class="explain-panel">
                <summary>å£å¾„è¯´æ˜ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>
                <div class="explain-content">
                    <p>æŒ‡æ ‡çº¿ï¼šæ ¹æ®è®¾å®šçš„åæ¬¡æˆ–æ¯”ä¾‹è‡ªåŠ¨æ¢ç®—ä¸ºåˆ†æ•°çº¿ã€‚</p>
                    <p>è¾¾æ ‡äººæ•°ï¼šæ€»åˆ†è¾¾åˆ°å¯¹åº”æŒ‡æ ‡çº¿çš„å­¦ç”Ÿæ•°ã€‚</p>
                    <p>è¾¾æ ‡ç‡ï¼šè¾¾æ ‡äººæ•° Ã· å®è€ƒäººæ•°ã€‚</p>
                    <p>æŒ‡æ ‡å¾—åˆ†ï¼šæŒ‰è¾¾æ ‡ç‡è¿›è¡Œæ ‡å‡†åŒ–æŠ˜ç®—ï¼Œç”¨äºæ ¡é™…æ¯”è¾ƒã€‚</p>
                </div>
            </details>
            <div class="table-wrap"><table id="tb-indicator"><thead><tr><th>å­¦æ ¡åç§°</th><th>æŒ‡æ ‡ä¸€(ç›®æ ‡/è¾¾æ ‡)</th><th>å¾—åˆ†</th><th>æŒ‡æ ‡äºŒ(ç›®æ ‡/è¾¾æ ‡)</th><th>å¾—åˆ†</th><th>æŒ‡æ ‡ç”Ÿæ€»åˆ†</th><th>æ’å</th></tr></thead><tbody></tbody></table></div>
        </div>

        <!-- 5. ç»¼åˆæ€»æ’å -->
        <div id="summary" class="section card-box">
            <div class="sec-head">
                <h2>
                    <i class="ti ti-report"></i> ç»¼åˆåˆ†ææŠ¥å‘Š <span class="badge" style="background:#16a34a;">â­ æ•™åŠ¡å¸¸ç”¨</span>
                    <span class="module-help-btn" onclick="showModuleHelp('summary')">ğŸ“˜ æƒé‡è¯´æ˜</span>
                </h2>
                <div>
                    <button class="btn btn-green" onclick="calcSummary()">ç”Ÿæˆæ€»æ’å</button>
                    <button class="btn btn-green" onclick="exportSummaryTable()">å¯¼å‡ºæŠ¥å‘Š</button>
                    <button class="btn btn-orange" onclick="exportPPTReport()">
                        <i class="ti ti-presentation"></i> å¯¼å‡ºæ±‡æŠ¥PPT
                    </button>
</div></div>
            <div class="table-wrap"><table id="tb-summary"><thead><tr><th>å­¦æ ¡åç§°</th><th>ä¸¤ç‡ä¸€åˆ†å¾—åˆ†</th><th>å1/3å¾—åˆ†</th><th>æŒ‡æ ‡ç”Ÿå¾—åˆ†</th><th>ç»¼åˆæ€»åˆ†</th><th>æ€»æ’å</th></tr></thead><tbody></tbody></table></div>
        </div>

        <!-- 6. æœ¬æ ¡æ•™å¸ˆåˆ†æ -->
        <div id="teacher-analysis" class="section card-box">
            <div class="sec-head">
                <h2>
                    <i class="ti ti-school"></i> æœ¬æ ¡æ•™å¸ˆæ•™å­¦åˆ†æ <span class="badge" style="background:#0ea5e9;">ğŸ“Š ç­ä¸»ä»»å¿…çœ‹</span>
                    <span class="module-help-btn" onclick="showModuleHelp('teacher')">ğŸ“˜ è¯„ä»·æ¨¡å‹</span>
                </h2>
                <button class="btn" onclick="exportTeacherAnalysis()">å¯¼å‡ºæ•™å¸ˆåˆ†æ</button>
            </div>
            <div class="info-bar" style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                <span>æœ¬æ ¡æ•™å¸ˆæ•™å­¦åˆ†æåŸºäºå¯¼å…¥çš„æ•™å¸ˆä¿¡æ¯å’Œæˆç»©æ•°æ®ï¼Œå±•ç¤ºæ•™å¸ˆæ‰€æ•™ç­çº§çš„æ•´ä½“è¡¨ç°ï¼Œå¹¶ä¸ä¹¡é•‡å­¦æ ¡è¿›è¡Œå¯¹æ¯”ã€‚</span>
                <button id="teacher-sync-cta" class="btn btn-orange" style="display:none; white-space:nowrap;" onclick="openTeacherSync()">å»åŒæ­¥ä»»è¯¾è¡¨</button>
            </div>
            <div style="margin:12px 0 14px 0; padding:10px; border:1px solid #e2e8f0; border-radius:8px; background:#f8fafc;">
                <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
                    <div style="font-weight:600; color:#334155;">ğŸ§­ æ•™å¸ˆåŒå­¦ç§‘å¤šæœŸå¯¹æ¯”ï¼ˆ2æœŸ/3æœŸï¼‰</div>
                    <div style="display:flex; gap:8px; align-items:center; font-size:12px;">
                        <label>æœŸæ•°ï¼š</label>
                        <select id="teacherComparePeriodCount" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px;" onchange="onTeacherComparePeriodCountChange()">
                            <option value="2">2æœŸ</option>
                            <option value="3">3æœŸ</option>
                        </select>
                    </div>
                </div>
                <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px;">
                    <label style="font-size:12px; color:#475569;">å­¦æ ¡ï¼š</label>
                    <select id="teacherCompareSchool" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:130px;" onchange="updateTeacherCompareTeacherSelect()"></select>
                    <label style="font-size:12px; color:#475569;">å­¦ç§‘ï¼š</label>
                    <select id="teacherCompareSubject" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:110px;" onchange="updateTeacherCompareTeacherSelect()"></select>
                    <label style="font-size:12px; color:#475569;">æ•™å¸ˆï¼š</label>
                    <select id="teacherCompareTeacher" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:120px;"></select>
                    <label style="font-size:12px; color:#475569;">ç¬¬1æœŸï¼š</label>
                    <select id="teacherCompareExam1" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:180px;"></select>
                    <label style="font-size:12px; color:#475569;">ç¬¬2æœŸï¼š</label>
                    <select id="teacherCompareExam2" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:180px;"></select>
                    <span id="teacherCompareExam3Wrap" style="display:none;">
                        <label style="font-size:12px; color:#475569; margin-left:2px;">ç¬¬3æœŸï¼š</label>
                        <select id="teacherCompareExam3" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:180px;"></select>
                    </span>
                    <button class="btn btn-sm btn-blue" onclick="renderTeacherMultiPeriodComparison()">ç”Ÿæˆæ•™å¸ˆå¤šæœŸå¯¹æ¯”</button>
                    <button class="btn btn-sm" style="background:#ea580c; color:white;" onclick="renderAllTeachersMultiPeriodComparison()" title="ç”Ÿæˆè¯¥å­¦æ ¡æ‰€æœ‰æ•™å¸ˆçš„å¯¹æ¯”è¡¨">ğŸ“Š ç”Ÿæˆå…¨æ ¡å¯¹æ¯”</button>
                    <button class="btn btn-sm btn-green" onclick="exportTeacherMultiPeriodComparison()">å¯¼å‡ºæ•™å¸ˆå¤šæœŸå¯¹æ¯”</button>
                    <button class="btn btn-sm" style="background:#8b5cf6; color:white;" onclick="saveTeacherMultiPeriodCompareToCloud()" title="ä¿å­˜å½“å‰å¯¹æ¯”ç»“æœåˆ°äº‘ç«¯">â˜ï¸ ä¿å­˜äº‘ç«¯å¯¹æ¯”</button>
                    <button class="btn btn-sm" style="background:#06b6d4; color:white;" onclick="viewCloudTeacherCompares()" title="æŸ¥çœ‹å·²ä¿å­˜çš„æ•™å¸ˆå¯¹æ¯”è®°å½•">ğŸ“‹ æŸ¥çœ‹äº‘ç«¯å¯¹æ¯”</button>
                </div>
                <div id="teacherCompareHint" style="margin-top:6px; font-size:12px; color:#64748b;">è¯·é€‰æ‹©å­¦æ ¡+å­¦ç§‘+æ•™å¸ˆå¹¶é€‰æ‹©2æœŸæˆ–3æœŸè€ƒè¯•åç”Ÿæˆã€‚</div>
                <div id="teacherCompareResult" style="margin-top:10px;"></div>
            </div>
            <details class="explain-panel">
                <summary>æŒ‡æ ‡å£å¾„è¯´æ˜ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>
                <div class="explain-content">
                    <p>å¹³å‡åˆ†ï¼šè¯¥æ•™å¸ˆæ‰€æ•™ç­çº§ã€è¯¥å­¦ç§‘æ‰€æœ‰æœ‰æ•ˆæˆç»©çš„ç®—æœ¯å¹³å‡ã€‚</p>
                    <p>ä¼˜ç§€çº¿/åŠæ ¼çº¿ï¼šæŒ‰å¹´çº§å®è€ƒäººæ•°æ¯”ä¾‹è‡ªåŠ¨åˆ’å®šï¼Œ9å¹´çº§ä¼˜ç§€çº¿å–å‰15%ï¼Œå…¶ä»–å¹´çº§å–å‰20%ï¼ŒåŠæ ¼çº¿å–å‰50%ï¼›å•æ ¡æ€»åˆ†å¯æŒ‰â€œåæ¬¡çº¿â€æ¢ç®—ã€‚</p>
                    <p>ä¼˜ç§€ç‡ï¼šä¼˜ç§€äººæ•° Ã· å®è€ƒäººæ•°ï¼Œä¼˜ç§€çº¿æ¥è‡ªæœ¬æ¬¡å¹´çº§åˆ†å¸ƒé˜ˆå€¼ã€‚</p>
                    <p>åŠæ ¼ç‡ï¼šåŠæ ¼äººæ•° Ã· å®è€ƒäººæ•°ï¼ŒåŠæ ¼çº¿æ¥è‡ªæœ¬æ¬¡å¹´çº§åˆ†å¸ƒé˜ˆå€¼ã€‚</p>
                    <p>ä¼˜ç§€äººæ•°ï¼šåˆ†æ•° â‰¥ ä¼˜ç§€çº¿çš„äººæ•°ï¼›åŠæ ¼äººæ•°ï¼šåˆ†æ•° â‰¥ åŠæ ¼çº¿çš„äººæ•°ã€‚</p>
                    <p>ä½åˆ†äººæ•°ï¼šåˆ†æ•° &lt; ä½åˆ†çº¿çš„äººæ•°ï¼ˆä½åˆ†çº¿ = åŠæ ¼çº¿ Ã— 0.6ï¼‰ã€‚</p>
                    <p>ä½åˆ†ç‡ï¼šä½äºâ€œåŠæ ¼çº¿ Ã— 0.6â€çš„å æ¯”ï¼›å¦‚æœªç”ŸæˆåŠæ ¼çº¿åˆ™æŒ‰ 60 åˆ†å£å¾„è®¡ç®—ã€‚</p>
                    <p>ä¸çº§æ¯”ï¼šä¸å¹´çº§å¹³å‡æ°´å¹³çš„å·®å€¼ï¼ˆå‡åˆ†/ä¼˜ç‡/åŠæ ¼ç‡åˆ†åˆ«å¯¹æ¯”ï¼‰ã€‚</p>
                    <p>è´¡çŒ®å€¼ï¼šæ•™å¸ˆå‡åˆ† âˆ’ å¹´çº§å‡åˆ†ï¼ˆåŒå­¦ç§‘ï¼‰ï¼Œåæ˜ â€œç›¸å¯¹æå‡â€ã€‚</p>
                    <p>ç»¼åˆå¾—åˆ†ï¼šåŸºå‡†åˆ† + è´¡çŒ®å€¼ + ä¼˜ç§€ç‡æƒé‡ + åŠæ ¼ç‡æƒé‡ âˆ’ ä½åˆ†ç‡æƒ©ç½šï¼Œç”¨äºæ ¡å†…æ¨ªå‘æ¯”è¾ƒã€‚</p>
                    <p>æ ¡å†…æ’åï¼šåŒå­¦ç§‘æ•™å¸ˆæŒ‰ç»¼åˆå¾—åˆ†æ’åºï¼Œåˆ†æ•°å¹¶åˆ—æ—¶å…±äº«åæ¬¡ã€‚</p>
                </div>
            </details>
            <div class="layout-grid">
                <div class="side-nav">
                    <div class="side-nav-title">åŠŸèƒ½å¯¼èˆª</div>
                    <div class="side-nav-link active" onclick="scrollToAnchor('anchor-cards', this)">ğŸ“‡ æ•™å¸ˆæ¦‚å†µå¡ç‰‡</div>
                    <div class="side-nav-link" onclick="scrollToAnchor('anchor-detail', this)">ğŸ“Š è¯¦ç»†æ•°æ®å¯¹æ¯”</div>
                    <div class="side-nav-link" onclick="scrollToAnchor('anchor-pair', this)">ğŸ¤ ç»“å¯¹å­å»ºè®®</div>
                    <div class="side-nav-link" onclick="toggleSubNav(this)"><span>ğŸ… ä¹¡é•‡æ’å</span><i class="ti ti-chevron-right nav-caret"></i></div>
                    <div id="side-nav-teacher-ranks-container" class="side-nav-sub-container"></div>
                </div>
                <div class="content-area">
                    <div id="anchor-cards" class="anchor-target">                    <!-- ä½¿ç”¨ x-data å£°æ˜è¿™æ˜¯ä¸€ä¸ª Alpine ç»„ä»¶ï¼Œx-show æ§åˆ¶æ˜¾ç¤º -->
                    <div class="teacher-cards-container" id="teacherCardsContainer" x-data>
                        
                        <!-- ç©ºçŠ¶æ€æç¤º -->
                        <div x-show="$store.teacherData.list.length === 0" style="grid-column: 1/-1; text-align:center; color:#999; padding:20px;">
                            æš‚æ— æ•™å¸ˆæ•°æ®ï¼Œè¯·å…ˆåœ¨ä¸Šæ–¹é…ç½®å¹¶å¯¼å…¥ã€‚
                            <div style="margin-top:10px;">
                                <button class="btn btn-orange" onclick="openTeacherSync()">å»åŒæ­¥ä»»è¯¾è¡¨</button>
                            </div>
                        </div>

                        <!-- å¾ªç¯æ¸²æŸ“å¡ç‰‡ -->
                        <template x-for="item in $store.teacherData.list" :key="item.id">
                            <div class="teacher-card">
                                <div class="teacher-header">
                                    <div>
                                        <div class="teacher-name" x-text="item.name + ' - ' + item.subject"></div>
                                        <div class="teacher-classes" x-text="item.classes + 'ç­'"></div>
                                    </div>
                                    <div :class="`performance-badge ${item.badgeClass}`" x-text="item.badgeText"></div>
                                </div>
                                <div class="teacher-stats">
                                    <div class="stat-item"><div class="stat-value" x-text="item.avg"></div><div class="stat-label">å¹³å‡åˆ†</div></div>
                                    <div class="stat-item"><div class="stat-value" x-text="item.excRate"></div><div class="stat-label">ä¼˜ç§€ç‡</div></div>
                                    <div class="stat-item"><div class="stat-value" x-text="item.passRate"></div><div class="stat-label">åŠæ ¼ç‡</div></div>
                                </div>
                                <div style="display:flex; justify-content:space-between; font-size:12px; color:#666; margin-bottom:15px; padding:0 10px;">
                                    <span>å­¦ç”Ÿ: <span x-text="item.count"></span>äºº</span>
                                    <span>é•‡æ’: <strong style="color:var(--primary)" x-text="item.rank"></strong></span>
                                </div>
                                <!-- ç‚¹å‡»äº‹ä»¶ç›´æ¥ç»‘å®š JS å‡½æ•° -->
                                <button class="view-details-btn" @click="showTeacherDetails(item.name, item.subject)">æŸ¥çœ‹è¯¦æƒ…</button>
                            </div>
                        </template>
                    </div></div>
                    <div id="anchor-detail" class="anchor-target" style="padding-top:30px;">
                        <div class="sub-header" style="display:flex; justify-content:space-between; align-items:center;">
                            <span>ğŸ“Š æ•™å¸ˆæ•™å­¦è¯¦ç»†æ•°æ®å¯¹æ¯”è¡¨</span>
                            <button class="btn btn-green" onclick="exportTeacherComparisonExcel()">å¯¼å‡ºExcel</button>
                        </div>
                        <div class="table-wrap"><table class="comparison-table" id="teacherComparisonTable"><thead><tr><th rowspan="2">æ•™å¸ˆå§“å</th><th rowspan="2">å­¦ç§‘</th><th rowspan="2">ä»»æ•™ç­çº§</th><th rowspan="2">äººæ•°</th><th colspan="3">å¹³å‡åˆ†</th><th colspan="3">ä¼˜ç§€ç‡</th><th colspan="3">åŠæ ¼ç‡</th><th rowspan="2">ç»¼åˆå¾—åˆ†</th><th rowspan="2">æ ¡å†…æ’å</th></tr><tr><th>å®é™…å€¼</th><th>ä¸çº§æ¯”</th><th>æ’å</th><th>å®é™…å€¼</th><th>ä¸çº§æ¯”</th><th>æ’å</th><th>å®é™…å€¼</th><th>ä¸çº§æ¯”</th><th>æ’å</th></tr></thead><tbody></tbody></table></div>
                    </div>
                    <div id="anchor-pair" class="anchor-target" style="padding-top:30px;"><div id="teacher-pairing-box"><div class="sub-header">ğŸ¤ æ ¡å†…æ•™å¸ˆâ€œç»“å¯¹å­â€äº’åŠ©å»ºè®® (åŸºäºæ•°æ®åˆ†æ)</div><div id="teacher-pairing-suggestions" class="pairing-container"></div></div></div>
                    <div id="teacher-township-ranking-container"></div>
                    <div style="margin-top:10px; text-align:right;"><button class="btn btn-green" onclick="exportTeacherTownshipRankExcel()">å¯¼å‡ºæ•™å¸ˆä¹¡é•‡æ’å</button></div>
                </div>
            </div>
        </div>

        <!-- ================== æ–°å¢æ¨¡å—ï¼šæ ¡å†…ç»©æ•ˆå…¬å¹³è€ƒæ ¸ (å•æ ¡æ¨¡å¼) ================== -->
        <div id="single-school-eval" class="section card-box">
            <div class="module-desc-bar" style="border-color: var(--color-internal)">
                <h3><i class="ti ti-scale"></i> 03 æ ¡å†…ç»©æ•ˆç®¡ç†ä¸è¯„ä»·</h3>
                <p>è¯´æ˜ï¼šé¢å‘æ ¡é•¿å®¤ã€‚è§£å†³ç”Ÿæºä¸å‡å¯¼è‡´çš„è€ƒæ ¸ä¸å…¬ï¼Œé€šè¿‡â€œç”Ÿæºå¢å€¼æ¨¡å‹â€å’Œâ€œå¤§ç­é¢è¡¥å¿ç³»æ•°â€ï¼Œç§‘å­¦æ ¸ç®—æ¯ä½æ•™å¸ˆã€æ¯ä¸ªç­çº§çš„çœŸå®æ•™å­¦è´¡çŒ®ã€‚</p>
            </div>
            <div class="sec-head">
                <h2>
                    <i class="ti ti-scale"></i> æ ¡å†…ç»©æ•ˆå…¬å¹³è€ƒæ ¸æ¨¡å‹
                    <span class="module-help-btn" onclick="showModuleHelp('sse')">ğŸ“˜ 100åˆ†åˆ¶è¯¦è§£</span>
                </h2>
                <button class="btn btn-green" onclick="SSE_calculate()">ğŸš€ å¼€å§‹è€ƒæ ¸è®¡ç®—</button>
            </div>
            <details class="explain-panel">
                <summary>ç»©æ•ˆåˆ†å£å¾„è¯´æ˜ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>
                <div class="explain-content">
                    <p>å®è€ƒäººæ•°ï¼šæœ¬æ¬¡æœ‰æœ‰æ•ˆæˆç»©çš„å­¦ç”Ÿæ•°ï¼›åœ¨ç±äººæ•°ç”¨äºè®¡ç®—ç­é¢è¡¥å¿ã€‚</p>
                    <p>ä¼˜ç§€ç‡/åŠæ ¼ç‡ï¼šæŒ‰å¹´çº§å®è€ƒåˆ†å¸ƒåˆ’çº¿ï¼Œä¼˜ç§€çº¿ä¸ºå‰ 25%ï¼ŒåŠæ ¼çº¿ä¸ºå‰ 80%ã€‚</p>
                    <p>å‡åˆ†å¯¹æ¯”ï¼šç­çº§å‡åˆ†ä¸å¹´çº§å‡åˆ†å¯¹æ¯”åæŠ˜ç®—ä¸ºæƒé‡åˆ†ã€‚</p>
                    <p>ç”Ÿæºå¢å€¼ï¼šåœ¨æœ‰å†å²æ•°æ®æ—¶ï¼ŒåŸºäºå­¦ç”Ÿåæ¬¡å˜åŒ–çš„ç­çº§å¹³å‡å¢é‡ï¼›æœªå‹¾é€‰æˆ–æ— å†å²æ•°æ®åˆ™è®° 0 åˆ†ã€‚</p>
                    <p>å¤§ç­è¡¥å¿åˆ†ï¼šç­çº§åœ¨ç±äººæ•°ä¸å¹´çº§å¹³å‡ç­é¢çš„å·®å€¼ Ã— 0.1ï¼Œä½“ç°ç®¡ç†æˆæœ¬ã€‚</p>
                    <p>æœ€ç»ˆç»©æ•ˆåˆ†ï¼šä¼˜ç§€ç‡ã€åŠæ ¼ç‡ã€å‡åˆ†å¯¹æ¯”ã€ç”Ÿæºå¢å€¼åŠç­é¢è¡¥å¿çš„åŠ æ€»ï¼Œç”¨äºæ ¡å†…å…¬å¹³æ’åºã€‚</p>
                </div>
            </details>

            <!-- æ ¸å¿ƒç†å¿µå±•ç¤ºåŒº -->
            <div style="background: linear-gradient(to right, #f0f9ff, #e0f2fe); border: 1px solid #bae6fd; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h3 style="color: #0369a1; margin-bottom: 10px; font-size: 18px;"><i class="ti ti-bulb"></i> æ ¸å¿ƒç†å¿µï¼šâ€œä¸è®©è€å®äººåƒäºâ€</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <div style="color: var(--primary); font-weight: bold; margin-bottom: 5px;">1. ä¸çœ‹äººå£çœ‹å¯†åº¦ (35+35åˆ†)</div>
                        <p style="font-size: 12px; color: #666;">
                            æ‘’å¼ƒâ€œä¼˜ç”Ÿäººæ•°â€ç»å¯¹å€¼ï¼Œæ”¹ç”¨<strong>â€œä¼˜ç§€ç‡/åŠæ ¼ç‡â€</strong>ã€‚<br>
                            <span style="background: #dcfce7; padding: 1px 4px;">60äººç­15ä¸ªä¼˜ç”Ÿ = 40äººç­10ä¸ªä¼˜ç”Ÿ</span>ï¼Œå¾—åˆ†å®Œå…¨ä¸€è‡´ã€‚
                        </p>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <div style="color: var(--primary); font-weight: bold; margin-bottom: 5px;">2. ä¸çœ‹èµ·ç‚¹çœ‹å˜åŒ– (10åˆ†)</div>
                        <p style="font-size: 12px; color: #666;">
                            å¼•å…¥<strong>â€œç”Ÿæºå¢å€¼åˆ†â€</strong>ã€‚å¯¹æ¯”ä¸Šæ¬¡è€ƒè¯•æ’ä½ç™¾åˆ†æ¯”å˜åŒ–ã€‚<br>
                            å·®ç­ä»å¹´çº§å20%è¿›æ­¥åˆ°å40%ï¼Œå³è§†ä¸ºé«˜ç»©æ•ˆï¼Œå¥–åŠ±<strong>â€œåŠ å·¥èƒ½åŠ›â€</strong>ã€‚
                        </p>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <div style="color: var(--primary); font-weight: bold; margin-bottom: 5px;">3. å¤§ç­é¢è¡¥å¿ç³»æ•° (é¢å¤–åŠ åˆ†)</div>
                        <p style="font-size: 12px; color: #666;">
                            æ‰¿è®¤ç®¡ç†æˆæœ¬ã€‚ä»¥å¹´çº§å¹³å‡äººæ•°ä¸ºåŸºå‡†ã€‚<br>
                            æ¯å¤š <strong>1</strong> åå­¦ç”Ÿï¼Œæ€»åˆ†é¢å¤–è¡¥å¿ <strong>0.1</strong> åˆ†è¾›è‹¦åˆ†ã€‚
                        </p>
                    </div>
                </div>
            </div>

            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <div style="flex: 1;">
                    <label><strong>é€‰æ‹©è€ƒæ ¸å­¦æ ¡ï¼š</strong></label>
                    <select id="sse_school_select" style="min-width: 200px; padding: 8px;">
                        <option value="">-- è¯·é€‰æ‹© --</option>
                    </select>
                </div>
                <div style="flex: 2; display: flex; gap: 15px; align-items: center; font-size: 13px;">
                    <label><input type="checkbox" id="sse_check_exc" checked> ä¼˜ç§€è´¡çŒ®(å‰25%)</label>
                    <label><input type="checkbox" id="sse_check_pass" checked> åŠæ ¼ä¿åº•(å‰80%)</label>
                    <label><input type="checkbox" id="sse_check_avg" checked> å‡åˆ†æ°´ä½</label>
                    <label><input type="checkbox" id="sse_check_prog" checked> ç”Ÿæºå¢å€¼</label>
                </div>
                <div style="border-left: 1px solid #ccc; padding-left: 15px;">
                    <button class="btn btn-purple" onclick="SSE_export()">ğŸ“¥ å¯¼å‡ºè€ƒæ ¸è¡¨</button>
                </div>
            </div>

            <!-- ç»“æœå±•ç¤ºåŒº -->
            <div id="sse_result_container" class="hidden">
                <div class="sub-header">
                    <span>ğŸ“Š ç»©æ•ˆèµ‹åˆ†æ’è¡Œæ¦œ</span>
                    <span style="font-size: 12px; font-weight: normal; margin-left: 10px;">
                        (åŸºå‡†: ä¼˜ç§€35 + åŠæ ¼35 + å‡åˆ†20 + å¢å€¼10 = 100åˆ† + ç­é¢è¡¥å¿)
                    </span>
                </div>
                <div class="table-wrap">
                    <table id="sse_table">
                        <thead>
                            <tr>
                                <th>æ’å</th>
                                <th>ç­çº§</th>
                                <th>ç­ä¸»ä»»/æ•™å¸ˆ</th>
                                <th>å®è€ƒäººæ•°</th>
                                <th>å¤§ç­è¡¥å¿åˆ†</th>
                                <th>ä¼˜ç§€ç‡(25%)<br><small style="color:#999">æƒé‡35</small></th>
                                <th>åŠæ ¼ç‡(80%)<br><small style="color:#999">æƒé‡35</small></th>
                                <th>å‡åˆ†å¯¹æ¯”<br><small style="color:#999">æƒé‡20</small></th>
                                <th>ç”Ÿæºå¢å€¼<br><small style="color:#999">æƒé‡10</small></th>
                                <th style="background: #eff6ff; color: #1e3a8a;">æœ€ç»ˆè€ƒæ ¸åˆ†</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                
                <div style="margin-top: 15px; font-size: 12px; color: #666; background: #f9fafb; padding: 10px; border-radius: 6px;">
                    <strong>â„¹ï¸ ç®—æ³•è¯´æ˜ï¼š</strong><br>
                    1. <strong>ä¼˜ç§€/åŠæ ¼å¾—åˆ†ï¼š</strong> (æœ¬ç­ç‡ / å¹´çº§æœ€é«˜ç‡) Ã— æƒé‡åˆ†ã€‚é¼“åŠ±å‘æœ€é«˜æ ‡å‡†çœ‹é½ã€‚<br>
                    2. <strong>å‡åˆ†å¾—åˆ†ï¼š</strong> (æœ¬ç­å‡åˆ† / å¹´çº§å‡åˆ†) Ã— æƒé‡åˆ†ã€‚<br>
                    3. <strong>ç”Ÿæºå¢å€¼ï¼š</strong> è®¡ç®—å…¨ç­å­¦ç”Ÿæ’ä½ç™¾åˆ†æ¯”å˜åŒ–çš„å¹³å‡å€¼ã€‚æ­£å€¼ä¸ºè¿›æ­¥ã€‚æŒ‰ (è¿›æ­¥å€¼ / æœ€å¤§è¿›æ­¥å€¼) Ã— 10 è®¡ç®—ï¼Œé€€æ­¥è€…æ­¤é¡¹ä»ä½è®¡åˆ†ã€‚<br>
                    4. <strong>å¤§ç­è¡¥å¿ï¼š</strong> (ç­çº§äººæ•° - å¹´çº§å¹³å‡äººæ•°) Ã— 0.1ã€‚äººæ•°å°‘äºå¹³å‡çº¿ä¸æ‰£åˆ†ã€‚
                </div>
            </div>
        </div>

        <!-- å­¦ç§‘æ·±åº¦å…³è”åˆ†æ -->
        <div id="correlation-analysis" class="section card-box">
            <div class="sec-head"><h2><i class="ti ti-topology-star-3"></i> å­¦ç§‘è´¡çŒ®åº¦ä¸å…³è”æ€§æ·±åº¦åˆ†æ</h2><button class="btn btn-green" onclick="exportCorrelationExcel()">å¯¼å‡ºåˆ†æExcel</button></div>
            <div class="info-bar">æ¢ç´¢å­¦ç§‘é—´çš„å†…åœ¨è”ç³»ä»¥åŠå„å­¦ç§‘å¯¹æ€»åˆ†æ’åçš„è´¡çŒ®åº¦ï¼ˆåŒºåˆ†åº¦ï¼‰ã€‚</div>
            <div class="control-panel">
                <label>åˆ†æèŒƒå›´ï¼š</label><select id="corrSchoolSelect" style="min-width:200px;"><option value="ALL">å…¨ä¹¡é•‡</option></select>
                <button class="btn btn-purple" onclick="renderCorrelationAnalysis()">ğŸš€ å¼€å§‹æ·±åº¦åˆ†æ</button>
            </div>
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap:20px;">
                <div class="bg-gray-50">
                    <h3 style="margin-bottom:15px; color:#333;">ğŸ”— å­¦ç§‘é—´ç›¸å…³æ€§çƒ­åŠ›çŸ©é˜µ (Pearson)</h3>
                    <p style="font-size:12px; color:#666; margin-bottom:10px;">æ•°å€¼è¶Šæ¥è¿‘1.0(æ·±çº¢)ï¼Œè¡¨ç¤ºä¸¤ç§‘æˆç»©è¶ŠåŒæ­¥ã€‚</p>
                    <div class="table-wrap" style="box-shadow:none; border:none; margin-top:0;"><table class="heatmap-table" id="corrMatrixTable"><tbody></tbody></table></div>
                </div>
                <div class="bg-gray-50">
                    <h3 style="margin-bottom:15px; color:#333;">âš–ï¸ å­¦ç§‘å¯¹æ€»æ’åè´¡çŒ®åº¦ (åŒºåˆ†åº¦)</h3>
                    <p style="font-size:12px; color:#666; margin-bottom:10px;">æ•°å€¼è¶Šé«˜ï¼Œè¯´æ˜è¯¥å­¦ç§‘è¶Šèƒ½å†³å®šæ€»æ’åçš„ä½æ¬¡ã€‚</p>
                    <div id="contributionChartContainer"></div>
                </div>
            </div>
            <div class="bg-gray-50" style="margin-top:20px;">
                <h3 style="margin-bottom:15px; color:#333;">ğŸ“‰ â€œæåˆ†é¡¹â€ä¸â€œæ‹–åè…¿â€é¢‘ç‡åˆ†æ</h3>
                <div class="table-wrap"><table id="liftDragTable"><thead><tr><th>å­¦ç§‘</th><th>æåˆ†ä¸»åŠ› (å•ç§‘æ’åå‰äºæ€»æ’)</th><th>æ‹–åˆ†ä¸»åŠ› (å•ç§‘æ’ååäºæ€»æ’)</th><th>å¹³è¡¡å‹</th><th>å‡€è´¡çŒ® (æåˆ†-æ‹–åˆ†)</th></tr></thead><tbody></tbody></table></div>
            </div>
        </div>
        
        <!-- ä¸´ç•Œç”Ÿç²¾å‡†è¾…å¯¼ä»»åŠ¡å• -->
        <div id="marginal-push" class="section card-box">
            <div class="module-desc-bar" style="border-color: var(--color-diag)">
                <h3><i class="ti ti-target-arrow"></i> 04 ç²¾å‡†è¯Šæ–­ä¸å¹²é¢„</h3>
                <p>è¯´æ˜ï¼šé¢å‘ä¸€çº¿ç§‘ä»»æ•™å¸ˆã€‚æŒ–æ˜ä¸´ç•Œç”Ÿï¼ˆæ‹Ÿä¼˜ç§€ã€æ‹ŸåŠæ ¼ï¼‰ã€åç§‘ç”Ÿä»¥åŠæˆç»©æ³¢åŠ¨å‰§çƒˆçš„â€œè¿‡å±±è½¦â€å­¦ç”Ÿï¼Œç”Ÿæˆä»»åŠ¡å•å®ç°ç²¾å‡†å¸®æ‰¶ã€‚</p>
            </div>
            <div class="sec-head">
                <h2>
                    <i class="ti ti-target"></i> ä¸´ç•Œç”Ÿç²¾å‡†è¾…å¯¼ä»»åŠ¡å•
                    <span class="module-help-btn" onclick="showModuleHelp('student-diag')">ğŸ“˜ ç­›é€‰é€»è¾‘</span>
                </h2>
                <div>
                    <button class="btn btn-purple" onclick="printMarginalTickets()">ğŸ–¨ æ‰¹é‡æ‰“å°ä»»åŠ¡å•</button>
                    <button class="btn btn-green" onclick="exportMarginalTasks()">ğŸ“Š å¯¼å‡ºExcel</button>
                </div>
            </div>
            
            <div class="info-bar">
                <strong>æ ¸å¿ƒç­–ç•¥ï¼š</strong> ç­›é€‰å‡ºè·ç¦»â€œä¼˜ç§€çº¿â€æˆ–â€œåŠæ ¼çº¿â€ä»…å·® 
                <span style="border-bottom:2px solid var(--primary); font-weight:bold;">Nåˆ†</span> 
                çš„å­¦ç”Ÿï¼Œç”Ÿæˆç§‘ä»»æ•™å¸ˆçš„é‡ç‚¹å…³æ³¨åå•ã€‚
            </div>

            <div class="control-panel" style="background: #fffbeb; border-color: #fcd34d;">
                <div style="display:flex; gap:15px; flex-wrap:wrap; align-items:center;">
                    <div>
                        <label>é€‰æ‹©å­¦æ ¡ï¼š</label><br>
                        <select id="mpSchoolSelect" style="min-width:150px;" onchange="updateMpClassSelect()"><option value="">--è¯·é€‰æ‹©--</option></select>
                    </div>
                    <div>
                        <label>ç­çº§ (å¯é€‰)ï¼š</label><br>
                        <select id="mpClassSelect" style="min-width:100px;"><option value="">å…¨éƒ¨ç­çº§</option></select>
                    </div>
                    <div>
                        <label>å­¦ç§‘ï¼š</label><br>
                        <select id="mpSubjectSelect" style="min-width:100px;"><option value="ALL">å…¨éƒ¨å­¦ç§‘</option></select>
                    </div>
                    <div style="border-left:1px solid #ccc; padding-left:15px;">
                        <label><strong>ğŸ¯ ä¸´ç•Œåˆ†å€¼ (Gap)</strong>ï¼š</label><br>
                        <input type="number" id="mpGap" value="5" style="width:70px; font-weight:bold; color:red;"> åˆ†ä»¥å†…
                    </div>
                    <div>
                        <label>ç›®æ ‡ç±»å‹ï¼š</label><br>
                        <select id="mpType">
                            <option value="both" selected>å…¨éƒ¨ (æ‹Ÿä¼˜+æ‹ŸåŠæ ¼)</option>
                            <option value="pass">ä»…çœ‹ æ‹ŸåŠæ ¼ (ä¿åº•)</option>
                            <option value="exc">ä»…çœ‹ æ‹Ÿä¼˜ç§€ (åŸ¹ä¼˜)</option>
                        </select>
                    </div>
                    <div style="padding-top:16px;">
                        <button class="btn btn-primary" onclick="generateMarginalTickets()">ğŸš€ ç”Ÿæˆè¾…å¯¼å•</button>
                    </div>
                </div>
            </div>

            <!-- é—­ç¯ç®¡ç†ï¼šè½¬åŒ–ç‡è¿½è¸ªé¢æ¿ -->
            <div style="margin:15px 0; background:#f0fdf4; border:1px solid #86efac; border-radius:8px; padding:15px;">
                <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px dashed #bbf7d0; padding-bottom:10px; margin-bottom:10px;">
                    <h3 style="color:#166534; margin:0; font-size:15px;"><i class="ti ti-refresh"></i> ä¸´ç•Œç”Ÿè½¬åŒ–é—­ç¯ç®¡ç† (æ•™å¸ˆè¯„ä»·)</h3>
                    <div style="font-size:12px; color:#15803d;">
                        é€»è¾‘ï¼šä¿å­˜æœ¬æ¬¡ç”Ÿæˆçš„åå•ä¸ºâ€œå†å²ä»»åŠ¡â€ -> ä¸‹æ¬¡è€ƒè¯•å¯¼å…¥æ•°æ® -> è‡ªåŠ¨è®¡ç®—æœ‰å¤šå°‘äººæˆåŠŸâ€œä¸Šçº¿â€
                    </div>
                </div>
                
                <div style="display:flex; gap:20px; flex-wrap:wrap; align-items:center;">
                    <!-- åŠ¨ä½œA: å­˜æ¡£ -->
                    <div style="flex:1; border-right:1px solid #bbf7d0; padding-right:15px;">
                        <div style="font-weight:bold; color:#166534; margin-bottom:5px;">ç¬¬1æ­¥ï¼šå½“å‰ä»»åŠ¡å­˜æ¡£</div>
                        <div style="display:flex; gap:5px;">
                            <input type="text" id="mp_save_name" placeholder="ä»»åŠ¡å (å¦‚:æœŸä¸­ä¸´ç•Œç”Ÿ)" style="padding:5px; border:1px solid #cbd5e1; border-radius:4px; font-size:12px; flex:1;">
                            <button class="btn btn-green btn-sm" onclick="MP_saveSnapshot()">ğŸ’¾ å­˜æ¡£</button>
                        </div>
                    </div>

                    <!-- åŠ¨ä½œB: è¿½è¸ª -->
                    <div style="flex:2;">
                        <div style="font-weight:bold; color:#166534; margin-bottom:5px;">ç¬¬2æ­¥ï¼šè½¬åŒ–æ•ˆæœè¿½è¸ª (éœ€å…ˆä¸Šä¼ æ–°æ•°æ®)</div>
                        <div style="display:flex; gap:10px; align-items:center;">
                            <select id="mp_snapshot_select" style="padding:5px; border:1px solid #cbd5e1; border-radius:4px; font-size:12px; min-width:150px;">
                                <option value="">-- é€‰æ‹©å†å²ä»»åŠ¡ --</option>
                            </select>
                            <button class="btn btn-orange btn-sm" onclick="MP_analyzeConversion()">ğŸ“ˆ è®¡ç®—è½¬åŒ–ç‡</button>
                            <button class="btn btn-gray btn-sm" onclick="MP_deleteSnapshot()"><i class="ti ti-trash"></i></button>
                        </div>
                    </div>
                </div>

                <!-- åˆ†æç»“æœå±•ç¤ºåŒº -->
                <div id="mp-conversion-result" class="hidden" style="margin-top:15px; background:white; padding:10px; border-radius:6px; border:1px solid #e2e8f0;">
                    <div class="sub-header" style="margin-top:0;">ğŸ“Š æ•™å¸ˆè¾…å¯¼æ•ˆèƒ½è¯„ä¼° (åŸºäºè½¬åŒ–ç‡)</div>
                    <div class="table-wrap">
                        <table id="mp_conversion_table" style="font-size:12px;">
                            <thead>
                                <tr>
                                    <th>æ•™å¸ˆ/ç­çº§</th>
                                    <th>å­¦ç§‘</th>
                                    <th>ç›®æ ‡ç±»å‹</th>
                                    <th>è¿½è¸ªäººæ•° (å†å²)</th>
                                    <th>æœ¬æ¬¡ä¸Šçº¿äººæ•°</th>
                                    <th>è½¬åŒ–æˆåŠŸç‡</th>
                                    <th>è¯„ä»·</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ä»»åŠ¡å•é¢„è§ˆåŒº -->
            <div id="mp-tickets-container" class="mp-grid">
                <div style="grid-column:1/-1; text-align:center; padding:50px; color:#94a3b8;">
                    <i class="ti ti-clipboard-list" style="font-size:48px; margin-bottom:10px;"></i>
                    <p>è¯·è°ƒæ•´å‚æ•°åç‚¹å‡»â€œç”Ÿæˆè¾…å¯¼å•â€</p>
                </div>
            </div>
        </div>

        <!-- è€ƒååº§ä½å¾®è°ƒå»ºè®® -->
        <div id="seat-adjustment" class="section card-box">
            <div class="sec-head"><h2><i class="ti ti-armchair"></i> è€ƒåâ€œåº§ä½å¾®è°ƒâ€å»ºè®®</h2></div>
            <div class="info-bar">åŸºäºæœ€è¿‘å‘å±•åŒºç†è®º(ZPD)ä¸å°ç»„åˆä½œå­¦ä¹ æ¨¡å¼ï¼Œç”Ÿæˆä¿ƒè¿›äº’åŠ©çš„åº§ä½è¡¨ã€‚</div>
            
            <!-- [ä¿®æ”¹] è€ƒååº§ä½å¾®è°ƒ - äº¤äº’ä¼˜åŒ–åçš„çº¦æŸæ¡† -->
            <div class="constraints-box">
                <h4><i class="ti ti-alert-triangle"></i> ç‰¹æ®Šæƒ…å†µçº¦æŸé…ç½® (æ™ºèƒ½æ ‡ç­¾è¾“å…¥)</h4>
                <div class="info-bar" style="margin:0 0 10px 0; padding:5px; font-size:11px;">ğŸ’¡ æç¤ºï¼šåœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å§“åï¼Œä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©ã€‚æ•°æ®æºä¸ºå½“å‰é€‰ä¸­çš„ç­çº§ã€‚</div>
                <div class="constraints-grid">
                    <div><label>ğŸ˜¡ éš¾ç®¡/è°ƒçš®:</label><input type="hidden" id="adj_c_diff"><div id="widget_adj_diff" class="tag-widget-container"><input type="text" class="tag-input-field" placeholder="æœå§“å..."><div class="suggestion-dropdown"></div></div></div>
                    <div><label>ğŸ‘“ è§†åŠ›ä¸å¥½ (å‰æ’):</label><input type="hidden" id="adj_c_vision"><div id="widget_adj_vision" class="tag-widget-container"><input type="text" class="tag-input-field" placeholder="æœå§“å..."><div class="suggestion-dropdown"></div></div></div>
                    <div><label>â¤ï¸ å¿ƒç†å…³æ³¨:</label><input type="hidden" id="adj_c_psy"><div id="widget_adj_psy" class="tag-widget-container"><input type="text" class="tag-input-field" placeholder="æœå§“å..."><div class="suggestion-dropdown"></div></div></div>
                    <div><label>ğŸ—£ï¸ çˆ±è¯´è¯:</label><input type="hidden" id="adj_c_talk"><div id="widget_adj_talk" class="tag-widget-container"><input type="text" class="tag-input-field" placeholder="æœå§“å..."><div class="suggestion-dropdown"></div></div></div>
                    <div style="grid-column: 1/-1"><label>âš”ï¸ äº’æœ‰çŸ›ç›¾/é¿å…åŒæ¡Œ (ç”Ÿæˆå™¨):</label><div class="conflict-builder"><select id="conflict_sel_a"><option value="">å­¦ç”Ÿ A</option></select><span>&</span><select id="conflict_sel_b"><option value="">å­¦ç”Ÿ B</option></select><button class="btn btn-gray" style="padding:2px 8px; height:28px;" onclick="addConflictPair('adj')">â• æ·»åŠ </button></div><input type="hidden" id="adj_c_conflict"><div id="widget_adj_conflict" class="tag-widget-container" style="background:#f9fafb;"><span style="font-size:11px; color:#999; padding:4px;">è¯·ä½¿ç”¨ä¸Šæ–¹é€‰æ‹©å™¨æ·»åŠ çŸ›ç›¾å¯¹</span></div></div>
                </div>
            </div>

            <div class="control-panel">
                <div style="flex:2; display:flex; gap:10px; flex-wrap:wrap;">
                    <div><label>å­¦æ ¡ï¼š</label><br><select id="seatAdjSchoolSelect" style="min-width:120px;"><option value="">--è¯·é€‰æ‹©--</option></select></div>
                    <div><label>ç­çº§ï¼š</label><br><select id="seatAdjClassSelect" style="min-width:100px;"><option value="">--ç­çº§--</option></select></div>
                    <div><label>å·¦å³å¤§ç»„æ•° (ä¸­é—´è¿‡é“)ï¼š</label><br><input type="number" id="seatAdjGroups" value="2" min="1" max="4" style="width:60px;" onchange="renderSeatGrid()"></div>
                    <div><label>æ¯ç»„åˆ—æ•°ï¼š</label><br><input type="number" id="seatAdjCols" value="4" min="2" max="6" style="width:60px;" onchange="renderSeatGrid()"></div>
                    <div><label>åˆ†ç»„ç­–ç•¥ï¼š</label><br>
                        <select id="seatAdjStrategy">
                            <option value="conversion">ğŸš€ æåˆ†è½¬åŒ–å‹ (Aå¸¦C, Bå¸¦D)</option>
                            <option value="balanced">âš–ï¸ å›¢é˜ŸPKå‹ (4äººå‡åˆ†å¹³è¡¡)</option>
                            <option value="pair">ğŸ¤ ä¼ ç»Ÿäº’åŠ©å‹ (å¼ºå¼±ç»“å¯¹)</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="generateSeatSuggestions()">ğŸ² ç”Ÿæˆå…±åŒä½“åº§æ¬¡</button>
                <button class="btn btn-purple" onclick="window.print()">ğŸ–¨ æ‰“å°</button>
            </div>
            <div id="seat-adj-workspace" class="seat-workspace hidden" style="margin-top:20px;">
                <div class="seat-tools" style="width:200px;">
                    <h4 style="margin-bottom:10px;">ç­–ç•¥è¯´æ˜</h4>
                    <div id="seat-strategy-desc" style="font-size:12px; color:#666; margin-bottom:15px; padding:10px; background:#e0f2fe; border-radius:6px;">
                        é€‰æ‹©ç­–ç•¥åæŸ¥çœ‹è¯¦ç»†è¯´æ˜...
                    </div>
                    <h4 style="margin-bottom:10px;">å›¾ä¾‹</h4>
                    <div style="font-size:12px; display:flex; flex-direction:column; gap:5px;">
                        <span style="background:#dcfce7; padding:2px 5px; border-radius:4px;">ğŸŸ© å‰25% (Aå±‚:ä¼˜)</span>
                        <span style="background:#e0f2fe; padding:2px 5px; border-radius:4px;">ğŸŸ¦ 25-50% (Bå±‚:è‰¯)</span>
                        <span style="background:#fef9c3; padding:2px 5px; border-radius:4px;">ğŸŸ¨ 50-75% (Cå±‚:æ½œ)</span>
                        <span style="background:#fee2e2; padding:2px 5px; border-radius:4px;">ğŸŸ¥ å25% (Då±‚:åŸº)</span>
                    </div>
                    <div id="seat-stats" style="margin-top:20px; font-size:12px; color:#333; font-weight:bold;"></div>
                </div>
                <div class="seat-canvas" style="min-height:500px;">
                    <div class="seat-stage">è®² å°</div>
                    <div id="seat-count-display" style="margin-bottom:10px; font-weight:bold; color:#666;"></div>
                    <div id="seat-adj-container" class="seat-container" style="position:relative;"></div>
                </div>
            </div>
        </div>
        
        <!-- å­¦ç§‘äº’åŠ©åˆ†ç»„ -->
        <div id="mutual-aid" class="section card-box">
            <div class="sec-head"><h2><i class="ti ti-friends"></i> å­¦ç§‘äº’åŠ©åˆ†ç»„</h2><button class="btn btn-green" onclick="exportMutualAidGroups()">å¯¼å‡ºExcel</button></div>
            <div class="info-bar">
                <strong>ç»„é•¿(å°è€å¸ˆ)é€‰æ‹”æ ‡å‡†ï¼š</strong> 
                â‘  å•ç§‘æˆç»©ç­çº§å‰ <strong>25%</strong>ï¼›
                â‘¡ æ€»åˆ†æˆç»©ç­çº§å‰ <strong>40%</strong> (æ‹’ç»ä¸¥é‡åç§‘ï¼Œç¡®ä¿ç»¼åˆè¾…å¯¼èƒ½åŠ›)ã€‚
            </div>
            <div class="control-panel">
                <div style="flex:1; border-right:1px solid #ccc; padding-right:10px; margin-right:10px;">
                    <label><strong>æ•°æ®æºï¼š</strong></label>
                    <select id="aid_source" style="width:100%; margin-top:5px;" onchange="updateMutualAidSelects()">
                        <option value="upload">ğŸ“Š ä¸Šä¼ çš„è€ƒè¯•æˆç»© (è€ç”Ÿ)</option>
                        <option value="freshman">ğŸš€ æ–°ç”Ÿåˆ†ç­ç»“æœ (æ–°ç”Ÿ)</option>
                    </select>
                </div>
                <div style="flex:2; display:flex; gap:10px; flex-wrap:wrap;">
                    <div><label>å­¦æ ¡ï¼š</label><br><select id="aidSchoolSelect" style="min-width:120px;"><option value="">--è¯·é€‰æ‹©--</option></select></div>
                    <div><label>ç­çº§ï¼š</label><br><select id="aidClassSelect" style="min-width:100px;"><option value="">--ç­çº§--</option></select></div>
                    <div><label>äº’åŠ©å­¦ç§‘ï¼š</label><br><select id="aidSubjectSelect" style="min-width:100px;"><option value="total">æ€»åˆ†(ç»¼åˆ)</option></select></div>
                    <div><label>æ¯ç»„äººæ•°ï¼š</label><br><input type="number" id="aidGroupSize" value="4" min="2" max="8" style="width:60px;"></div>
                </div>
                <button class="btn btn-primary" onclick="renderMutualAidGroups()">âš¡ ç”Ÿæˆåˆ†ç»„</button>
            </div>
            <div id="aid-groups-container" class="aid-grid">
                <div style="grid-column:1/-1; text-align:center; padding:40px; color:#999;">
                    <i class="ti ti-users" style="font-size:48px; margin-bottom:10px;"></i>
                    <p>è¯·é€‰æ‹©ç­çº§å’Œå­¦ç§‘åç‚¹å‡»ç”Ÿæˆ</p>
                </div>
            </div>
        </div>

        <!-- 7. ç­çº§æ¨ªå‘å¯¹æ¯” -->
        <div id="class-comparison" class="section card-box">
            <div class="sec-head">
                <h2>
                    <i class="ti ti-layout-columns"></i> ç­çº§æ¨ªå‘å¯¹æ¯”åˆ†æ
                    <span class="module-help-btn" onclick="showModuleHelp('class-comp')">ğŸ“˜ å…¨æ™¯çŸ©é˜µè¯´æ˜</span>
                </h2>
            </div>
            <div class="info-bar">å¯¹æ¯”åŒä¸€å­¦æ ¡å†…å„ç­çº§çš„å„é¡¹æŒ‡æ ‡ï¼Œç‹¬ç«‹äºæ•™å¸ˆåˆ†æã€‚</div>
            <div class="control-panel">
                <label>é€‰æ‹©å­¦æ ¡ï¼š</label><select id="classCompSchoolSelect" style="min-width:200px;"><option value="">--è¯·é€‰æ‹©--</option></select>
                <button class="btn" onclick="renderClassComparison()">å¼€å§‹å¯¹æ¯”</button>
                <button class="btn btn-green" onclick="exportClassComparisonExcel()">å¯¼å‡ºExcel</button>
                <div style="border-left:1px solid #ccc; padding-left:10px; margin-left:10px; display:flex; gap:5px;">
                    <button class="btn btn-purple" onclick="toggleTableHeatmap('class-comp-results')">ğŸ¨ çƒ­åŠ›å›¾</button>
                    <div style="position:relative;">
                        <button class="btn btn-gray" onclick="toggleColFilterMenu()" id="btn-col-filter">ğŸ‘ï¸ ç­›é€‰å­¦ç§‘</button>
                        <div id="col-filter-popover" class="filter-popover">
                            <!-- JS åŠ¨æ€å¡«å……å¤é€‰æ¡† -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="layout-grid">
                <div class="side-nav">
                    <div class="side-nav-title">å¿«é€Ÿå®šä½</div>
                    <div class="side-nav-link active" onclick="scrollToAnchor('anchor-class-total', this)">ğŸ“Š æ€»åˆ†å¯¹æ¯”</div>
                    <div class="side-nav-link" onclick="toggleSubNav(this)"><span>ğŸ“˜ å•ç§‘è¯¦æƒ…</span><i class="ti ti-chevron-right nav-caret"></i></div>
                    <div id="side-nav-class-subjects" class="side-nav-sub-container"></div>
                </div>
                <div class="content-area" id="class-comp-results"></div>
            </div>
        </div>

        <!-- 8. ç­æƒ…è¯Šæ–­ -->
        <div id="class-diagnosis" class="section card-box">
            <div class="sec-head"><h2><i class="ti ti-activity"></i> ç­æƒ…è¯Šæ–­ (æ ‡å‡†å·®/åˆ†åŒ–åº¦åˆ†æ)</h2><button class="btn btn-green" onclick="exportDiagnosisExcel()">å¯¼å‡ºè¯Šæ–­è¡¨</button></div>
            <div class="info-bar">é€šè¿‡æ ‡å‡†å·®ï¼ˆSDï¼‰åˆ¤æ–­ç­çº§æˆç»©æ˜¯â€œä¸¤æåˆ†åŒ–â€è¿˜æ˜¯â€œæ•´ä½“å‡è¡¡â€ã€‚</div>
            <div class="control-panel">
                <label>å­¦æ ¡ï¼š</label><select id="diagSchoolSelect" style="min-width:200px;"><option value="">--è¯·é€‰æ‹©--</option></select>
                <label style="margin-left:15px;">å­¦ç§‘ï¼š</label><select id="diagSubjectSelect" style="min-width:100px;"><option value="total">æ€»åˆ†</option></select>
                <label style="margin-left:15px;">é—´è·ï¼š</label><input type="number" id="diagStep" value="10" style="width:80px;" placeholder="åˆ†">
                <button class="btn" style="margin-left:15px;" onclick="renderClassDiagnosis()">è¯Šæ–­åˆ†æ</button>
            </div>
            <div id="diagnosis-results"><div style="text-align:center; padding:40px; color:#94a3b8;"><i class="ti ti-chart-bar" style="font-size:48px; display:block; margin-bottom:10px;"></i><p>è¯·é€‰æ‹©å­¦æ ¡å’Œå­¦ç§‘å¼€å§‹è¯Šæ–­</p></div></div>
        </div>

        <!-- 9. åˆ†æ•°æ®µç»Ÿè®¡ -->
        <div id="segment-analysis" class="section card-box">
            <div class="sec-head"><h2><i class="ti ti-chart-histogram"></i> åˆ†æ•°æ®µç»Ÿè®¡åˆ†æ</h2><button class="btn btn-green" onclick="renderSegmentAnalysis()">ç”Ÿæˆç»Ÿè®¡è¡¨</button><button class="btn btn-green" onclick="exportSegmentExcel()">å¯¼å‡ºExcel</button></div>
            <div class="control-panel">
                <label>ç»Ÿè®¡èŒƒå›´ï¼š</label><select id="segSchoolSelect" style="min-width:150px;"><option value="ALL">å…¨ä¹¡é•‡</option></select>
                <label style="margin-left:10px;">å­¦ç§‘ï¼š</label><select id="segSubjectSelect" style="min-width:100px;"><option value="total">æ€»åˆ†</option></select>
                <label style="margin-left:10px;">åˆ†æ®µè·¨åº¦ï¼š</label><input type="number" id="segStep" value="10" style="width:80px;">
            </div>
            <div style="background:white; padding:15px; border:1px solid #e2e8f0; border-radius:8px; margin-bottom:15px; height:350px; position:relative;">
                <canvas id="segmentChart"></canvas>
            </div>
            <div class="table-wrap"><table id="tb-segment"><thead></thead><tbody></tbody></table></div>
        </div>

        <!-- 10. å­¦ç”Ÿè€ƒè¯•æ˜ç»† -->
        <div id="student-details" class="section card-box">
            <div class="module-desc-bar" style="border-color: var(--color-student)">
                <h3><i class="ti ti-users"></i> å­¦ç”Ÿè€ƒè¯•æ˜ç»† <span class="badge" style="background:#16a34a;">â­ æ•™åŠ¡å¸¸ç”¨</span></h3>
                <p><strong>ä¸€å¥è¯ç›®çš„ï¼š</strong>å¿«é€ŸæŸ¥çœ‹å­¦ç”Ÿæ˜ç»†ä¸ç­çº§æˆç»©åˆ—è¡¨ã€‚</p>
                <p><strong>æ¨èé¡ºåºï¼š</strong>æ€»ä½“åˆ†æåè¿›å…¥æœ¬æ¨¡å—è¿›è¡Œç­çº§/å­¦ç”Ÿç­›é€‰ã€‚</p>
            </div>
            <div class="sec-head"><h2><i class="ti ti-users"></i> å­¦ç”Ÿè€ƒè¯•æ˜ç»†</h2><button class="btn" onclick="exportStudentDetails()">å¯¼å‡ºExcel</button></div>
            <div class="control-panel">
                <label>é€‰æ‹©æœ¬æ ¡ï¼š</label><select id="studentSchoolSelect" style="min-width:150px;"><option value="">--è¯·é€‰æ‹©--</option></select>
                <label style="margin-left: 10px;">é€‰æ‹©ç­çº§ï¼š</label><select id="studentClassSelect" style="min-width:120px;"><option value="">å…¨éƒ¨</option></select>
                <span id="classTeacherViewModeWrap" style="display:none; margin-left:10px;">
                    <label>æŸ¥çœ‹æ¨¡å¼ï¼š</label>
                    <select id="classTeacherViewMode" style="min-width:140px;">
                        <option value="class_all">æœ¬ç­å…¨ç§‘</option>
                        <option value="teaching">ä»»æ•™å­¦ç§‘</option>
                    </select>
                </span>
                <button class="btn" onclick="renderStudentDetails()">ç­›é€‰æŸ¥è¯¢</button>
                <button class="btn btn-green" style="margin-left:auto;" onclick="generateMobileLongImage()">
                    <i class="ti ti-photo-scan"></i> ç”Ÿæˆç­çº§æˆç»©é•¿å›¾ (æ‰‹æœºç«¯)
                </button>
                <button class="btn btn-orange" onclick="generateInquiryPackage()">
                    <i class="ti ti-package"></i> ç”Ÿæˆå®¶é•¿æŸ¥åˆ†åŒ… (HTML)
                </button>
                <button class="btn btn-primary" style="background:#0891b2;" onclick="generateClassPPT()">
                    <i class="ti ti-presentation"></i> ç”Ÿæˆç­çº§åˆ†æä¼š PPT
                </button>
            </div>
            
            <!-- ğŸ†• å­¦ç”Ÿå¤šæœŸæˆç»©å¯¹æ¯” -->
            <div id="student-multi-period-compare-section" style="margin:16px 0 14px 0; padding:12px; border:1px solid #e2e8f0; border-radius:8px; background:#f8fafc; display:none;">
                <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; margin-bottom:10px;">
                    <div style="font-weight:600; color:#334155;">ğŸ“Š å­¦ç”Ÿå¤šæœŸæˆç»©å¯¹æ¯”ï¼ˆ2æœŸ/3æœŸï¼‰</div>
                    <div style="display:flex; gap:8px; align-items:center; font-size:12px;">
                        <label>æœŸæ•°ï¼š</label>
                        <select id="studentComparePeriodCount" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px;" onchange="onStudentComparePeriodCountChange()">
                            <option value="2">2æœŸ</option>
                            <option value="3">3æœŸ</option>
                        </select>
                    </div>
                </div>
                <!-- ğŸ” [æƒé™æ§åˆ¶]ï¼šåªæœ‰ç®¡ç†å‘˜ã€å¹´çº§ä¸»ä»»ã€æ•™åŠ¡ä¸»ä»»èƒ½çœ‹åˆ°çš„é€‰æ‹©ç•Œé¢ -->
                <div id="student-compare-admin-controls" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                    <label style="font-size:12px; color:#475569;">å­¦æ ¡ï¼š</label>
                    <select id="studentCompareSchool" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:130px;"></select>
                    <label style="font-size:12px; color:#475569;">ç¬¬1æœŸï¼š</label>
                    <select id="studentCompareExam1" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:180px;"></select>
                    <label style="font-size:12px; color:#475569;">ç¬¬2æœŸï¼š</label>
                    <select id="studentCompareExam2" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:180px;"></select>
                    <span id="studentCompareExam3Wrap" style="display:none;">
                        <label style="font-size:12px; color:#475569; margin-left:2px;">ç¬¬3æœŸï¼š</label>
                        <select id="studentCompareExam3" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:180px;"></select>
                    </span>
                    <button class="btn btn-sm btn-blue" onclick="renderStudentMultiPeriodComparison()">ç”Ÿæˆå…¨æ ¡å­¦ç”Ÿå¯¹æ¯”</button>
                    <button class="btn btn-sm" style="background:#8b5cf6; color:white;" onclick="saveStudentCompareToCloud()" title="ä¿å­˜å¯¹æ¯”ç»“æœåˆ°äº‘ç«¯ï¼Œä¾›è€å¸ˆ/å®¶é•¿æŸ¥çœ‹">â˜ï¸ ä¿å­˜åˆ°äº‘ç«¯</button>
                </div>
                <!-- ğŸ” [æ•™å¸ˆå¯è§]ï¼šæŸ¥çœ‹äº‘ç«¯å¯¹æ¯”å’Œå¯¼å‡ºåŠŸèƒ½ -->
                <div id="student-compare-teacher-controls" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px;">
                    <button class="btn btn-sm" style="background:#06b6d4; color:white;" onclick="viewCloudStudentCompares()" title="æŸ¥çœ‹å·²ä¿å­˜çš„äº‘ç«¯å¯¹æ¯”ç»“æœ">ğŸ“‹ æŸ¥çœ‹äº‘ç«¯å¯¹æ¯”</button>
                    <button class="btn btn-sm btn-green" onclick="exportStudentMultiPeriodComparison()">å¯¼å‡ºExcel</button>
                    <span style="font-size:12px; color:#64748b; margin-left:8px;">æç¤ºï¼šæ•™å¸ˆåªèƒ½æŸ¥çœ‹è‡ªå·±ä»»æ•™ç­çº§çš„å¯¹æ¯”æ•°æ®</span>
                </div>
                <div style="display:flex; gap:8px; align-items:center; margin-top:8px; padding-top:8px; border-top:1px solid #e2e8f0; flex-wrap:wrap;">
                    <label style="font-size:12px; color:#475569;">ğŸ” ç­›é€‰ï¼š</label>
                    <input type="text" id="studentCompareNameInput" placeholder="è¾“å…¥å§“åï¼ˆå¯ç”¨é€—å·åˆ†éš”å¤šä¸ªï¼‰" style="padding:4px 8px; border:1px solid #cbd5e1; border-radius:4px; min-width:180px;" onkeypress="if(event.key==='Enter') filterStudentCompareByName()">
                    <button class="btn btn-sm" onclick="filterStudentCompareByName()">æŸ¥è¯¢å§“å</button>
                    <button class="btn btn-sm" style="background:#10b981; color:white;" onclick="filterByProgress('improve')">åªçœ‹è¿›æ­¥</button>
                    <button class="btn btn-sm" style="background:#ef4444; color:white;" onclick="filterByProgress('decline')">åªçœ‹é€€æ­¥</button>
                    <button class="btn btn-sm btn-gray" onclick="clearStudentCompareFilter()">æ˜¾ç¤ºå…¨éƒ¨</button>
                    <span style="margin-left:auto; display:flex; gap:6px; align-items:center;">
                        <label style="font-size:12px; color:#475569;">æ˜¾ç¤ºï¼š</label>
                        <select id="studentCompareGroupBy" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px;" onchange="toggleGroupDisplay()">
                            <optgroup label="ğŸ“‹ åˆ—è¡¨è§†å›¾">
                                <option value="none">å…¨éƒ¨å­¦ç”Ÿï¼ˆåˆ—è¡¨ï¼‰</option>
                            </optgroup>
                            <optgroup label="ğŸ“ ç­çº§åˆ†ç»„" id="classGroupOptions">
                                <option value="class">æ‰€æœ‰ç­çº§ï¼ˆåˆ†ç»„æ˜¾ç¤ºï¼‰</option>
                            </optgroup>
                        </select>
                        <label style="font-size:12px; color:#475569; margin-left:8px;">æ’åºï¼š</label>
                        <select id="studentCompareSortBy" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px;" onchange="sortStudentCompare()">
                            <option value="class">æŒ‰ç­çº§+å§“å</option>
                            <option value="totalDesc">æŒ‰æœ€è¿‘æ€»åˆ†é™åº</option>
                            <option value="totalAsc">æŒ‰æœ€è¿‘æ€»åˆ†å‡åº</option>
                            <option value="improveDesc">æŒ‰è¿›æ­¥å¹…åº¦é™åº</option>
                            <option value="improveAsc">æŒ‰é€€æ­¥å¹…åº¦é™åº</option>
                            <option value="rankImprove">æŒ‰æ’åæå‡é™åº</option>
                        </select>
                    </span>
                </div>
                <div id="studentCompareHint" style="margin-top:6px; font-size:12px; color:#64748b;">
                    <span id="student-compare-hint-admin">è¯·é€‰æ‹©å­¦æ ¡å’Œ2æœŸæˆ–3æœŸè€ƒè¯•åç”Ÿæˆå¯¹æ¯”ã€‚ç”Ÿæˆåå¯ä¿å­˜åˆ°äº‘ç«¯ï¼Œä¾›è€å¸ˆã€ç­ä¸»ä»»ã€å®¶é•¿ç­‰æŸ¥çœ‹ã€‚</span>
                    <span id="student-compare-hint-teacher" style="display:none;">è¯·ç‚¹å‡»"æŸ¥çœ‹äº‘ç«¯å¯¹æ¯”"æŒ‰é’®æŸ¥çœ‹å·²ä¿å­˜çš„å­¦ç”Ÿå¯¹æ¯”æ•°æ®ã€‚æ‚¨åªèƒ½æŸ¥çœ‹è‡ªå·±ä»»æ•™ç­çº§çš„å­¦ç”Ÿæ•°æ®ã€‚</span>
                </div>
                <div id="studentCompareSummary" style="margin-top:10px;"></div>
                <div id="studentComparePagination" style="margin-top:10px; display:none; padding:8px; background:#f8fafc; border-radius:6px; display:flex; justify-content:space-between; align-items:center; font-size:12px;">
                    <div>
                        <label style="color:#475569;">æ¯é¡µæ˜¾ç¤ºï¼š</label>
                        <select id="studentComparePageSize" style="padding:3px 6px; border:1px solid #cbd5e1; border-radius:4px;" onchange="changePageSize()">
                            <option value="10">10äºº</option>
                            <option value="20" selected>20äºº</option>
                            <option value="30">30äºº</option>
                            <option value="50">50äºº</option>
                            <option value="999999">å…¨éƒ¨</option>
                        </select>
                        <span id="studentComparePaginationInfo" style="margin-left:15px; color:#64748b;"></span>
                    </div>
                    <div id="studentComparePaginationButtons" style="display:flex; gap:5px;"></div>
                </div>
                <div id="studentCompareResult" style="margin-top:10px;"></div>
            </div>
            
            <div class="table-wrap"><table id="studentDetailTable" class="mobile-card-table"><thead><tr><th>å­¦æ ¡</th><th>ç­çº§</th><th>å§“å</th><th>è€ƒå·</th><th>è€ƒåœº</th></tr></thead><tbody></tbody></table></div>
            <div id="mobile-share-render-area" class="mobile-share-container"></div>
        </div>

        <!-- è¿›é€€æ­¥è¿½è¸ªåˆ†æ (ä¿®å¤ç¼ºå¤±æ¨¡å—) -->
        <div id="progress-analysis" class="section card-box">
            <div class="module-desc-bar" style="border-color: var(--color-diag)">
                <h3><i class="ti ti-trending-up"></i> è¿›é€€æ­¥è¿½è¸ªä¸å¢å€¼è¯„ä»· <span class="badge" style="background:#f59e0b;">ğŸ“Š ç­ä¸»ä»»å¿…çœ‹</span></h3>
                <p><strong>ä¸€å¥è¯ç›®çš„ï¼š</strong>å®šä½å­¦ç”Ÿè¿›é€€æ­¥ä¸ç­çº§å¢å€¼æ•ˆæœã€‚</p>
                <p><strong>æ¨èé¡ºåºï¼š</strong>å…ˆä¸Šä¼ å†å²æˆç»©ï¼Œå†è¿›å…¥æœ¬æ¨¡å—çœ‹è¿›æ­¥åˆ†å¸ƒã€‚</p>
            </div>
            <div class="sec-head">
                <h2>
                    <i class="ti ti-trending-up"></i> å­¦ç”Ÿè¿›é€€æ­¥è¿½è¸ªåˆ†æ
                    <span class="module-help-btn" onclick="showModuleHelp('value-added')">ğŸ“˜ å¢å€¼è¯„ä»·</span>
                </h2>
                <div style="display:flex; gap:10px;">
                    <div style="display:flex; border:1px solid #e2e8f0; border-radius:6px; overflow:hidden;">
                        <button class="btn btn-sm active" onclick="switchValueAddedView('school', this)" style="border-radius:0; background:#e0f2fe; color:#0369a1;">æŒ‰å­¦æ ¡çœ‹</button>
                        <button class="btn btn-sm" onclick="switchValueAddedView('class', this)" style="border-radius:0; background:white; color:#64748b;">æŒ‰ç­çº§çœ‹</button>
                    </div>
                    <button class="btn btn-green" onclick="exportValueAddedExcel()">ğŸ“Š å¯¼å‡ºå¢å€¼è¯„ä»·è¡¨</button>
                </div>
            </div>

            <div class="info-bar">
                <span id="va-data-status">âš ï¸ è¯·å…ˆä¸Šä¼ â€œä¸Šæ¬¡è€ƒè¯•â€æ•°æ®ä»¥æ¿€æ´»æ­¤åŠŸèƒ½</span>
                <span style="margin-left:auto; font-size:12px;">æ ¸å¿ƒç®—æ³•ï¼š(å…¥å£æ’å - å‡ºå£æ’å) = å¢å€¼åæ¬¡</span>
            </div>

            <div class="layout-grid">
                <div class="side-nav">
                    <div class="side-nav-title">åŠŸèƒ½è§†å›¾</div>
                    <div class="side-nav-link active" onclick="scrollToAnchor('anchor-va-report', this)">ğŸ“ˆ å¢å€¼æ€§è¯„ä»·æŠ¥è¡¨</div>
                    <div class="side-nav-link" onclick="scrollToAnchor('anchor-va-trend', this)">ğŸ” ä¸ªäººè¿›é€€æ­¥è¿½è¸ª</div>
                </div>
                <div class="content-area">
                    <!-- å¢å€¼è¯„ä»·è¡¨ -->
                    <div id="anchor-va-report" class="anchor-target">
                        <div class="sub-header">ğŸ« æ•™å­¦æ•ˆèƒ½å¢å€¼è¯„ä»·è¡¨ (é›†ä½“)</div>
                        <div class="table-wrap">
                            <table id="tb-value-added">
                                <thead>
                                    <tr>
                                        <th>å•ä½åç§°</th>
                                        <th>åŒ¹é…äººæ•°</th>
                                        <th>å…¥å£å‡ä½ (ä¸Šæ¬¡)</th>
                                        <th>å‡ºå£å‡ä½ (æœ¬æ¬¡)</th>
                                        <th>å¹³å‡å¢å€¼ (åæ¬¡)</th>
                                        <th>è¯„ä»·</th>
                                        <th>æ’å</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ä¸ªäººè¿½è¸ª -->
                    <div id="anchor-va-trend" class="anchor-target" style="margin-top:30px;">
                        <div class="sub-header" style="display:flex; justify-content:space-between; align-items:center;">
                            <span>ğŸ‘¤ å­¦ç”Ÿä¸ªäººè¿›é€€æ­¥è¯¦æƒ…</span>
                            <div style="font-size:12px; font-weight:normal;">
                                <label>å­¦æ ¡ï¼š</label>
                                <!-- ğŸ”¥ å…³é”®ä¿®å¤ç‚¹ï¼šè¿™å°±æ˜¯æŠ¥é”™æ‰¾ä¸åˆ°çš„ ID -->
                                <select id="progressSchoolSelect" style="padding:4px; border:1px solid #ccc; border-radius:4px;" onchange="renderProgressAnalysis()">
                                    <option value="">--è¯·é€‰æ‹©--</option>
                                </select>
                                <label style="margin-left:8px;">å†å²åŸºå‡†ï¼š</label>
                                <select id="progressBaselineSelect" style="padding:4px; border:1px solid #ccc; border-radius:4px; min-width:180px;" onchange="renderProgressAnalysis()">
                                    <option value="">--è¯·é€‰æ‹©å†å²è€ƒè¯•--</option>
                                </select>
                            </div>
                        </div>

                        <div style="margin:12px 0 14px 0; padding:10px; border:1px solid #e2e8f0; border-radius:8px; background:#f8fafc;">
                            <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
                                <div style="font-weight:600; color:#334155;">ğŸ§­ å¤šæœŸå¯¹æ¯” (æ”¯æŒ2æœŸ/3æœŸï¼šæœˆè€ƒ/æœŸä¸­/æœŸæœ«ç­‰ä»»æ„ç»„åˆ)</div>
                                <div style="display:flex; gap:8px; align-items:center; font-size:12px;">
                                    <label>æœŸæ•°ï¼š</label>
                                    <select id="progressComparePeriodCount" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px;" onchange="onProgressComparePeriodCountChange()">
                                        <option value="2">2æœŸ</option>
                                        <option value="3">3æœŸ</option>
                                    </select>
                                </div>
                            </div>
                            <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px;">
                                <label style="font-size:12px; color:#475569;">å¯¹æ¯”å­¦æ ¡ï¼š</label>
                                <select id="progressCompareSchool" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:130px;"></select>
                                <label style="font-size:12px; color:#475569;">ç¬¬1æœŸï¼š</label>
                                <select id="progressCompareExam1" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:180px;"></select>
                                <label style="font-size:12px; color:#475569;">ç¬¬2æœŸï¼š</label>
                                <select id="progressCompareExam2" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:180px;"></select>
                                <span id="progressCompareExam3Wrap" style="display:none;">
                                    <label style="font-size:12px; color:#475569; margin-left:2px;">ç¬¬3æœŸï¼š</label>
                                    <select id="progressCompareExam3" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px; min-width:180px;"></select>
                                </span>
                                <button class="btn btn-sm btn-blue" onclick="renderMultiPeriodComparison()">ç”Ÿæˆå¤šæœŸå¯¹æ¯”</button>
                                <button class="btn btn-sm btn-green" onclick="exportMultiPeriodComparison()">å¯¼å‡ºå¤šæœŸå¯¹æ¯”</button>
                            </div>
                            <div id="multiPeriodCompareHint" style="margin-top:6px; font-size:12px; color:#64748b;">è¯·é€‰æ‹©2æœŸæˆ–3æœŸè€ƒè¯•åç”Ÿæˆã€‚</div>
                            <div id="multiPeriodCompareResult" style="margin-top:10px;"></div>
                        </div>
                        
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:15px; height:300px;">
                            <div style="background:white; border:1px solid #e2e8f0; border-radius:8px; padding:10px; position:relative;">
                                <h4 style="margin:0 0 10px 0; font-size:13px; color:#666;">ğŸ›¤ï¸ æ’åæ•£ç‚¹åˆ†å¸ƒ (ä¸Šæµ®ä¸ºè¿›ï¼Œä¸‹æ²‰ä¸ºé€€)</h4>
                                <div style="height:calc(100% - 30px);"><canvas id="trendChart"></canvas></div>
                            </div>
                            <div style="background:white; border:1px solid #e2e8f0; border-radius:8px; padding:10px; position:relative;">
                                <h4 style="margin:0 0 10px 0; font-size:13px; color:#666;">ğŸŒŠ ç”Ÿæºå±‚çº§æµåŠ¨æ¡‘åŸºå›¾ (A/B/C/Då±‚)</h4>
                                <div style="height:calc(100% - 30px);"><canvas id="sankeyChart"></canvas></div>
                            </div>
                        </div>

                        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:5px; flex-wrap:wrap;">
                            <div style="display:flex; gap:8px; align-items:center; font-size:12px;">
                                <label>ç­›é€‰ï¼š</label>
                                <select id="progressFilterType" style="padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px;" onchange="applyProgressFilter()">
                                    <option value="all">å…¨éƒ¨</option>
                                    <option value="up">ä»…è¿›æ­¥</option>
                                    <option value="down">ä»…é€€æ­¥</option>
                                </select>
                                <label>é˜ˆå€¼(åæ¬¡)</label>
                                <input id="progressFilterThreshold" type="number" value="20" style="width:70px; padding:4px 6px; border:1px solid #cbd5e1; border-radius:4px;" oninput="applyProgressFilter()">
                                <span style="color:#64748b;">ä»…æ˜¾ç¤º |å˜åŒ–| â‰¥ é˜ˆå€¼</span>
                                <button class="btn btn-sm btn-gray" onclick="resetProgressFilter()">é‡ç½®ç­›é€‰</button>
                            </div>
                            <button class="btn btn-sm btn-green" onclick="exportProgressAnalysis()">ğŸ“¥ å¯¼å‡ºä¸ªäººæ˜ç»†</button>
                        </div>
                        <div class="table-wrap">
                            <table id="progressTable" class="mobile-card-table">
                                <thead>
                                    <tr>
                                        <th>ç­çº§</th><th>å§“å</th><th>æœ¬æ¬¡æ€»åˆ†</th><th>æœ¬æ¬¡æ ¡æ’</th><th>ä¸Šæ¬¡æ€»åˆ†</th><th>ä¸Šæ¬¡æ ¡æ’</th><th>è¿›é€€æ­¥</th><th>çŠ¶æ€è¯„ä»·</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 11. ä¸ªæ€§åŒ–æˆç»©å•ç”Ÿæˆå™¨ -->
        <div id="report-generator" class="section card-box">
            <div class="module-desc-bar" style="border-color: var(--color-student)">
                <h3><i class="ti ti-user-heart"></i> 05 å­¦ç”Ÿå‘å±•ä¸å®¶æ ¡æ²Ÿé€š <span class="badge" style="background:#0ea5e9;">ğŸ“Š ç­ä¸»ä»»å¿…çœ‹</span></h3>
                <p><strong>ä¸€å¥è¯ç›®çš„ï¼š</strong>ç”Ÿæˆæˆç»©å•ä¸å®¶é•¿æŸ¥åˆ†ææ–™ã€‚</p>
                <p><strong>æ¨èé¡ºåºï¼š</strong>å®Œæˆåˆ†æåï¼Œç”¨äºç­çº§æ±‡æŠ¥ä¸å®¶æ ¡æ²Ÿé€šã€‚</p>
            </div>
            <div class="sec-head"><h2><i class="ti ti-certificate"></i> ä¸ªæ€§åŒ–æˆç»©å•ç”Ÿæˆå™¨</h2></div>
            <div class="control-panel" style="background:#fff; border-color:var(--primary-light);">
                <label>é€‰æ‹©å­¦æ ¡ï¼š</label><select id="sel-school" style="min-width:150px;"><option>--è¯·å…ˆä¸Šä¼ æ•°æ®--</option></select>
                <label>ç­çº§ï¼š</label><select id="sel-class" style="min-width:120px;"><option>--è¯·å…ˆé€‰æ‹©å­¦æ ¡--</option></select>
            </div>
            <div class="control-panel">
                 <input type="text" id="inp-name" placeholder="æŸ¥è¯¢å•ä¸ªå­¦ç”Ÿå§“å" style="width:120px;">
                 <button class="btn" onclick="doQuery()">æŸ¥è¯¢å•äººæŠ¥å‘Š</button>
                      <button class="btn btn-purple" id="btn-report-cloud-compare" onclick="viewCloudStudentComparesForCurrentStudent()">
                          <i class="ti ti-cloud-search"></i> æŸ¥çœ‹äº‘ç«¯å¯¹æ¯”ï¼ˆæœ¬äººï¼‰
                      </button>
                 <!-- [æ–°å¢] æ‰¹é‡PDFå…¥å£ -->
                 <button class="btn btn-primary" style="margin-left:auto;" onclick="batchGeneratePDF()">
                    <i class="ti ti-files"></i> æ‰¹é‡ç”Ÿæˆå…¨ç­ PDF
                </button>                 
            </div>
            <div id="single-report-result" class="hidden">
                <div style="text-align: right; margin-bottom: 10px; display:flex; justify-content:flex-end; gap:10px;">
                    <!-- [ä¿®æ”¹] æ‰“å°/PDF -->
                    <button class="btn btn-purple" onclick="printSingleReport()">
                        <i class="ti ti-printer"></i> æ‰“å° / å¦å­˜ä¸º PDF
                    </button>
                    <button class="btn btn-blue" onclick="downloadSingleReportPDF()">
                        <i class="ti ti-file-export"></i> ä¸‹è½½PDF
                    </button>
                </div>
                <div id="report-card-capture-area" class="report-card-container"></div>
            </div>
            <div class="sub-header" style="margin-top: 50px;">ğŸ¯ ä¼˜ç§€å’ŒåŠæ ¼è¾¹ç¼˜ç”Ÿåˆ†æ</div>
            <div class="control-panel">
                <label>é€‰æ‹©æœ¬æ ¡ï¼š</label><select id="marginalSchoolSelect" style="min-width:200px;"><option value="">--è¯·é€‰æ‹©--</option></select>
                <button class="btn" onclick="analyzeMarginalStudents()">åˆ†æè¾¹ç¼˜ç”Ÿ</button>
                <button class="btn btn-green" onclick="exportMarginalStudents()">å¯¼å‡ºExcel</button>
            </div>
            <div id="marginal-student-results"></div>
        </div>

        <div id="subject-balance" class="section card-box">
            <div class="module-desc-bar" style="border-color: #059669">
                <h3><i class="ti ti-scale"></i> å­¦ç”Ÿä¼˜åŠ£åŠ¿å­¦ç§‘å¯è§†åŒ–é€è§†</h3>
                <p>è¯´æ˜ï¼šä»¥å…¨é•‡å¹³å‡åˆ†ä¸ºåŸºå‡†ï¼Œç›´è§‚å±•ç¤ºæ¯ä¸ªå­¦ç”Ÿâ€œå¼ºåœ¨å“ªã€å¼±åœ¨å“ªâ€ã€‚ç»¿è‰²ä»£è¡¨ä¼˜åŠ¿ï¼Œçº¢è‰²ä»£è¡¨åŠ£åŠ¿ï¼Œé•¿åº¦ä»£è¡¨ç¨‹åº¦ã€‚</p>
            </div>
            <div class="sec-head">
                <h2><i class="ti ti-activity"></i> ä¼˜åŠ£åŠ¿å­¦ç§‘é€è§†è¡¨</h2>
                <button class="btn btn-green" onclick="SB_exportExcel()">ğŸ“Š å¯¼å‡ºExcel</button>
            </div>
            
            <div class="control-panel">
                <label>é€‰æ‹©å­¦æ ¡ï¼š</label>
                <select id="sbSchoolSelect" style="min-width:150px;">
                    <option value="">--è¯·é€‰æ‹©--</option>
                </select>
                
                <label style="margin-left: 10px;">ç­çº§ï¼š</label>
                <select id="sbClassSelect" style="min-width:120px;">
                    <option value="">å…¨éƒ¨</option>
                </select>

                <label style="margin-left: 10px; border-left:1px solid #ccc; padding-left:10px;">æ’åºä¾æ®ï¼š</label>
                <select id="sbSortBy">
                    <option value="total">æŒ‰æ€»åˆ†é™åº</option>
                    <option value="balance">æŒ‰åç§‘ç¨‹åº¦(æœ€ä¸å‡è¡¡åœ¨å‰)</option>
                </select>

                <button class="btn btn-primary" onclick="SB_renderTable()">ğŸ” å¼€å§‹åˆ†æ</button>
            </div>

            <!-- å›¾ä¾‹è¯´æ˜ -->
            <div style="font-size:12px; margin:10px 0; color:#666; display:flex; gap:15px; align-items:center;">
                <span>å›¾ä¾‹è¯´æ˜ï¼š</span>
                <span style="display:flex; align-items:center;"><div style="width:15px; height:8px; background:#16a34a; margin-right:5px;"></div> ä¼˜åŠ¿ (é«˜äºå‡åˆ†)</span>
                <span style="display:flex; align-items:center;"><div style="width:15px; height:8px; background:#dc2626; margin-right:5px;"></div> åŠ£åŠ¿ (ä½äºå‡åˆ†)</span>
                <span style="color:#94a3b8;">(æ•°å€¼è¡¨ç¤ºä¸å…¨é•‡å¹³å‡åˆ†çš„åˆ†å·®)</span>
            </div>

            <div class="table-wrap">
                <table id="sb-table">
                    <thead>
                        <tr>
                            <th style="width:80px;">å§“å</th>
                            <th style="width:60px;">æ€»åˆ†</th>
                            <th style="width:60px;">é•‡æ’</th>
                            <th>ä¼˜åŠ£åŠ¿åˆ†å¸ƒå›¾ (åŸºå‡†çº¿ï¼šå…¨é•‡å¹³å‡åˆ†)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="4" style="text-align:center; padding:30px; color:#999;">è¯·é€‰æ‹©ç­çº§å¹¶ç‚¹å‡»åˆ†æ</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="card-box" style="border-left:4px solid #f59e0b; background:#fff7ed; margin-top:15px;">
                <div class="sec-head" style="border-bottom-color:#fed7aa; margin-bottom:10px;">
                    <h2 style="color:#9a3412;"><i class="ti ti-cluster"></i> å­¦ç§‘ç˜¸è…¿æ·±åº¦èšç±»</h2>
                    <button class="btn btn-orange" onclick="SB_runCluster()">ğŸ”¬ ç”Ÿæˆèšç±»ä¸è¾…å¯¼ç­–ç•¥</button>
                </div>
                <div style="font-size:12px; color:#7c2d12; margin-bottom:10px;">
                    è¯´æ˜ï¼šä½¿ç”¨ K-Means è‡ªåŠ¨åˆ†ç±»ä¸º<strong>å…¨ç§‘å‡è¡¡å‹ / æ–‡å¼ºç†å¼±å‹ / ç†å¼ºæ–‡å¼±å‹ / å•ç§‘çªå›´å‹</strong>ï¼Œå¹¶ç»™å‡ºè¾…å¯¼ç­–ç•¥æ¨¡æ¿ã€‚
                </div>
                <div id="sb-cluster-results" style="font-size:12px; color:#7c2d12;"></div>
            </div>
        </div>

        <!-- 12. åç§‘æ½œåŠ›ç”ŸæŒ–æ˜ -->
        <div id="potential-analysis" class="section card-box">
            <div class="sec-head">
                <h2>
                    <i class="ti ti-bulb"></i> åç§‘æ½œåŠ›ç”ŸæŒ–æ˜
                    <span class="module-help-btn" onclick="showModuleHelp('student-diag')">ğŸ“˜ æŒ–æ˜åŸç†</span>
                </h2>
                <button class="btn btn-green" onclick="exportPotentialAnalysis()">å¯¼å‡ºåå•</button>
            </div>
            <div class="info-bar"><span class="text-blue">æ ¸å¿ƒé€»è¾‘ï¼š</span> ç­›é€‰å‡º <strong>æ€»åˆ†æ’åé å‰</strong> (å¦‚å‰20%)ï¼Œä½† <strong>å•ç§‘æ’åä¸¥é‡æ»å</strong> (å¦‚50%ä»¥å) çš„å­¦ç”Ÿã€‚</div>
            <div class="control-panel" style="background:#fffbeb; border-color:#fcd34d;">
                <label>èŒƒå›´ï¼š</label><select id="potSchoolSelect" style="min-width:150px;"><option value="ALL">å…¨ä¹¡é•‡</option></select>
                <label style="margin-left:15px;">æ€»åˆ†æ’åå‰ï¼š</label><select id="potTopSelect" style="width:100px;"><option value="0.1">10%</option><option value="0.2" selected>20%</option><option value="0.3">30%</option><option value="0.5">50%</option></select>
                <label style="margin-left:15px;">å•ç§‘æ’ååï¼š</label><select id="potLowSelect" style="width:100px;"><option value="0.3">30%</option><option value="0.4">40%</option><option value="0.5" selected>50%</option><option value="0.6">60%</option><option value="0.8">80%</option></select>
                <button class="btn btn-orange" style="margin-left:15px;" onclick="renderPotentialAnalysis()">ğŸ” ä¸€é”®æŒ–æ˜</button>
            </div>
            <div id="potential-results"><div style="text-align:center; padding:40px; color:#94a3b8;"><i class="ti ti-search" style="font-size:48px; display:block; margin-bottom:10px;"></i><p>è¯·ç‚¹å‡»ä¸Šæ–¹â€œä¸€é”®æŒ–æ˜â€æŒ‰é’®å¼€å§‹åˆ†æ</p></div></div>
        </div>

        <!-- 13. æ–°ç”Ÿåˆ†ç­ & åº§ä½ç¼–æ’ -->
        <div id="freshman-simulator" class="section card-box">
           <div class="sec-head">
                <h2>
                    <i class="ti ti-arrows-split"></i> æ–°ç”Ÿå‡è¡¡åˆ†ç­
                    <span class="module-help-btn" onclick="showModuleHelp('tools')">ğŸ“˜ ç®—æ³•é€»è¾‘</span>
                </h2>
                <div>
                    <button class="btn btn-purple" onclick="FB_saveToLocal()">ğŸ’¾ ä¿å­˜æ–¹æ¡ˆ</button>
                    <button class="btn btn-green" onclick="FB_exportResult()">ğŸ“Š å¯¼å‡ºç»“æœ</button>
                </div>
            </div>
            <div class="control-panel" style="flex-direction: column; align-items: stretch;">
                <div style="display:flex; gap:20px; flex-wrap:wrap; border-bottom:1px dashed #cbd5e1; padding-bottom:15px; margin-bottom:15px;">
                    <div class="upload-box" style="flex:1; padding:20px; min-width:250px;" onclick="document.getElementById('fbFileInput').click()">
                        <div class="upload-icon"><i class="ti ti-file-import"></i></div>
                        <div style="font-weight:bold;">ç‚¹å‡»å¯¼å…¥æ–°ç”Ÿåå• Excel</div>
                        <div style="font-size:12px; color:#64748b;">å¿…éœ€: å§“å,æ€§åˆ«,æ€»åˆ† | å¯é€‰: èº«é«˜,è§†åŠ›,å¤‡æ³¨(å…³ç³»)</div>
                        <input type="file" id="fbFileInput" accept=".xlsx,.xls" hidden onchange="FB_loadData(this)">
                    </div>
                    <div style="flex:2; display:grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap:15px;">
                        <div><label class="stat-label">æ‹Ÿåˆ†ç­çº§æ•°</label><input type="number" id="fb_cls_num" value="6" min="1" max="30" style="width:100%;"></div>
                        <div><label class="stat-label">ç­é¢å¾®è°ƒ</label><select id="fb_cls_size" style="width:100%;"><option value="0">è‡ªåŠ¨å¹³å‡</option><option value="auto">å…è®¸Â±2äºº</option></select></div>
                        <div><label class="stat-label">ç”·å¥³æ§åˆ¶</label><select id="fb_rule_gender" style="width:100%;"><option value="strict">ä¸¥æ ¼å‡è¡¡</option><option value="loose">å…è®¸å·®å¼‚</option></select></div>
                        <div><label class="stat-label">éš¾ç®¡å­¦ç”Ÿ</label><select id="fb_rule_diff" style="width:100%;"><option value="spread">å‡åŒ€åˆ†æ•£ (æ¨è)</option><option value="gather">é›†ä¸­ç®¡ç†</option></select></div>
                        <div><label class="stat-label">æ ¸å¿ƒç®—æ³•</label><select id="fb_algorithm" style="width:100%;"><option value="complex" selected>ğŸ§  ç»¼åˆæ™ºèƒ½ä¼˜åŒ–</option><option value="snake">ğŸ ç»å…¸è›‡å½¢åˆ†ç­</option></select></div>
                    </div>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="font-size:13px; color:#b45309; background:#fffbeb; padding:5px 10px; border-radius:4px;"><i class="ti ti-alert-circle"></i> <strong>æ™ºèƒ½æç¤ºï¼š</strong> ç³»ç»Ÿå°†è‡ªåŠ¨è§£æå¤‡æ³¨åˆ—ä¸­çš„ "å’ŒXXåŒç­"ã€"ä¸XXåˆ†å¼€" ç­‰è‡ªç„¶è¯­è¨€ï¼Œä¼˜å…ˆçº§æœ€é«˜ã€‚</div>
                    <button class="btn btn-primary" style="padding:10px 30px; font-size:16px;" onclick="FB_runDivision()">ğŸš€ å¼€å§‹æ™ºèƒ½åˆ†ç­</button>
                </div>
            </div>
            <div id="fb-results-area" class="hidden">
                <div style="background:white; border-radius:8px; padding:15px; margin-top:20px; border:1px solid #e2e8f0;">
                    <h3 style="margin-bottom:15px; color:#333; font-size:16px;">âš–ï¸ åˆ†ç­å‡è¡¡åº¦è¯Šæ–­ (ç®±çº¿å›¾)</h3>
                    <div style="height:300px; position:relative;">
                        <canvas id="balanceChart"></canvas>
                    </div>
                    <div id="balanceTableContainer" style="margin-top:20px; overflow-x:auto;"></div>
                </div>

                <div class="sub-header" style="margin-top:20px;">ğŸ« åˆ†ç­ç»“æœåˆ—è¡¨ (ç‚¹å‡»ç­çº§å¡ç‰‡è¿›å…¥åº§ä½ç¼–æ’)</div>
                <div class="fb-class-grid" id="fb_class_container"></div>
            </div>
            <div id="fb_seat_view" class="hidden" style="margin-top:30px; border-top:3px solid var(--primary); padding-top:20px; background:#fff;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2 style="color:var(--primary); margin:0;"><i class="ti ti-armchair"></i> <span id="seat_class_title"></span> åº§ä½ç¼–æ’</h2>
                    <button class="btn btn-gray" onclick="document.getElementById('fb_seat_view').classList.add('hidden')">âŒ å…³é—­/è¿”å›</button>
                </div>
                <div class="seat-workspace">
                    <div class="seat-tools">
                        <h4 style="border-bottom:1px solid #e2e8f0; padding-bottom:5px; margin-bottom:10px;">ğŸ›  æ•™å®¤å¸ƒå±€</h4>
                        <div style="margin-bottom:10px;"><label>å·¦å³å¤§ç»„æ•° (ä¸­é—´ä¸ºè¿‡é“):</label><input type="number" id="seat_opt_groups" value="2" min="1" max="4" style="width:60px;" onchange="FB_renderSeatMap()"></div>
                        <div style="margin-bottom:20px;"><label>æ¯ç»„åˆ—æ•°:</label><input type="number" id="seat_opt_cols" value="4" min="1" max="6" style="width:100%;" onchange="FB_renderSeatMap()"></div>
                        
                        <!-- [ä¿®æ”¹] æ–°ç”Ÿåˆ†ç­ - äº¤äº’ä¼˜åŒ–åçš„çº¦æŸæ¡† -->
                        <div class="constraints-box" style="padding:10px;">
                            <h4 style="margin:0 0 10px 0;">ğŸš§ ä¸´æ—¶å¹²é¢„ (æ™ºèƒ½è¾“å…¥)</h4>
                            <div style="font-size:12px; display:flex; flex-direction:column; gap:8px;">
                                <div><label>ğŸ˜¡ éš¾ç®¡:</label><input type="hidden" id="fb_c_diff"><div id="widget_fb_diff" class="tag-widget-container"><input type="text" class="tag-input-field" placeholder="è¾“å…¥å§“å..."><div class="suggestion-dropdown"></div></div></div>
                                <div><label>ğŸ‘“ è§†åŠ›:</label><input type="hidden" id="fb_c_vision"><div id="widget_fb_vision" class="tag-widget-container"><input type="text" class="tag-input-field" placeholder="è¾“å…¥å§“å..."><div class="suggestion-dropdown"></div></div></div>
                                <div><label>ğŸ—£ï¸ è¯´è¯:</label><input type="hidden" id="fb_c_talk"><div id="widget_fb_talk" class="tag-widget-container"><input type="text" class="tag-input-field" placeholder="è¾“å…¥å§“å..."><div class="suggestion-dropdown"></div></div></div>
                                <div><label>âš”ï¸ çŸ›ç›¾:</label><div class="conflict-builder"><select id="fb_conflict_sel_a" style="width:40%"><option value="">A</option></select><span>&</span><select id="fb_conflict_sel_b" style="width:40%"><option value="">B</option></select><button class="btn btn-gray" style="padding:0 5px;" onclick="addConflictPair('fb')">+</button></div><input type="hidden" id="fb_c_conflict"><div id="widget_fb_conflict" class="tag-widget-container" style="background:#f9fafb;"></div></div>
                            </div>
                        </div>

                        <!-- 1. æ–°å¢ï¼šå›ºå®šæ­æ¡£ (ç»‘å®š) ç»„ä»¶ -->
                        <div class="constraints-box" style="padding:10px; margin-top:10px; background:#f0fdf4; border-color:#86efac;">
                            <h4 style="margin:0 0 10px 0; color:#166534;">ğŸ”— å¼ºè¡Œç»‘å®š (å›ºå®šåŒæ¡Œ)</h4>
                            <div style="font-size:12px;">
                                <div class="conflict-builder">
                                    <select id="fb_bind_sel_a" style="width:40%"><option value="">A</option></select>
                                    <span>&</span>
                                    <select id="fb_bind_sel_b" style="width:40%"><option value="">B</option></select>
                                    <button class="btn btn-green" style="padding:0 5px;" onclick="addBindPair('fb')">+</button>
                                </div>
                                <input type="hidden" id="fb_c_bind">
                                <div id="widget_fb_bind" class="tag-widget-container" style="background:#f9fafb;"></div>
                            </div>
                        </div>

                        <!-- 2. æ–°å¢ï¼šå¤šæ–¹æ¡ˆç®¡ç†é¢æ¿ -->
                        <div style="background:#f0fdf4; border:1px solid #86efac; border-radius:6px; padding:10px; margin-bottom:10px; display:flex; gap:10px;">
                            <button class="btn btn-gray" id="btn_undo" onclick="HistoryManager.undo()" disabled style="flex:1;">
                                <i class="ti ti-arrow-back-up"></i> æ’¤é”€
                            </button>
                            <button class="btn btn-gray" id="btn_redo" onclick="HistoryManager.redo()" disabled style="flex:1;">
                                <i class="ti ti-arrow-forward-up"></i> é‡åš
                            </button>
                        </div>
                        <div style="background:#fff; border:1px solid #cbd5e1; border-radius:6px; padding:10px; margin-bottom:15px; margin-top:10px;">
                            <h4 style="border-bottom:1px solid #eee; padding-bottom:5px; margin-bottom:10px;">ğŸ’¾ æ–¹æ¡ˆè®°å¿†</h4>
                            <div style="display:flex; gap:5px; margin-bottom:5px;">
                                <select id="seat_scenario_select" style="flex:1; font-size:12px;" onchange="FB_loadScenario()">
                                    <option value="">-- é€‰æ‹©æ–¹æ¡ˆ --</option>
                                </select>
                            </div>
                            <div style="display:flex; gap:5px;">
                                <button class="btn btn-primary btn-sm" style="flex:1; font-size:12px;" onclick="FB_saveScenario()">ä¿å­˜å½“å‰</button>
                                <button class="btn btn-danger btn-sm" style="width:30px; padding:0;" onclick="FB_deleteScenario()" title="åˆ é™¤é€‰ä¸­"><i class="ti ti-trash"></i></button>
                            </div>
                        </div>

                        <div style="background:#fff; border:1px solid #cbd5e1; border-radius:6px; padding:10px; margin-bottom:15px; margin-top:10px;">
                            <button class="btn btn-gray" style="width:100%; margin-bottom:8px;" onclick="FB_toggleViewRotation()">
                                <i class="ti ti-rotate"></i> åˆ‡æ¢è®²å°è§†è§’ (é»‘æ¿)
                            </button>
                            <div style="font-size:12px; color:#d97706; display:flex; align-items:start; gap:5px;">
                                <i class="ti ti-mouse-2"></i>
                                <span><strong>å³é”®ç‚¹å‡»åº§ä½</strong>å¯é”å®š/è§£é”ã€‚<br>é”å®šåï¼Œä¸€é”®é‡æ’æ—¶ä¸ç§»åŠ¨ä½ç½®ã€‚</span>
                            </div>
                        </div>
                        <h4 style="border-bottom:1px solid #e2e8f0; padding-bottom:5px; margin-bottom:10px;">ğŸ§  æ™ºèƒ½è§„åˆ™</h4>
                        <div style="display:flex; flex-direction:column; gap:8px; font-size:13px;">
                            <label><input type="checkbox" id="rule_s_height" checked> æŒ‰èº«é«˜å‰ä½åé«˜</label><label><input type="checkbox" id="rule_s_vision" checked> è§†åŠ›ä¿æŠ¤ (å‰3æ’)</label><label><input type="checkbox" id="rule_s_gender" checked> ç”·å¥³åŒæ¡Œæ··æ’</label><label><input type="checkbox" id="rule_s_diff" checked> éš¾ç®¡å­¦ç”Ÿâ€œCä½â€ç›‘æ§</label><label><input type="checkbox" id="rule_s_rel" checked> å…³ç³»äº’æ–¥å¼ºåˆ¶åˆ†å¼€</label>
                        </div>
                        <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="FB_autoSeatAlgo()">âœ¨ ä¸€é”®ç”Ÿæˆåº§ä½</button>
                        <button class="btn btn-purple" style="width:100%; margin-top:10px;" onclick="window.print()">ğŸ–¨ æ‰“å°åº§ä½è¡¨</button>
                    </div>
                    <div class="seat-canvas"><div class="seat-stage">è®² å° / é»‘ æ¿</div><div id="seat_map_container" class="seat-container"></div></div>
                </div>
            </div>
        </div>

        <!-- 14. æ™ºèƒ½è€ƒåœºç¼–æ’ -->
        <div id="exam-arranger" class="section card-box">
            <div class="module-desc-bar" style="border-color: var(--color-tools)">
                <h3><i class="ti ti-settings-automation"></i> 06 æ™ºæ…§æ•™åŠ¡äº‹åŠ¡å·¥å…·</h3>
                <p>è¯´æ˜ï¼šè§£å†³æ—¥å¸¸ç¹æ‚æ•™åŠ¡ã€‚åŒ…å«è€ƒåœºæ™ºèƒ½ç¼–æ’ã€è‡ªåŠ¨ç”Ÿæˆæ¡Œè´´ã€æ–°ç”Ÿå‡è¡¡åˆ†ç­ã€åº§ä½è¡¨æ™ºèƒ½æ’åˆ—ï¼ˆè€ƒè™‘è§†åŠ›/èº«é«˜/çŸ›ç›¾ï¼‰ç­‰åŠŸèƒ½ã€‚</p>
            </div>
            <div class="sec-head"><h2><i class="ti ti-id-badge-2"></i> æ™ºèƒ½è€ƒåœºç¼–æ’å™¨</h2><div><button class="btn btn-green" onclick="EXAM_exportResult()">ğŸ“Š å¯¼å‡ºè€ƒåŠ¡Excel</button><button class="btn btn-orange" onclick="EXAM_generateDeskLabels()">ğŸ·ï¸ æ‰¹é‡æ‰“å°æ¡Œè´´</button><button class="btn btn-purple" onclick="window.print()">ğŸ–¨ æ‰¹é‡æ‰“å°æ¡Œè´´</button></div></div>
            <div class="control-panel" style="flex-direction: column; align-items: stretch;">
                <div style="display:flex; gap:20px; flex-wrap:wrap; margin-bottom:15px; padding-bottom:15px; border-bottom:1px dashed #e2e8f0;">
                    <div class="upload-box" style="flex:1; padding:20px; min-width:250px;" onclick="document.getElementById('examFileInput').click()">
                        <div class="upload-icon"><i class="ti ti-file-certificate"></i></div>
                        <div style="font-weight:bold;">å¯¼å…¥æœ¬æ¬¡è€ƒè¯•å­¦ç”Ÿåå•</div>
                        <div style="font-size:12px; color:#64748b;">è‡ªåŠ¨è¯†åˆ«å§“å/ç­çº§/æ€»åˆ†(è‡ªåŠ¨æŒ‰åˆ†æ’åº)</div>
                        <input type="file" id="examFileInput" accept=".xlsx,.xls" hidden onchange="EXAM_loadData(this)">
                    </div>
                   <div style="flex:1; display:grid; grid-template-columns: 1fr 1fr; gap:15px; background:#f8fafc; padding:10px; border-radius:8px;">
                <div style="display:flex; flex-direction:column; gap:8px;">
                    <div><label style="width:80px;font-weight:bold;">è€ƒå·å‰ç¼€ï¼š</label><input type="text" id="exam_prefix" value="202501" style="width:100px;"></div>
                    <div><label style="width:80px;font-weight:bold;">æ¯åœºäººæ•°ï¼š</label><input type="number" id="exam_seats_per_room" value="30" style="width:100px;"></div>
                </div>
                <div style="display:flex; flex-direction:column; gap:8px;">
                    <label style="cursor:pointer; display:flex; align-items:center;">
                        <input type="checkbox" id="exam_opt_separate" checked> 
                        <span style="margin-left:5px;">ğŸ”€ <b>åŒç­äº’æ–¥</b> (é˜²ä½œå¼Š)</span>
                    </label>
                    <label style="cursor:pointer; display:flex; align-items:center;">
                        <input type="checkbox" id="exam_opt_snake"> 
                        <span style="margin-left:5px;">ğŸ <b>Så‹è›‡å½¢æ’åˆ—</b> (åº§ä½å·)</span>
                    </label>
                </div>
                <button class="btn btn-primary" style="grid-column: 1/-1; margin-top:5px;" onclick="EXAM_generate()">
                    ğŸš€ æ™ºèƒ½ç”Ÿæˆè€ƒåœºå®‰æ’
                </button>
            </div>
                </div>
                <div id="exam-results-area" class="hidden">
                    <div class="nav-sub-items" style="margin-bottom:15px; background:#f1f5f9; border-radius:6px; border:none;">
                        <div class="nav-link active" onclick="EXAM_switchView('overview', this)">ğŸ‘€ è€ƒåœºæ¦‚è§ˆ</div>
                        <div class="nav-link" onclick="EXAM_switchView('setup', this)">ğŸ‘¨â€ğŸ« äººå‘˜é…ç½®</div>
                        <div class="nav-link" onclick="EXAM_switchView('students', this)">ğŸ“‹ è€ƒç”ŸæŸ¥è¯¢è¡¨</div>
                        <div class="nav-link" onclick="EXAM_switchView('proctor', this)">ğŸ‘® ç›‘è€ƒæ±‡æ€»è¡¨</div>
                    </div>
                    <div id="exam-view-overview">
                        <div class="info-bar">ğŸ’¡ ç‚¹å‡»è€ƒåœºå¡ç‰‡å¯æŸ¥çœ‹è¯¥è€ƒåœºçš„è¯¦ç»†åº§æ¬¡è¡¨ã€‚æ‰“å°æ—¶ä¼šè‡ªåŠ¨åˆ†é¡µã€‚</div>
                        <div id="exam_room_grid" class="exam-room-grid"></div>
                    </div>
                    <div id="exam-view-students" class="hidden">
                         <div class="table-wrap"><table id="exam_student_table"><thead><tr><th>è€ƒå·</th><th>å§“å</th><th>ç­çº§</th><th>è€ƒåœºå·</th><th>åº§å·</th><th>ä¸Šæ¬¡æˆç»©</th></tr></thead><tbody></tbody></table></div>
                    </div>
                    <div id="exam-view-setup" class="hidden">
                        <div class="info-bar">ä¾æ®ã€æ•°æ®ä¸­å¿ƒã€‘å¯¼å…¥çš„æ•™å¸ˆä¿¡æ¯ï¼Œè¯·å‹¾é€‰ä¸åœ¨è€ƒåŠ¡åå•çš„äººå‘˜ï¼Œå¹¶åˆ†é…ç‰¹æ®Šè§’è‰²ã€‚</div>
                        <div class="proctor-setup-grid">
                            <!-- æ•™å¸ˆé»‘åå• -->
                            <div>
                                <span class="role-label"><i class="ti ti-user-x"></i> 1. æ’é™¤ä¸å‚åŠ ç›‘è€ƒçš„äººå‘˜ (å‹¾é€‰)</span>
                                <div id="proctor-teacher-pool" class="teacher-scroll-list">
                                    <!-- åŠ¨æ€åŠ è½½æ•™å¸ˆ -->
                                    <div style="color:#999; padding:20px; grid-column: 1/-1;">è¯·å…ˆå¯¼å…¥æ•™å¸ˆä¿¡æ¯...</div>
                                </div>
                            </div>
                            <!-- è§’è‰²åˆ†é… -->
                            <div>
                                <span class="role-label"><i class="ti ti-users"></i> 2. æŒ‡å®šç‰¹æ®Šå²—ä½ (å¤šé€‰/æŒ‰ä½Ctrl)</span>
                                <div class="role-group">
                                    <label class="role-label">âš–ï¸ çºªå¾‹å·¡è€ƒ/æ ¡çº§å·¡æŸ¥</label>
                                    <select id="proctor-role-patrol" class="role-select" multiple></select>
                                </div>
                                <div class="role-group" style="border-left: 4px solid #10b981;">
                                    <label class="role-label">ğŸ§¹ å«ç”Ÿè€ƒåŠ¡/åå‹¤ä¿éšœç»„</label>
                                    <select id="proctor-role-affairs" class="role-select" multiple></select>
                                </div>
                                <button class="btn btn-primary" style="width:100%; margin-top:10px;" onclick="EXAM_assignProctors()">
                                    ğŸš€ ä¸€é”®ç¼–æ’ç›‘è€ƒè¡¨ (2äºº/ç­)
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="exam-view-proctor" class="hidden">
                        <div class="table-wrap"><table id="exam_proctor_table" class="proctor-table"><thead><tr><th>è€ƒåœº</th><th>äººæ•°</th><th>èµ·æ­¢è€ƒå·</th><th>ç›‘è€ƒå‘˜ç­¾å­—</th><th>å·¡è€ƒå‘˜ç­¾å­—</th></tr></thead><tbody></tbody></table></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="grade-scheduler" class="section card-box">
            <div class="module-desc-bar" style="border-color: #7c3aed">
                <h3><i class="ti ti-calendar-time"></i> ä¸‹ä¸€å¹´çº§éƒ¨æ’è¯¾ç³»ç»Ÿ</h3>
                <p>è¯´æ˜ï¼šç‹¬ç«‹äºå½“å‰æˆç»©æ•°æ®ã€‚ç”¨äºæ–°å­¦æœŸæ’è¯¾ï¼Œæ”¯æŒè‡ªå®šä¹‰è¯¾æ—¶ç»“æ„ã€åˆå ‚è¯¾ã€æ—©æ™šè‡ªä¹ ç‰¹å®šè§„åˆ™ä»¥åŠæ•™å¸ˆå‡è¡¡æ’ç­ã€‚</p>
            </div>
            
            <div class="sec-head">
                <h2><i class="ti ti-layout-grid"></i> çº§éƒ¨æ™ºèƒ½æ’è¯¾</h2>
                <div>
                    <button class="btn btn-purple" onclick="SCHEDULER.exportResult()">ğŸ“¥ å¯¼å‡ºè¯¾è¡¨(Excel)</button>
                    <button class="btn btn-orange" onclick="document.getElementById('schedulerImportFile').click()">ğŸ“¤ å¯¼å…¥å·²æœ‰è¯¾è¡¨ä¼˜åŒ–</button>
                    <button class="btn btn-gray" onclick="SCHEDULER.auditFatigue()">ğŸ§  AIç–²åŠ³å®¡è®¡</button>
                    <input type="file" id="schedulerImportFile" accept=".xlsx,.xls" hidden onchange="SCHEDULER.importExisting(this)">
                </div>
            </div>

            <!-- 1. åŸºç¡€é…ç½®é¢æ¿ -->
            <div class="control-panel" style="display:block;">
                <h4 style="margin-bottom:10px; border-bottom:1px dashed #ccc; padding-bottom:5px;">âš™ï¸ è¯¾æ—¶ç»“æ„é…ç½®</h4>
                <div style="display:flex; gap:15px; flex-wrap:wrap; margin-bottom:15px;">
                    <div>
                        <label class="stat-label">ä¸ŠåˆèŠ‚æ•°</label>
                        <input type="number" id="sch_am_count" value="4" style="width:60px;">
                    </div>
                    <div>
                        <label class="stat-label">ä¸‹åˆèŠ‚æ•°</label>
                        <input type="number" id="sch_pm_count" value="4" style="width:60px;">
                    </div>
                    <div>
                        <label class="stat-label">æ™šè‡ªä¹ èŠ‚æ•°</label>
                        <input type="number" id="sch_eve_count" value="3" style="width:60px;">
                    </div>
                    <div style="border-left:1px solid #ccc; padding-left:15px;">
                        <label class="stat-label">å•èŠ‚æ—¶é•¿(åˆ†)</label>
                        <input type="number" id="sch_dur_class" value="45" style="width:60px;">
                    </div>
                    <div>
                        <label class="stat-label">è¯¾é—´æ—¶é•¿(åˆ†)</label>
                        <input type="number" id="sch_dur_break" value="10" style="width:60px;">
                    </div>
                    <div>
                        <label class="stat-label">å¤§è¯¾é—´ä½ç½®</label>
                        <select id="sch_big_break_pos" style="width:100px;">
                            <option value="2">ç¬¬2èŠ‚å</option>
                            <option value="3">ç¬¬3èŠ‚å</option>
                        </select>
                    </div>
                </div>

                <h4 style="margin-bottom:10px; border-bottom:1px dashed #ccc; padding-bottom:5px;">ğŸš§ å¸¸è§„è§„åˆ™çº¦æŸ</h4>
                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:10px; font-size:13px;">
                    <label><input type="checkbox" id="sch_rule_fri_eve" checked> å‘¨äº”æ™šä¸Šä¸ä¸Šè¯¾</label>
                    <label><input type="checkbox" id="sch_rule_fri_pm" onchange="document.getElementById('sch_fri_pm_val').disabled=!this.checked"> å‘¨äº”ä¸‹åˆä»…ä¸Š <input type="number" id="sch_fri_pm_val" value="2" style="width:40px; padding:0;" disabled> èŠ‚</label>
                    <label><input type="checkbox" id="sch_rule_morning_read" checked> æ·»åŠ  [07:00] å°æ™¨è¯»+æ—©è¯»</label>
                    <label><input type="checkbox" id="sch_rule_noon_write" checked> æ·»åŠ  [13:30] åˆé—´ç»ƒå­—/åˆå”±</label>
                    <div style="grid-column: 1/-1; background:#fff; padding:8px; border:1px solid #eee; border-radius:4px;">
                        <strong>ğŸ”— åˆå ‚/è¿å ‚è§„åˆ™ (æ™šè‡ªä¹ ):</strong><br>
                        <select id="sch_combined_slot" style="margin-top:5px;">
                            <option value="eve_3">æ™šè‡ªä¹ ç¬¬3èŠ‚</option>
                            <option value="eve_all">æ•´ä¸ªæ™šè‡ªä¹ </option>
                        </select>
                        <span style="color:#666;"> å¿…é¡»ç”±åŒä¸€è€å¸ˆè·¨ç­è¿ä¸Š (å¦‚: 1,2,3ç­åˆå ‚)</span>
                    </div>
                </div>
            </div>

            <!-- 2. èµ„æºå¯¼å…¥ -->
            <div style="display:flex; gap:20px; margin-top:20px;">
                <div class="upload-box" style="flex:1; min-height:150px; padding:20px;" onclick="document.getElementById('schTeacherFile').click()">
                    <div class="upload-icon"><i class="ti ti-users"></i></div>
                    <div style="font-weight:bold;">å¯¼å…¥æ–°å­¦æœŸæ•™å¸ˆä»»è¯¾è¡¨ (Excel)</div>
                    <div style="font-size:12px; color:#64748b;">
                        å¿…éœ€åˆ—: [æ•™å¸ˆå§“å] [å­¦ç§‘] [ä»»æ•™ç­çº§] [å‘¨è¯¾æ—¶é‡]<br>
                        (ä¾‹å¦‚: å¼ ä¸‰ | è¯­æ–‡ | 701,702 | 12)
                    </div>
                    <input type="file" id="schTeacherFile" accept=".xlsx,.xls" hidden onchange="SCHEDULER.loadData(this)">
                </div>
                
                <div style="flex:2; background:#f8fafc; border:1px solid #e2e8f0; border-radius:8px; padding:15px; max-height:200px; overflow-y:auto;">
                    <div style="display:flex; justify-content:space-between;">
                        <h4 style="margin:0;">ğŸ“‹ å¾…æ’è¯¾ç¨‹èµ„æºé¢„è§ˆ</h4>
                        <button class="btn btn-sm btn-green" onclick="SCHEDULER.downloadTemplate()"><i class="ti ti-download"></i> ä¸‹è½½ä»»è¯¾æ¨¡æ¿</button>
                    </div>
                    <div id="sch_resource_preview" style="margin-top:10px; font-size:12px; color:#666;">
                        è¯·å…ˆä¸Šä¼  Excel æ–‡ä»¶...
                    </div>
                </div>
            </div>

            <!-- 3. åŠ¨æ€çº¦æŸé…ç½®åŒº (æ ¸å¿ƒä¿®æ”¹) -->
            <div class="constraints-box" style="margin-top:20px; background:#fff; border:1px solid #e2e8f0; box-shadow:0 4px 6px rgba(0,0,0,0.02);">
                <h4 style="color:#4f46e5; border-bottom:1px solid #eee; padding-bottom:8px; margin-bottom:15px;">
                    <i class="ti ti-adjustments-alt"></i> æ’è¯¾è§„åˆ™ä¸ç‰¹æ®Šçº¦æŸ (åŠ¨æ€é…ç½®)
                </h4>
                
                <div class="constraints-grid" style="grid-template-columns: 1fr 1fr; gap:20px;">

                    <!-- 0. æ™šè‡ªä¹ åˆå ‚/è¿å ‚è§„åˆ™ (æ›¿æ¢äº†åŸæ¥çš„ç®€å•ä¸‹æ‹‰æ¡†) -->
                    <div style="grid-column: 1/-1; background:#fff7ed; padding:10px; border-radius:6px; border:1px solid #fdba74;">
                        <label style="font-weight:bold; color:#9a3412; margin-bottom:5px; display:block;">
                            ğŸ”— æ™šè‡ªä¹ åˆå ‚è§„åˆ™ (æŒ‡å®šå­¦ç§‘ + æ•™å¸ˆæ‰€æœ‰ç­çº§è¿ä¸Š)
                        </label>
                        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:5px;">
                            <span style="font-size:12px; color:#666;">å°†åœ¨:</span>
                            <select id="sch_comb_slot" style="width:120px; padding:4px; border:1px solid #fed7aa;">
                                <option value="eve_3">æ™šè‡ªä¹ ç¬¬3èŠ‚</option>
                                <option value="eve_2">æ™šè‡ªä¹ ç¬¬2èŠ‚</option>
                                <option value="eve_1">æ™šè‡ªä¹ ç¬¬1èŠ‚</option>
                            </select>
                            
                            <span style="font-size:12px; color:#666;">å…è®¸åˆå ‚çš„å­¦ç§‘:</span>
                            <select id="sch_comb_subject" style="width:100px; padding:4px; border:1px solid #fed7aa;">
                                <option value="ç‰©ç†">ç‰©ç†</option>
                                <option value="åŒ–å­¦">åŒ–å­¦</option>
                                <option value="ç”Ÿç‰©">ç”Ÿç‰©</option>
                                <option value="æ”¿æ²»">æ”¿æ²»</option>
                                <option value="å†å²">å†å²</option>
                                <option value="åœ°ç†">åœ°ç†</option>
                                <option value="è¯­æ–‡">è¯­æ–‡</option>
                                <option value="æ•°å­¦">æ•°å­¦</option>
                                <option value="è‹±è¯­">è‹±è¯­</option>
                            </select>
                            
                            <button class="btn btn-sm" style="background:#ea580c; color:white;" onclick="SCHEDULER.addConstraint('combined')">
                                <i class="ti ti-link"></i> æ·»åŠ è§„åˆ™
                            </button>
                        </div>
                        <div id="sch_tags_combined" class="tag-widget-container" style="min-height:35px; background:white; border-color:#fed7aa;"></div>
                        <div style="font-size:11px; color:#c2410c; margin-top:4px;">
                            â„¹ï¸ é€»è¾‘ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨å¯»æ‰¾è¯¥å­¦ç§‘æ•™å¤šä¸ªç­çš„è€å¸ˆï¼Œå°è¯•åœ¨å‘¨ä¸€è‡³å‘¨äº”çš„æŒ‡å®šæ—¶æ®µï¼Œå®‰æ’å…¶æ‰€æœ‰ç­çº§ä¸€èµ·ä¸Šè¯¾ã€‚
                        </div>
                    </div>
                    
                    <!-- 1. ç­ä¼šè®¾ç½® (æ”¯æŒå¤šæ¬¡) -->
                    <div style="background:#f8fafc; padding:10px; border-radius:6px; border:1px solid #e2e8f0;">
                        <label style="font-weight:bold; color:#333; margin-bottom:5px; display:block;">ğŸ« ç­ä¼š/å›ºå®šå…¨æ ¡æ´»åŠ¨</label>
                        <div style="display:flex; gap:5px; margin-bottom:5px;">
                            <select id="sch_meet_day" style="width:80px; padding:4px;">
                                <option value="1">å‘¨ä¸€</option><option value="2">å‘¨äºŒ</option><option value="3">å‘¨ä¸‰</option><option value="4">å‘¨å››</option><option value="5" selected>å‘¨äº”</option>
                            </select>
                            <select id="sch_meet_slot" style="flex:1; padding:4px;">
                                <option value="pm_3">ä¸‹åˆç¬¬3èŠ‚</option><option value="pm_4">ä¸‹åˆç¬¬4èŠ‚</option><option value="eve_1">æ™šè‡ªä¹ ç¬¬1èŠ‚</option>
                            </select>
                            <button class="btn btn-sm btn-primary" onclick="SCHEDULER.addConstraint('meeting')">â• æ·»åŠ </button>
                        </div>
                        <!-- åŠ¨æ€æ ‡ç­¾å®¹å™¨ -->
                        <div id="sch_tags_meeting" class="tag-widget-container" style="min-height:35px; background:white;"></div>
                    </div>

                    <!-- 2. æ•™å¸ˆç¦æ’ (å¼€ä¼š/è¯·å‡) -->
                    <div style="background:#fffbeb; padding:10px; border-radius:6px; border:1px solid #fcd34d;">
                        <label style="font-weight:bold; color:#b45309; margin-bottom:5px; display:block;">ğŸš« æ•™å¸ˆç¦æ’/å¼€ä¼š (ä¸æ’è¯¾)</label>
                        <div style="display:flex; gap:5px; margin-bottom:5px;">
                            <select id="sch_busy_day" style="width:70px; padding:4px;">
                                <option value="1">å‘¨ä¸€</option><option value="5">å‘¨äº”</option><option value="3">å‘¨ä¸‰</option>
                            </select>
                            <input type="text" id="sch_busy_slots" placeholder="èŠ‚æ¬¡(å¦‚: 1,2 æˆ– am_1)" style="width:100px; padding:4px;">
                            <input type="text" id="sch_busy_name" placeholder="æ•™å¸ˆå§“å" style="flex:1; padding:4px;">
                            <button class="btn btn-sm btn-orange" onclick="SCHEDULER.addConstraint('busy')">â• æ·»åŠ </button>
                        </div>
                        <div id="sch_tags_busy" class="tag-widget-container" style="min-height:35px; background:white;"></div>
                    </div>

                    <!-- 3. æ•™ç ”æ´»åŠ¨/åŠå¤©æ— è¯¾ -->
                    <div style="grid-column: 1/-1; background:#f0fdf4; padding:10px; border-radius:6px; border:1px solid #86efac;">
                        <label style="font-weight:bold; color:#166534; margin-bottom:5px; display:block;">ğŸ—“ï¸ æ•™ç ”ç»„æ´»åŠ¨ / åŠå¤©æ— è¯¾ (æ‰¹é‡é”æ­»)</label>
                        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:5px;">
                            <select id="sch_act_day" style="width:80px; padding:4px;">
                                <option value="3">å‘¨ä¸‰</option><option value="1">å‘¨ä¸€</option><option value="2">å‘¨äºŒ</option><option value="4">å‘¨å››</option><option value="5">å‘¨äº”</option>
                            </select>
                            <select id="sch_act_range" style="width:120px; padding:4px;">
                                <option value="pm_all">æ•´ä¸ªä¸‹åˆ</option>
                                <option value="am_all">æ•´ä¸ªä¸Šåˆ</option>
                                <option value="custom">æŒ‡å®šèŠ‚æ¬¡â†’</option>
                            </select>
                            <input type="text" id="sch_act_custom_slots" placeholder="å¦‚: 6,7,8" style="width:80px; padding:4px; display:none;">
                            
                            <span>å¯¹è±¡:</span>
                            <select id="sch_act_subject" style="width:100px; padding:4px;">
                                <option value="ALL">å…¨çº§éƒ¨(æ— è¯¾)</option>
                                <option value="è¯­æ–‡">è¯­æ–‡ç»„</option><option value="æ•°å­¦">æ•°å­¦ç»„</option><option value="è‹±è¯­">è‹±è¯­ç»„</option>
                                <option value="ç‰©ç†">ç‰©ç†ç»„</option><option value="åŒ–å­¦">åŒ–å­¦ç»„</option><option value="æ”¿æ²»">æ”¿æ²»ç»„</option>
                            </select>
                            <button class="btn btn-sm btn-green" onclick="SCHEDULER.addConstraint('activity')">â• æ·»åŠ æ´»åŠ¨</button>
                        </div>
                        <div id="sch_tags_activity" class="tag-widget-container" style="min-height:35px; background:white;"></div>
                    </div>
                </div>
                
                <div style="font-size:11px; color:#666; margin-top:5px; padding-left:5px;">
                    ğŸ’¡ æç¤ºï¼šæ•™å¸ˆç¦æ’æ”¯æŒè¾“å…¥ "ä¸Šåˆ"ã€"ä¸‹åˆ" æˆ–å…·ä½“æ•°å­— "1,2"ï¼›å…¨çº§éƒ¨æ— è¯¾ä¼šè‡ªåŠ¨è·³è¿‡æ’è¯¾ã€‚
                </div>
            </div>

            <div style="margin-top:20px; text-align:center;">
                <button class="btn btn-primary" style="padding:12px 30px; font-size:16px;" onclick="SCHEDULER.run()">
                    ğŸš€ å¼€å§‹æ™ºèƒ½æ’è¯¾
                </button>
            </div>

            <!-- 4. ç»“æœå±•ç¤º -->
            <div id="sch_result_area" class="hidden" style="margin-top:20px;">
                <div class="sub-header">ğŸ“… æ’è¯¾ç»“æœé¢„è§ˆ (ç‚¹å‡»å•å…ƒæ ¼å¯å¾®è°ƒ)</div>
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <select id="sch_view_mode" onchange="SCHEDULER.renderTable()">
                        <option value="class">æŒ‰ç­çº§æŸ¥çœ‹</option>
                        <option value="teacher">æŒ‰æ•™å¸ˆæŸ¥çœ‹</option>
                    </select>
                    <select id="sch_view_target" onchange="SCHEDULER.renderTable()">
                        <!-- åŠ¨æ€å¡«å……ç­çº§æˆ–æ•™å¸ˆå -->
                    </select>
                </div>
                <div class="table-wrap">
                    <table id="sch_table" style="text-align:center; font-size:12px;">
                        <!-- JS æ¸²æŸ“ -->
                    </table>
                </div>
            </div>

            <!-- 5. AI ç–²åŠ³å®¡è®¡ -->
            <div id="sch_audit_area" class="hidden" style="margin-top:12px; background:#f8fafc; border:1px solid #e2e8f0; border-radius:8px; padding:12px;">
                <div class="sub-header">ğŸ§  æ’è¯¾ç–²åŠ³å®¡è®¡ç»“æœ</div>
                <div id="sch_audit_summary" style="font-size:12px; color:#64748b; margin-bottom:6px;"></div>
                <div id="sch_audit_list" class="tag-widget-container" style="min-height:40px; background:white;"></div>
            </div>
        </div>

        <div id="poster-generator" class="section card-box">
            <div class="sec-head">
                <h2><i class="ti ti-photo-star"></i> å–œæŠ¥/çº¢æ¦œç”Ÿæˆå™¨</h2>
                <div class="control-panel" style="margin-bottom:0; padding:5px; border:none; background:none;">
                    <button class="btn btn-purple" onclick="downloadPoster()">â¬‡ï¸ ä¿å­˜å›¾ç‰‡</button>
                </div>
            </div>
            
            <div class="poster-workspace">
                <!-- å·¦ä¾§ï¼šæ§åˆ¶å™¨ -->
                <div class="poster-controls">
                    <h4 style="margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">ğŸ¨ 1. é€‰æ‹©ä¸»é¢˜</h4>
                    <div class="thumb-select">
                        <div class="thumb-btn active" onclick="setPosterTheme('red', this)">ğŸ§§ å¤§çº¢å–œæŠ¥</div>
                        <div class="thumb-btn" onclick="setPosterTheme('blue', this)">ğŸ“˜ æ¸…çˆ½è“è°ƒ</div>
                        <div class="thumb-btn" onclick="setPosterTheme('tech', this)">ğŸ¤– èµ›åšç§‘æŠ€</div>
                    </div>

                    <h4 style="margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px; margin-top:20px;">ğŸ“Š 2. æ•°æ®æ¥æº</h4>
                    <div style="margin-bottom:10px;">
                        <label style="font-size:12px;">å­¦æ ¡ï¼š</label>
                        <select id="posterSchoolSelect" style="width:100%; margin-bottom:5px;" onchange="updatePosterClassSelect()">
                            <option value="">--è¯·é€‰æ‹©--</option>
                        </select>
                    </div>
                    <div style="margin-bottom:10px;">
                        <label style="font-size:12px;">ç­çº§ (å¯é€‰)ï¼š</label>
                        <select id="posterClassSelect" style="width:100%; margin-bottom:5px;">
                            <option value="">å…¨æ ¡æ’å</option>
                        </select>
                    </div>
                    <div style="margin-bottom:10px;">
                        <label style="font-size:12px;">æ¦œå•ç±»å‹ï¼š</label>
                        <select id="posterSubjectSelect" style="width:100%; margin-bottom:5px;">
                            <option value="total">ğŸ† æ€»åˆ†å…‰è£æ¦œ</option>
                            <!-- JSåŠ¨æ€å¡«å……ç§‘ç›® -->
                        </select>
                    </div>
                    <div style="margin-bottom:10px;">
                        <label style="font-size:12px;">ä¸Šæ¦œäººæ•°ï¼š</label>
                        <input type="number" id="posterCount" value="10" min="1" max="50" style="width:100%;">
                    </div>

                    <h4 style="margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px; margin-top:20px;">ğŸ“ 3. æ–‡æ¡ˆå®šåˆ¶</h4>
                    <div style="margin-bottom:5px;"><input type="text" id="posterTitleInput" value="å…‰è£æ¦œ" placeholder="å¤§æ ‡é¢˜" style="width:100%;"></div>
                    <div style="margin-bottom:10px;"><input type="text" id="posterSubInput" value="æœ¬æ¬¡æœŸæœ«è€ƒè¯•ä¼˜ç§€åå•" placeholder="å‰¯æ ‡é¢˜" style="width:100%;"></div>
                    
                    <button class="btn btn-primary" style="width:100%; margin-top:10px;" onclick="renderPoster()">ğŸ”„ ç”Ÿæˆ/åˆ·æ–°é¢„è§ˆ</button>
                </div>

                <!-- å³ä¾§ï¼šé¢„è§ˆç”»å¸ƒ -->
                <div class="poster-preview-area">
                    <div id="poster-canvas" class="poster-canvas theme-red">
                        <div class="p-header">
                            <h1 class="p-title" contenteditable="true">å…‰è£æ¦œ</h1>
                            <div class="p-sub" contenteditable="true">2024-2025å­¦å¹´ ç¬¬ä¸€å­¦æœŸæœŸæœ«è€ƒè¯•</div>
                        </div>
                        <div class="p-list" id="poster-list-container">
                            <!-- åˆ—è¡¨é¡¹å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                            <div style="text-align:center; padding-top:100px; opacity:0.7;">
                                è¯·åœ¨å·¦ä¾§é€‰æ‹©æ•°æ®å¹¶ç‚¹å‡»ç”Ÿæˆ
                            </div>
                        </div>
                        <div class="p-footer" contenteditable="true">
                            æ˜Ÿå…‰ä¸é—®èµ¶è·¯äºº Â· æ—¶å…‰ä¸è´Ÿæœ‰å¿ƒäºº<br>
                            xxä¸­å­¦æ•™åŠ¡å¤„ å®£
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- è¯­éŸ³æ§åˆ¶å…¥å£ -->
    <div id="voice-fab" class="voice-fab" onclick="VoiceControl.toggle()" title="ç‚¹å‡»å¼€å¯è¯­éŸ³æ§åˆ¶">
        <i class="ti ti-microphone"></i>
    </div>

    <!-- å…¨å±è¯­éŸ³ HUD -->
    <div id="voice-hud" class="voice-hud" onclick="VoiceControl.stop()">
        <div class="voice-wave">
            <div class="voice-bar"></div><div class="voice-bar"></div><div class="voice-bar"></div><div class="voice-bar"></div><div class="voice-bar"></div>
        </div>
        <div id="voice-status" class="voice-text-main">æ­£åœ¨è†å¬...</div>
        <div id="voice-result" class="voice-text-sub">è¯·è¯´å‡ºæŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼šâ€œæ‰“å¼€å…¨ç§‘æ€»è¡¨â€</div>
        
        <div class="voice-cmd-list">
            <div class="voice-cmd-item"><span class="voice-cmd-key">"çœ‹æ€»æ¦œ"</span> è·³è½¬ç»¼åˆæ’å</div>
            <div class="voice-cmd-item"><span class="voice-cmd-key">"çœ‹æ•™å¸ˆ"</span> æ•™å¸ˆåˆ†æ</div>
            <div class="voice-cmd-item"><span class="voice-cmd-key">"æŸ¥æŸæŸ"</span> æœç´¢å­¦ç”Ÿ</div>
            <div class="voice-cmd-item"><span class="voice-cmd-key">"å…¨å±æ¨¡å¼"</span> éšè—èœå•</div>
            <div class="voice-cmd-item"><span class="voice-cmd-key">"é€€å‡ºè¯­éŸ³"</span> å…³é—­è¯­éŸ³</div>
        </div>
        <div style="margin-top: 30px; font-size: 12px; color: #64748b;">(ç‚¹å‡»ä»»æ„å¤„å…³é—­)</div>
    </div>

    <div id="drill-modal" class="modal" style="display: none; z-index: 12000;">
        <!-- ä¿®æ”¹ç‚¹ï¼šstyle ä¸­å®½åº¦æ”¹ä¸º 95%ï¼Œmax-width æ”¹ä¸º 1200pxï¼Œé«˜åº¦æ”¹ä¸º 90vh -->
        <div class="modal-content" style="width: 95%; max-width: 1200px; height: 90vh; display: flex; flex-direction: column;">
            
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:10px;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <button id="drill-back-btn" class="btn btn-sm btn-gray hidden" onclick="DrillSystem.goBack()">
                        <i class="ti ti-arrow-left"></i> è¿”å›
                    </button>
                    <h3 id="drill-title" style="margin:0; color:var(--primary); font-size:18px;">æ•°æ®è¯¦æƒ…</h3>
                </div>
                
                <div style="display:flex; gap:10px; align-items:center;">
                    <!-- æ–°å¢å¯¼å‡ºæŒ‰é’® -->
                    <button id="drill-export-btn" class="btn btn-sm btn-green" onclick="DrillSystem.exportExcel()">
                        <i class="ti ti-file-export"></i> å¯¼å‡ºä¸ºExcel
                    </button>
                    <button onclick="document.getElementById('drill-modal').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button>
                </div>
            </div>
            
            <!-- å†…å®¹åŒºåŸŸ -->
            <div id="drill-content" style="flex:1; overflow-y:auto;"></div>
            
            <!-- åº•éƒ¨ç»Ÿè®¡ -->
            <div id="drill-footer" style="border-top:1px solid #eee; padding-top:10px; margin-top:10px; font-size:12px; color:#666; text-align:right;"></div>
        </div>
    </div>

    <div id="target-editor-modal" class="modal" style="display: none; z-index: 11500;">
        <div class="modal-content" style="width: 90%; max-width: 1000px;">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:10px;">
                <h3 style="color:var(--primary); margin:0;">ğŸ¯ è®¾å®šå„æ ¡æŒ‡æ ‡ç›®æ ‡</h3>
                <button onclick="document.getElementById('target-editor-modal').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button>
            </div>
            
            <div class="info-bar" style="margin-bottom:10px;">
                ğŸ’¡ æç¤ºï¼šæ­¤å¤„ä¿®æ”¹å°†ç›´æ¥æ›´æ–°å†…å­˜æ•°æ®ï¼Œè®°å¾—ç‚¹å‡»â€œå¼€å§‹è®¡ç®—â€åˆ·æ–°ç»“æœã€‚
            </div>

            <div class="table-wrap" style="max-height: 50vh; overflow-y: auto;">
                <table id="target-editor-table">
                    <thead>
                        <tr>
                            <th>å­¦æ ¡åç§°</th>
                            <th style="background:#e0f2fe;">æŒ‡æ ‡ä¸€ç›®æ ‡ (äºº)</th>
                            <th style="background:#fff7ed;">æŒ‡æ ‡äºŒç›®æ ‡ (äºº)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div style="margin-top:15px; text-align:right;">
                <button class="btn btn-gray" onclick="document.getElementById('target-editor-modal').style.display='none'">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveTargetEditor()">ğŸ’¾ ä¿å­˜å¹¶é‡ç®—</button>
            </div>
        </div>
    </div>

    <style>
        /* é’»å–å¼¹çª—ä¸“ç”¨æ ·å¼ */
        .drill-class-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
        .drill-class-card { 
            background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 10px; 
            cursor: pointer; transition: all 0.2s; text-align: center;
        }
        .drill-class-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-color: var(--primary); background: #eff6ff; }
        .drill-val { font-size: 18px; font-weight: 800; color: var(--primary); margin: 5px 0; }
        .drill-label { font-size: 12px; color: #64748b; }
        
        .drill-stu-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .drill-stu-tag { 
            background: white; border: 1px solid #cbd5e1; padding: 4px 10px; border-radius: 4px; 
            font-size: 13px; display: flex; align-items: center; gap: 5px;
        }
        .drill-stu-score { color: var(--primary); font-weight: bold; font-family: monospace; }
        .clickable-num { cursor: pointer; text-decoration: underline; color: var(--primary); font-weight: bold; }
        .clickable-num:hover { color: #d97706; }
    </style>
    <!-- æ‰¹é‡æ‰“å°éšè—å®¹å™¨ -->
    <div id="batch-print-container" style="display:none;"></div>
    <div id="desk-labels-print-area"></div>
    <!-- å…¨å±€å¿«æ·æœç´¢å¼¹çª— -->
    <div id="spotlight-mask" class="spotlight-mask" onclick="closeSpotlight(event)">
        <div class="spotlight-box" onclick="event.stopPropagation()">
            <div class="spotlight-input-wrap">
                <i class="ti ti-search" style="font-size:24px; color:var(--primary); margin-right:10px;"></i>
                <input type="text" id="spotlight-input" class="spotlight-input" placeholder="è¾“å…¥å§“åã€å­¦æ ¡æˆ–ç­çº§..." oninput="doSpotlightSearch()">
            </div>
            <div id="spotlight-results" class="spotlight-results"></div>
            <div class="spotlight-hint">è¾“å…¥å…³é”®å­—æœç´¢ï¼Œç‚¹å‡»ç»“æœå¯ç›´æ¥è·³è½¬è‡³è¯¥ç”Ÿåˆ†ææŠ¥å‘Š</div>
        </div>
    </div>
    <!-- æ•™å¸ˆè¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="teacherModal" style="display: none;">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
                <h3 id="modalTeacherName" style="color:var(--primary);">æ•™å¸ˆå§“å</h3><button id="closeModal" style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
                <div class="bg-gray-50"><h4 style="margin-bottom:15px; color:#333;">æ•™å­¦æ¦‚å†µ</h4><div style="display:flex; justify-content:space-around;"><div class="stat-item"><div class="stat-value" id="modalAvgScore">0.00</div><div class="stat-label">å¹³å‡åˆ†</div></div><div class="stat-item"><div class="stat-value" id="modalExcellentRate">0%</div><div class="stat-label">ä¼˜ç§€ç‡</div></div><div class="stat-item"><div class="stat-value" id="modalPassRate">0%</div><div class="stat-label">åŠæ ¼ç‡</div></div></div></div>
                <div class="bg-gray-50"><h4 style="margin-bottom:15px; color:#333;">å¯¹æ¯”åˆ†æ</h4><div style="margin-bottom:10px;"><div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:5px;"><span>å¹³å‡åˆ†å¯¹æ¯”</span><span id="modalAvgComparison">0%</span></div><div style="height:8px; background:#e2e8f0; border-radius:4px; overflow:hidden;"><div id="modalAvgProgress" style="width:0; height:100%; transition:1s;"></div></div></div></div>
            </div>
            <table class="subject-table" id="modalSubjectTable"><thead><tr><th>å­¦ç§‘</th><th>å¹³å‡åˆ†</th><th>å¯¹æ¯”</th><th>ä¼˜ç§€ç‡</th><th>å¯¹æ¯”</th><th>åŠæ ¼ç‡</th><th>å¯¹æ¯”</th></tr></thead><tbody></tbody></table>
        </div>
    </div>

    <div class="modal" id="mobileShareModal" style="display: none; z-index: 10001;">
        <div class="modal-content" style="max-width: 450px; text-align: center; background: #333;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 style="color:white; font-size:16px;">ğŸ“± é•¿æŒ‰/å³é”®ä¿å­˜å›¾ç‰‡</h3>
                <button onclick="document.getElementById('mobileShareModal').style.display='none'" style="background:none; border:none; color:white; font-size:24px; cursor:pointer;">&times;</button>
            </div>
            <div id="mobile-img-result" style="max-height: 80vh; overflow-y: auto; border:1px solid #555;">
                <!-- å›¾ç‰‡å°†ç”Ÿæˆåœ¨è¿™é‡Œ -->
            </div>
            <div style="margin-top:15px;">
                <button class="btn btn-primary" onclick="downloadMobileImage()">â¬‡ï¸ ä¸‹è½½å›¾ç‰‡</button>
            </div>
        </div>
    </div>
    <!-- åŒååŒå§“/è½¬ç­ æ‰‹åŠ¨æ˜ å°„ç¡®è®¤æ¡† -->
    <div class="modal" id="mappingModal" style="display: none; z-index: 10002;">
        <div class="modal-content" style="max-width: 700px;">
            <div style="border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px;">
                <h3 style="color:#d97706; font-size:18px;">âš ï¸ æ£€æµ‹åˆ°ç–‘ä¼¼åŒå/è½¬ç­å­¦ç”Ÿ</h3>
                <p style="font-size:13px; color:#666; margin-top:5px;">
                    ç³»ç»Ÿå‘ç°ä»¥ä¸‹å­¦ç”Ÿåœ¨â€œä¸Šæ¬¡è€ƒè¯•â€ä¸­æœ‰åŒåè®°å½•ï¼Œä½†ç­çº§ä¸ä¸€è‡´ï¼ˆå¯èƒ½è½¬ç­äº†ï¼‰ã€‚<br>
                    è¯·æ‰‹åŠ¨ç¡®è®¤å¯¹åº”å…³ç³»ï¼Œä»¥ä¾¿ç²¾ç¡®è®¡ç®—è¿›é€€æ­¥ã€‚
                </p>
            </div>
            
            <div class="table-wrap" style="max-height: 50vh; overflow-y: auto;">
                <table id="mappingTable" style="width:100%; font-size:13px;">
                    <thead>
                        <tr>
                            <th style="background:#fef3c7;">å½“å‰å­¦ç”Ÿ (æœ¬æ¬¡)</th>
                            <th style="background:#fef3c7;">é€‰æ‹©å¯¹åº”çš„ä¸Šæ¬¡è®°å½•</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div style="margin-top:20px; text-align:right; display:flex; justify-content:flex-end; gap:10px;">
                <button class="btn btn-gray" onclick="document.getElementById('mappingModal').style.display='none'">å–æ¶ˆåˆ†æ</button>
                <button class="btn btn-primary" onclick="confirmMappingsAndRun()">âœ… ç¡®è®¤åŒ¹é…å¹¶ç»§ç»­</button>
            </div>
        </div>
    </div>
    <!-- ç”µå­å¥–çŠ¶æ¨¡æ€æ¡† -->
    <div id="cert-modal" class="modal" style="display: none; z-index: 10005;">
        <div class="modal-content" style="max-width: 550px; text-align: center; background: #fff; padding: 10px;">
            <!-- è¿™é‡Œæ˜¯å¥–çŠ¶çš„å¯è§†åŒ–åŒºåŸŸ -->
            <div id="cert-capture-area" style="padding: 40px; background: #fffaf0; border: 12px double #b45309; position: relative; overflow: hidden; box-shadow: inset 0 0 50px rgba(180,83,9,0.05);">
                <!-- èƒŒæ™¯è£…é¥°ï¼šç”±äºæ˜¯å•æ–‡ä»¶ï¼Œæˆ‘ä»¬ç”¨ CSS ç”»ä¸€ä¸ªç®€æ˜“é˜²ä¼ªå°ç« æ•ˆæœ -->
                <div style="position: absolute; bottom: 30px; right: 40px; width: 100px; height: 100px; border: 3px solid rgba(220,38,38,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: rgba(220,38,38,0.2); font-weight: bold; transform: rotate(-15deg); pointer-events: none; font-size: 14px;">æ•™åŠ¡å¤„æ ¸å‡†</div>
                
                <h1 style="color: #b45309; font-size: 42px; margin-bottom: 5px; font-family: 'STKaiti', 'æ¥·ä½“', serif;">è£èª‰è¯ä¹¦</h1>
                <div style="width: 150px; height: 3px; background: #b45309; margin: 0 auto 25px;"></div>
                
                <p style="font-size: 22px; margin-top: 20px; text-align: left; line-height: 2;">
                    <strong id="cert-name" style="border-bottom: 2px solid #333; padding: 0 15px; color: #1e293b;">å¼ ä¸‰</strong> åŒå­¦ï¼š
                </p>
                <p style="text-align: left; text-indent: 2.5em; line-height: 2; font-size: 18px; color: #374151;">
                    åœ¨æœ¬æ¬¡ <span id="cert-exam-name" style="font-weight: bold; color: #2563eb;">æœŸæœ«è€ƒè¯•</span> ä¸­ï¼Œå‡­å€ŸåšæŒä¸æ‡ˆçš„åŠªåŠ›å’Œå‡ºè‰²çš„è¡¨ç°ï¼Œè·å¾—äº†
                    <strong id="cert-honor" style="color: #dc2626; font-size: 24px;">â€œè¿›æ­¥ä¹‹æ˜Ÿâ€</strong>
                    å…‰è£ç§°å·ï¼Œç‰¹å‘æ­¤è¯ï¼Œä»¥èµ„é¼“åŠ±ï¼
                </p>
                <div style="margin-top: 50px; text-align: right; padding-right: 20px;">
                    <p style="font-weight: bold; font-size: 18px; color: #1e293b;" id="cert-school-footer">XXä¸­å­¦æ•™åŠ¡å¤„</p>
                    <p id="cert-date" style="color: #64748b;">2024å¹´12æœˆ</p>
                </div>
            </div>
            
            <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
            <div style="margin-top: 20px; display: flex; gap: 15px; padding: 10px;">
                <button class="btn btn-orange" style="flex:1; font-size: 16px; height: 45px;" onclick="downloadCertificate()">
                    <i class="ti ti-download"></i> ä¿å­˜å¥–çŠ¶ä¸ºé«˜æ¸…å›¾ç‰‡
                </button>
                <button class="btn btn-gray" style="width: 100px;" onclick="document.getElementById('cert-modal').style.display='none'">å…³é—­</button>
            </div>
        </div>
    </div>
    <div id="school-profile-modal" class="modal" style="display: none;">
        <div class="modal-content" style="width: 95%; max-width: 1400px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 id="sp-title" style="margin:0; color:var(--primary); font-size:20px;">ğŸ« å­¦æ ¡ç”»åƒ</h3>
                <button onclick="document.getElementById('school-profile-modal').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button>
            </div>
            
            <div class="school-modal-grid">
                <!-- å·¦ä¾§ï¼šé›·è¾¾å›¾ -->
                <div style="background:#f8fafc; border-radius:8px; padding:10px; border:1px solid #e2e8f0; height:300px; position:relative;">
                    <h4 style="text-align:center; font-size:13px; color:#64748b; margin-bottom:5px;">å­¦ç§‘å‡è¡¡åº¦è¯Šæ–­ (vs å…¨é•‡å‡å€¼)</h4>
                    <div style="height:260px; width:100%;"><canvas id="schoolRadarChart"></canvas></div>
                </div>
                
                <!-- å³ä¾§ï¼šæ•°æ®æ¦‚è§ˆ -->
                <div>
                    <h4 style="margin-bottom:10px; border-left:4px solid var(--primary); padding-left:8px;">ğŸ“Š æ ¸å¿ƒæŒ‡æ ‡</h4>
                    <div class="fb-dashboard" style="grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px;">
                        <div class="fb-card" style="padding:10px;">
                            <div class="fb-lbl">ç»¼åˆæ’å</div>
                            <div class="fb-val text-red" id="sp-rank">-</div>
                        </div>
                        <div class="fb-card" style="padding:10px;">
                            <div class="fb-lbl">è€ƒæ ¸æ€»åˆ†</div>
                            <div class="fb-val text-blue" id="sp-score">-</div>
                        </div>
                        <div class="fb-card" style="padding:10px;">
                            <div class="fb-lbl">å¹³å‡åˆ†èµ‹åˆ†</div>
                            <div class="fb-val" id="sp-s1">-</div>
                        </div>
                        <div class="fb-card" style="padding:10px;">
                            <div class="fb-lbl">ä¸‰ç‡èµ‹åˆ†</div>
                            <div class="fb-val" id="sp-s2">-</div>
                        </div>
                    </div>
                    
                    <div class="info-bar" style="font-size:12px;">
                        ğŸ’¡ <strong>è¯Šæ–­å»ºè®®ï¼š</strong><br>
                        <span id="sp-diagnosis">ç‚¹å‡»å­¦æ ¡æŸ¥çœ‹åˆ†æ...</span>
                    </div>
                </div>
            </div>

            <!-- åˆ†æ•°æ®µåˆ†å¸ƒå›¾ (åŒè½´) -->
            <div style="margin-top:20px; padding-top:15px; border-top:1px dashed #e2e8f0;">
                <h4 style="margin-bottom:10px; color:#333; font-size:14px; display:flex; justify-content:space-between;">
                    <span>ğŸ“‰ åˆ†æ•°æ®µç»“æ„å¯¹æ¯” (æœ¬æ ¡ vs å…¨é•‡)</span>
                    <span style="font-weight:normal; font-size:12px; color:#666;">æŸ±çŠ¶=æœ¬æ ¡å æ¯” | æŠ˜çº¿=å…¨é•‡å‡å€¼</span>
                </h4>
                <div style="height:180px; width:100%; position:relative;">
                    <canvas id="schoolDistChart"></canvas>
                </div>
            </div>

            <div class="school-modal-actions">
                <span style="font-size:12px; color:#999; margin-right:auto; align-self:center;">è·³è½¬åå°†è‡ªåŠ¨ç­›é€‰è¯¥æ ¡æ•°æ®</span>
                <button class="btn btn-purple" onclick="jumpToModule('class-comparison')"><i class="ti ti-layout-columns"></i> ç­çº§å¯¹æ¯”</button>
                <button class="btn btn-blue" onclick="jumpToModule('teacher-analysis')"><i class="ti ti-school"></i> æ•™å¸ˆè¯„ä»·</button>
                <button class="btn btn-green" onclick="jumpToModule('student-details')"><i class="ti ti-users"></i> å­¦ç”Ÿåå•</button>
            </div>
        </div>
    </div>
    <!-- å¤–è§‚è®¾ç½®æ¨¡æ€æ¡† -->
    <div id="skin-modal" class="modal" style="display: none; z-index: 11000;">
        <div class="modal-content" style="max-width: 500px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:10px;">
                <h3 style="margin:0; color:var(--primary);"><i class="ti ti-palette"></i> ç³»ç»Ÿå¤–è§‚å®šåˆ¶</h3>
                <button onclick="document.getElementById('skin-modal').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button>
            </div>

            <!-- 1. ä¸»é¢˜è‰²è®¾ç½® -->
            <div style="margin-bottom: 25px;">
                <h4 style="margin-bottom:10px; color:#333;">1. é€‰æ‹©ä¸»è‰²è°ƒ</h4>
                <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px;">
                    <!-- é¢„è®¾é¢œè‰² -->
                    <div onclick="setThemeColor('#4f46e5')" style="width:30px; height:30px; background:#4f46e5; border-radius:50%; cursor:pointer; border:2px solid #ddd;" title="é»˜è®¤ç´«"></div>
                    <div onclick="setThemeColor('#2563eb')" style="width:30px; height:30px; background:#2563eb; border-radius:50%; cursor:pointer; border:2px solid #ddd;" title="ç§‘æŠ€è“"></div>
                    <div onclick="setThemeColor('#059669')" style="width:30px; height:30px; background:#059669; border-radius:50%; cursor:pointer; border:2px solid #ddd;" title="æŠ¤çœ¼ç»¿"></div>
                    <div onclick="setThemeColor('#dc2626')" style="width:30px; height:30px; background:#dc2626; border-radius:50%; cursor:pointer; border:2px solid #ddd;" title="ä¸­å›½çº¢"></div>
                    <div onclick="setThemeColor('#b45309')" style="width:30px; height:30px; background:#b45309; border-radius:50%; cursor:pointer; border:2px solid #ddd;" title="å°Šè´µé‡‘"></div>
                    <div onclick="setThemeColor('#0f172a')" style="width:30px; height:30px; background:#0f172a; border-radius:50%; cursor:pointer; border:2px solid #ddd;" title="æ·±é‚ƒé»‘"></div>
                </div>
                <div style="display:flex; align-items:center; gap:10px;">
                    <input type="color" id="custom-color-input" onchange="setThemeColor(this.value)" style="width:50px; height:30px; padding:0; border:none;">
                    <span style="font-size:12px; color:#666;">è‡ªå®šä¹‰é¢œè‰² (ç‚¹å‡»è‰²å—é€‰æ‹©)</span>
                </div>
            </div>

            <!-- 2. Logo è®¾ç½® -->
            <div style="margin-bottom: 25px;">
                <h4 style="margin-bottom:10px; color:#333;">2. å®šåˆ¶æ ¡å¾½/Logo</h4>
                <div class="upload-box" style="padding:15px; border:1px dashed #ccc; min-height:auto;" onclick="document.getElementById('logoInput').click()">
                    <div style="color:var(--primary); font-size:20px;"><i class="ti ti-photo-up"></i> ç‚¹å‡»ä¸Šä¼  Logo å›¾ç‰‡</div>
                    <p style="font-size:12px; color:#999; margin:5px 0;">å»ºè®®ä½¿ç”¨é€æ˜èƒŒæ™¯ PNGï¼Œé«˜åº¦60pxå·¦å³<br>å›¾ç‰‡å°†ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­</p>
                    <input type="file" id="logoInput" accept="image/*" hidden onchange="handleLogoUpload(this)">
                </div>
                <button class="btn btn-gray btn-sm" onclick="clearLogo()" style="margin-top:5px;">ğŸ—‘ï¸ æ¸…é™¤ Logo</button>
            </div>

            <!-- 3. æ ‡é¢˜è®¾ç½® -->
            <div style="margin-bottom: 10px;">
                <h4 style="margin-bottom:10px; color:#333;">3. ç³»ç»Ÿåç§°</h4>
                <input type="text" id="custom-title-input" placeholder="é»˜è®¤ä¸ºï¼šä¹¡é•‡å­¦æ ¡æˆç»©åˆ†æ..." style="width:100%; margin-bottom:5px;" oninput="updateTitlePreview(this.value)">
                <button class="btn btn-primary" style="width:100%; margin-top:15px;" onclick="saveSkinSettings()">ğŸ’¾ ä¿å­˜å¹¶åº”ç”¨</button>
            </div>
        </div>
    </div>
    <div id="admin-modal" class="modal" style="display: none; z-index: 60000;">
        <div class="modal-content" style="max-width: 600px;"> <!-- ç¨å¾®è°ƒå®½ä¸€ç‚¹ -->
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px;">
            <div style="display:flex; align-items:center; gap:10px;">
                <h3 style="color:#b91c1c; margin:0;"><i class="ti ti-shield-lock"></i> è´¦å·ç®¡ç†</h3>
                <!-- æ–°å¢ï¼šæŸ¥çœ‹æ—¥å¿—æŒ‰é’® -->
                <button onclick="Logger.view()" style="font-size:12px; background:#fff; border:1px solid #ccc; padding:4px 8px; border-radius:4px; cursor:pointer; display:flex; align-items:center; gap:4px;">
                    <i class="ti ti-history"></i> æ“ä½œæ—¥å¿—
                </button>
            </div>
            <button onclick="document.getElementById('admin-modal').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button>
        </div>
            
            <div class="info-bar" style="margin-bottom:20px;">
                æ­¤å¤„åŠŸèƒ½å°†åŸºäºæ‚¨åœ¨ã€æ•°æ®ä¸­å¿ƒã€‘ä¸Šä¼ çš„ Excel æ•°æ®æ‰¹é‡ç”Ÿæˆè´¦å·ã€‚<br>
                æ‰€æœ‰ç”Ÿæˆè´¦å·çš„é»˜è®¤åˆå§‹å¯†ç å‡ä¸º <strong>123456</strong>ã€‚
            </div>

            <div style="display:grid; gap:15px;">
                <!-- åŠŸèƒ½åŒº 1 -->
                <div style="background:#f8fafc; padding:15px; border-radius:8px; border:1px solid #e2e8f0;">
                    <h4 style="margin-bottom:10px; color:#334155;">1. æ‰¹é‡ç”Ÿæˆ/é‡ç½®è´¦å·</h4>
                    <div style="margin-bottom:10px;">
                        <label style="font-size:12px; font-weight:bold; color:#64748b; display:block; margin-bottom:5px;">
                            è¯·é€‰æ‹©è¦ç”Ÿæˆçš„å­¦æ ¡ (å¤šé€‰):
                        </label>
                        <div id="admin-gen-school-list" style="max-height:100px; overflow-y:auto; background:white; border:1px solid #cbd5e1; border-radius:4px; padding:5px; font-size:12px;">
                            <div style="color:#999; text-align:center; padding:10px;">æš‚æ— æ•°æ®ï¼Œè¯·å…ˆä¸Šä¼ æˆç»©</div>
                        </div>
                        <div style="text-align:right; margin-top:2px;">
                            <a href="javascript:void(0)" onclick="Auth.toggleAllSchools(true)" style="font-size:11px; color:var(--primary);">å…¨é€‰</a> / 
                            <a href="javascript:void(0)" onclick="Auth.toggleAllSchools(false)" style="font-size:11px; color:var(--primary);">æ¸…ç©º</a>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="Auth.generateAccounts()" style="width:100%;">
                        <i class="ti ti-user-plus"></i> ä¸€é”®ç”Ÿæˆæ‰€æœ‰è´¦å· (æ•™å¸ˆ+å®¶é•¿)
                    </button>
                    <button class="btn btn-green" onclick="Auth.exportAccounts()" style="width:100%; background:#059669; color:white;">
                        <i class="ti ti-file-export"></i> å¯¼å‡ºè´¦å·å¯†ç è¡¨ (Excel)
                    </button>
<!-- æ–°å¢ï¼šæ‰¹é‡åŒæ­¥äº‘ç«¯æŒ‰é’® -->
                <button class="btn btn-blue" onclick="Auth.syncBatchToCloud()" style="width:100%; background:#2563eb; color:white; margin-top:5px;">
                    <i class="ti ti-cloud-upload"></i> ä¸€é”®åŒæ­¥æ‰€æœ‰è´¦å·åˆ°äº‘ç«¯ (Database)
                </button>
                <p style="font-size:11px; color:#64748b; margin-top:2px; text-align:center;">
                    å°†æœ¬åœ°ç”Ÿæˆçš„è´¦å·æ‰¹é‡å†™å…¥ Supabase æ•°æ®åº“ï¼Œä»¥ä¾¿ç”¨æˆ·ç™»å½•ã€‚
                </p>
<!-- æ–°å¢ï¼šæ¸…ç©ºäº‘ç«¯æŒ‰é’® -->
                <div style="margin-top:10px; border-top:1px dashed #e2e8f0; padding-top:10px;">
                    <button class="btn btn-danger" onclick="Auth.deleteCloudAccounts()" style="width:100%; background:#dc2626; color:white;">
                        <i class="ti ti-trash-x"></i> âš ï¸ æ¸…ç©ºäº‘ç«¯æ‰€æœ‰æ™®é€šè´¦å·
                    </button>
                    <p style="font-size:11px; color:#ef4444; margin-top:2px; text-align:center;">
                        è­¦å‘Šï¼šå°†åˆ é™¤äº‘ç«¯æ‰€æœ‰å®¶é•¿å’Œæ•™å¸ˆè´¦å·ï¼ˆä¿ç•™ç®¡ç†å‘˜ï¼‰ã€‚
                    </p>
                </div>
                    <hr style="margin: 15px 0; border:0; border-top:1px dashed #ccc;">
                    <h4 style="margin-bottom:10px; color:#7c3aed;">ğŸš€ å‘é€ç»™å®¶é•¿</h4>
                    <button class="btn btn-purple" onclick="Packager.exportDistributableHTML()" style="width:100%; background:#7c3aed; color:white; font-weight:bold;">
                        <i class="ti ti-package"></i> ç”Ÿæˆå¯åˆ†å‘ç½‘é¡µ (å«æ•°æ®)
                    </button>
                    <p style="font-size:11px; color:#7c3aed; margin-top:5px; background:#f3e8ff; padding:5px; border-radius:4px;">
                        ç”Ÿæˆä¸€ä¸ªå†…ç½®äº†æˆç»©å’Œè´¦å·çš„æ–°HTMLæ–‡ä»¶ã€‚è¯·æŠŠè¿™ä¸ªæ–°æ–‡ä»¶å‘åˆ°å®¶é•¿ç¾¤ã€‚
                    </p>
                    <p style="font-size:12px; color:#666; margin-top:5px;">
                        æ•™å¸ˆè´¦å· = æ•™å¸ˆå§“å (é»˜è®¤å¯†ç  yssy2016)<br> <!-- ğŸŸ¢ ä¿®æ”¹ç‚¹ï¼šæ›´æ–°æ˜¾ç¤ºæ–‡æœ¬ -->
                        å®¶é•¿è´¦å· = å­¦ç”Ÿå§“å (é»˜è®¤å¯†ç  123456)
                    </p>
                </div>

                <!-- åŠŸèƒ½åŒº 2: äº‘ç«¯è´¦å·ç®¡ç† (ä¿®æ­£ç‰ˆ) -->
            <div style="background:#fff; padding:15px; border:1px solid #cbd5e1; border-radius:8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                
                <!-- ğŸ‘‡ğŸ‘‡ğŸ‘‡ ğŸŸ¢ ä¿®æ”¹ï¼šå¢åŠ äº†ç­ä¸»ä»»ã€çº§éƒ¨ä¸»ä»»é€‰é¡¹ï¼Œä»¥åŠå³ä¾§çš„ Excel å·¥å…·æ  ğŸŸ¢ ğŸ‘‡ğŸ‘‡ğŸ‘‡ -->
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                     <h4 style="margin:0; color:#0369a1;"><i class="ti ti-cloud-upload"></i> 2. æ·»åŠ /ç®¡ç†äº‘ç«¯è´¦å·</h4>
                     <div style="display:flex; gap:5px;">
                        <button class="btn btn-sm btn-green" onclick="AccountExcel.downloadTemplate()" title="ä¸‹è½½å¯¼å…¥æ¨¡æ¿">
                            <i class="ti ti-download"></i> æ¨¡æ¿
                        </button>
                        <button class="btn btn-sm btn-orange" onclick="document.getElementById('accExcelInput').click()" title="ä¸Šä¼ Excelæ‰¹é‡å¯¼å…¥">
                            <i class="ti ti-file-import"></i> å¯¼å…¥
                        </button>
                        <input type="file" id="accExcelInput" accept=".xlsx,.xls" hidden onchange="AccountExcel.upload(this)">
                     </div>
                </div>

                <div style="display:flex; gap:5px; margin-bottom:10px;">
                    <select id="manual-role" style="padding:8px; border:1px solid #ccc; width:30%; font-size:12px;" onchange="toggleAdminManualInput()">
                        <option value="teacher">ğŸ‘¨â€ğŸ« ç§‘ä»»æ•™å¸ˆ</option>
                        <option value="class_teacher">ğŸ“‹ ç­ä¸»ä»»</option>
                        <option value="grade_director">ğŸš€ çº§éƒ¨ä¸»ä»»</option>
                        <option value="director">ğŸ“ æ•™åŠ¡ä¸»ä»»</option>
                        <option value="parent">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ å®¶é•¿</option>
                        <option value="admin">ğŸ”‘ ç®¡ç†å‘˜</option>
                    </select>
                    <!-- çº§éƒ¨è¾“å…¥æ¡† (é»˜è®¤éšè—) -->
                    <input type="text" id="manual-grade" placeholder="çº§éƒ¨(å¦‚:7)" style="padding:8px; border:1px solid #ccc; width:20%; display:none;">
                    
                    <input type="text" id="manual-school" placeholder="æ‰€å±å­¦æ ¡ (å¿…å¡«)" style="padding:8px; border:1px solid #ccc; width:25%;">
                    <input type="text" id="manual-name" placeholder="è´¦å·/å§“å" style="padding:8px; border:1px solid #ccc; flex:1;">
                </div>

                <!-- ç­çº§è¾“å…¥æ¡† (é»˜è®¤éšè—ï¼Œä»…å®¶é•¿éœ€è¦) -->
                <div id="manual-class-wrap" style="margin-bottom:10px; display:none;">
                    <input type="text" id="manual-class" placeholder="è¾“å…¥ç­çº§ (å¦‚: 701ï¼Œå®¶é•¿å¿…å¡«)" style="width:100%; padding:8px; border:1px solid #ccc;">
                </div>

                <div style="display:flex; gap:10px;">
                    <input type="text" id="manual-pass" value="123456" placeholder="å¯†ç " style="padding:8px; border-radius:4px; border:1px solid #ccc; width:60%;">
                    <!-- è¿™é‡Œçš„ onclick å¿…é¡»æŒ‡å‘ Auth.addCloudAccount -->
                    <button class="btn btn-primary" onclick="Auth.addCloudAccount()" style="flex:1;">æ·»åŠ /æ›´æ–°</button>
                </div>
                <p style="font-size:12px; color:#999; margin-top:5px;">æç¤ºï¼šç›´æ¥å†™å…¥äº‘ç«¯æ•°æ®åº“ã€‚è´¦å·å¿…é¡»å”¯ä¸€ã€‚</p>
            </div>

            <script>
                // ğŸ‘‡ğŸ‘‡ğŸ‘‡ ğŸŸ¢ æ–°å¢ï¼šExcel è´¦å·æ‰¹é‡å¯¼å…¥å·¥å…· ğŸŸ¢ ğŸ‘‡ğŸ‘‡ğŸ‘‡
                const AccountExcel = {
                    downloadTemplate: function() {
                        const wb = XLSX.utils.book_new();
                        const headers = ["è§’è‰²", "å­¦æ ¡", "ç­çº§", "çº§éƒ¨(å¹´çº§)", "å§“å/è´¦å·", "å¯†ç ", "å¤‡æ³¨"];
                        const data = [
                            headers,
                            ["ç§‘ä»»æ•™å¸ˆ", "å®éªŒä¸­å­¦", "", "7", "å¼ è€å¸ˆ", "123456", "åªçœ‹è‡ªå·±æ•™çš„è¯¾"],
                            ["ç­ä¸»ä»»", "å®éªŒä¸­å­¦", "701", "7", "ç‹ç­å¤´", "123456", "çœ‹æœ¬ç­æ‰€æœ‰"],
                            ["çº§éƒ¨ä¸»ä»»", "å®éªŒä¸­å­¦", "", "7", "æçº§éƒ¨", "123456", "ç®¡ç†æ•´ä¸ªä¸ƒå¹´çº§"],
                            ["å®¶é•¿", "å®éªŒä¸­å­¦", "701", "", "å¼ å°æ˜", "123456", "åªèƒ½çœ‹è‡ªå·±"],
                            ["æ•™åŠ¡ä¸»ä»»", "å®éªŒä¸­å­¦", "", "", "èµµä¸»ä»»", "123456", "æŸ¥çœ‹å…¨æ ¡"]
                        ];
                        const ws = XLSX.utils.aoa_to_sheet(data);
                        ws['!cols'] = [{wch:12}, {wch:15}, {wch:8}, {wch:10}, {wch:15}, {wch:10}, {wch:20}];
                        XLSX.utils.book_append_sheet(wb, ws, "è´¦å·å¯¼å…¥æ¨¡æ¿");
                        XLSX.writeFile(wb, "è´¦å·æ‰¹é‡å¯¼å…¥æ¨¡æ¿.xlsx");
                    },

                    upload: function(input) {
                        const file = input.files[0];
                        if (!file) return;
                        const reader = new FileReader();
                        reader.onload = async function(e) {
                            try {
                                const data = new Uint8Array(e.target.result);
                                const wb = XLSX.read(data, {type: 'array'});
                                const json = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
                                
                                if (json.length === 0) return alert("è¡¨æ ¼ä¸ºç©º");
                                if (!confirm(`è§£æåˆ° ${json.length} æ¡è´¦å·æ•°æ®ï¼Œç¡®å®šè¦å¯¼å…¥äº‘ç«¯å—ï¼Ÿ`)) return;

                                UI.loading(true, "æ­£åœ¨æ‰¹é‡åˆ›å»ºäº‘ç«¯è´¦å·...");
                                
                                const roleMap = {
                                    "ç§‘ä»»æ•™å¸ˆ": "teacher", "æ•™å¸ˆ": "teacher",
                                    "ç­ä¸»ä»»": "class_teacher",
                                    "çº§éƒ¨ä¸»ä»»": "grade_director", "å¹´çº§ä¸»ä»»": "grade_director",
                                    "å®¶é•¿": "parent", "å­¦ç”Ÿ": "parent",
                                    "æ•™åŠ¡ä¸»ä»»": "director",
                                    "ç®¡ç†å‘˜": "admin"
                                };

                                let successCount = 0;
                                const batchData = [];

                                json.forEach(row => {
                                    const roleCN = row['è§’è‰²'] || "";
                                    const role = roleMap[roleCN.trim()] || "teacher"; // é»˜è®¤æ•™å¸ˆ
                                    const user = row['å§“å/è´¦å·'] || row['å§“å'];
                                    const pass = row['å¯†ç '] || "123456";
                                    const school = row['å­¦æ ¡'] || window.MY_SCHOOL || "é»˜è®¤å­¦æ ¡";
                                    const cls = row['ç­çº§'] ? String(row['ç­çº§']).trim() : "";
                                    const grade = row['çº§éƒ¨(å¹´çº§)'] ? String(row['çº§éƒ¨(å¹´çº§)']).trim() : ""; // æ–°å¢çº§éƒ¨å­—æ®µ

                                    if (user) {
                                        batchData.push({
                                            username: user,
                                            password: pass.toString(),
                                            role: role,
                                            school: school,
                                            class_name: role === 'class_teacher' || role === 'parent' ? cls : (role === 'grade_director' ? grade : ""), // çº§éƒ¨ä¸»ä»»çš„classå­—æ®µå­˜å¹´çº§
                                            // æ³¨æ„ï¼šè¿™é‡Œå¤ç”¨äº† class_name å­—æ®µã€‚
                                            // å¯¹äºçº§éƒ¨ä¸»ä»»ï¼Œclass_name å­˜ "7" (ä»£è¡¨7å¹´çº§)
                                            // å¯¹äºç­ä¸»ä»»ï¼Œclass_name å­˜ "701"
                                        });
                                    }
                                });

                                // åˆ†æ‰¹å†™å…¥ Supabase
                                const { error } = await sbClient.from('system_users').upsert(batchData, { onConflict: 'username' });
                                
                                UI.loading(false);
                                if (error) throw error;
                                
                                alert(`âœ… æˆåŠŸå¯¼å…¥ ${batchData.length} ä¸ªè´¦å·ï¼`);
                                input.value = ''; // æ¸…ç©º

                            } catch (err) {
                                UI.loading(false);
                                alert("å¯¼å…¥å¤±è´¥ï¼š" + err.message);
                            }
                        };
                        reader.readAsArrayBuffer(file);
                    }
                };

               // ğŸ‘‡ğŸ‘‡ğŸ‘‡ ğŸŸ¢ ä¿®æ”¹ï¼šè¾“å…¥æ¡†è”åŠ¨é€»è¾‘ (é€‚é…æ–°è§’è‰²) ğŸŸ¢ ğŸ‘‡ğŸ‘‡ğŸ‘‡
                function toggleAdminManualInput() {
                    const role = document.getElementById('manual-role').value;
                    const clsWrap = document.getElementById('manual-class-wrap'); // å®¶é•¿/ç­ä¸»ä»»ç”¨
                    const clsInput = document.getElementById('manual-class');
                    const nameInp = document.getElementById('manual-name');
                    const schoolInp = document.getElementById('manual-school');
                    const gradeInp = document.getElementById('manual-grade'); // çº§éƒ¨ä¸»ä»»ç”¨
                    
                    // 1. å…ˆå…¨éƒ¨éšè—/é‡ç½®
                    clsWrap.style.display = 'none';
                    gradeInp.style.display = 'none';
                    schoolInp.style.display = 'block'; // é»˜è®¤æ˜¾ç¤ºå­¦æ ¡
                    
                    // 2. æ ¹æ®è§’è‰²å¼€å¯ç‰¹å®šæ¡†
                    if (role === 'parent') {
                        clsWrap.style.display = 'block';
                        clsInput.placeholder = "è¾“å…¥ç­çº§ (å¦‚: 701ï¼Œå®¶é•¿å¿…å¡«)";
                        nameInp.placeholder = "å­¦ç”Ÿå§“å";
                    } 
                    else if (role === 'class_teacher') {
                        clsWrap.style.display = 'block'; 
                        clsInput.placeholder = "ç®¡ç†ç­çº§ (å¦‚: 701)";
                        nameInp.placeholder = "ç­ä¸»ä»»å§“å";
                    }
                    else if (role === 'grade_director') {
                        gradeInp.style.display = 'block'; // âœ… ç¡®ä¿è¿™è¡Œæ‰§è¡Œï¼Œæ˜¾ç¤ºå¹´çº§æ¡†
                        nameInp.placeholder = "ä¸»ä»»å§“å";
                    }
                    else if (role === 'director') {
                        nameInp.placeholder = "ä¸»ä»»å§“å";
                    } 
                    else if (role === 'admin') {
                        schoolInp.style.display = 'none'; // ç®¡ç†å‘˜ä¸éœ€è¦å¡«å­¦æ ¡
                        nameInp.placeholder = "ç®¡ç†å‘˜è´¦å·";
                    } 
                    else { // teacher
                        nameInp.placeholder = "æ•™å¸ˆå§“å";
                    }
                }
            </script>
                
                <!-- åŠŸèƒ½åŒº 3 -->
                <div style="background:#fff; padding:15px; border:1px solid #eee; border-radius:8px;">
                    <h4 style="margin-bottom:10px; color:#333;">3. ä¿®æ”¹ç®¡ç†å‘˜å¯†ç </h4>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="new-admin-pass" placeholder="è¾“å…¥æ–°å¯†ç " style="padding:8px; flex:1; border:1px solid #cbd5e1; border-radius:4px;">
                        <button class="btn btn-gray" onclick="changeAdminPass()">ç¡®è®¤ä¿®æ”¹</button>
                    </div>
                </div>
                <div style="background:#f0fdf4; padding:15px; border:1px solid #86efac; border-radius:8px; margin-top:5px;">
                    <h4 style="margin-bottom:10px; color:#166534;"><i class="ti ti-cloud-download"></i> 4. å¯¼å‡ºäº‘ç«¯æ‰€æœ‰è´¦å· (å®Œæ•´å¤‡ä»½)</h4>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <p style="font-size:12px; color:#15803d; margin:0; flex:1;">
                            æ­¤åŠŸèƒ½ç›´æ¥ä»äº‘ç«¯æ•°æ®åº“ä¸‹è½½ï¼ŒåŒ…å«<strong>æ‰¹é‡ç”Ÿæˆ</strong>ã€<strong>æ‰‹åŠ¨æ·»åŠ </strong>åŠ<strong>Excelå¯¼å…¥</strong>çš„æ‰€æœ‰è´¦å·ã€‚<br>
                            åŒ…å«ï¼šè§’è‰²ã€å­¦æ ¡ã€ç­çº§ã€è´¦å·ã€å¯†ç ã€‚
                        </p>
                        <button class="btn btn-green" onclick="Auth.exportAllCloudAccounts()" style="background:#16a34a; color:white; font-weight:bold; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
                            <i class="ti ti-download"></i> ä¸‹è½½å…¨é‡è´¦å·è¡¨
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç®€å•çš„ä¿®æ”¹å¯†ç è„šæœ¬ (å†…è” - äº‘ç«¯åŒæ­¥ç‰ˆ) -->
<script>
async function changeAdminPass() {
    const p = document.getElementById('new-admin-pass').value.trim();
    if(!p) return alert("å¯†ç ä¸èƒ½ä¸ºç©º");

    // 1. æ›´æ–°æœ¬åœ°çŠ¶æ€ (ç¡®ä¿å½“å‰ä¼šè¯ç«‹å³ç”Ÿæ•ˆ)
    if(typeof Auth !== 'undefined') {
        Auth.db.admin.pass = p;
        localStorage.setItem('SYS_USERS', JSON.stringify(Auth.db));
    }

    // 2. åŒæ­¥åˆ°äº‘ç«¯æ•°æ®åº“ (æ ¸å¿ƒä¿®å¤)
    if(sbClient) {
        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        const loader = document.getElementById('global-loader');
        const txt = document.getElementById('loader-text');
        if(loader) { loader.classList.remove('hidden'); if(txt) txt.innerText = "æ­£åœ¨æ›´æ–°äº‘ç«¯å¯†ç ..."; }

        try {
            // æ›´æ–° system_users è¡¨ä¸­ username='admin' çš„è®°å½•
            const { error } = await sbClient
                .from('system_users')
                .update({ password: p })
                .eq('username', 'admin');

            // éšè—åŠ è½½åŠ¨ç”»
            if(loader) loader.classList.add('hidden');

            if (error) {
                console.error(error);
                alert("âŒ æœ¬åœ°ä¿®æ”¹æˆåŠŸï¼Œä½†ã€äº‘ç«¯åŒæ­¥å¤±è´¥ã€‘ï¼\né”™è¯¯ä¿¡æ¯ï¼š" + error.message);
            } else {
                alert("âœ… ç®¡ç†å‘˜å¯†ç å·²ä¿®æ”¹ï¼\n(æœ¬åœ°å’Œäº‘ç«¯å‡å·²æ›´æ–°ä¸º: " + p + ")");
                document.getElementById('new-admin-pass').value = '';
            }
        } catch (err) {
            if(loader) loader.classList.add('hidden');
            alert("âŒ ç¨‹åºå¼‚å¸¸ï¼š" + err.message);
        }
    } else {
        alert("âš ï¸ è­¦å‘Šï¼šæœªè¿æ¥åˆ°äº‘ç«¯æ•°æ®åº“ï¼Œä»…ä¿®æ”¹äº†æœ¬åœ°ç¼“å­˜å¯†ç ã€‚");
    }
}
</script>
 
<!-- ç”¨æˆ·ä¸ªäººä¿®æ”¹å¯†ç é€»è¾‘ (é€šç”¨ - å®Œæ•´ä¿®å¤ç‰ˆ) -->
<script>
// 1. æ‰“å¼€ä¿®æ”¹å¯†ç å¼¹çª— (æ”¯æŒå¼ºåˆ¶æ¨¡å¼)
function openUserPasswordModal(isForced = false) {
    // è·å–å½“å‰ç”¨æˆ·
    const user = JSON.parse(sessionStorage.getItem('CURRENT_USER'));
    if (!user) return alert("æœªæ£€æµ‹åˆ°ç™»å½•ç”¨æˆ·ï¼Œè¯·åˆ·æ–°é¡µé¢ã€‚");

    // æ¸…ç©ºè¾“å…¥æ¡†
    document.getElementById('upm-old').value = '';
    document.getElementById('upm-new').value = '';
    document.getElementById('upm-confirm').value = '';
    
    const modal = document.getElementById('user-password-modal');
    const closeBtn = modal.querySelector('button[onclick*="none"]'); // æŸ¥æ‰¾å…³é—­æŒ‰é’®

    if (isForced) {
        // ğŸ”´ å¼ºåˆ¶æ¨¡å¼ï¼šéšè—å…³é—­æŒ‰é’®ï¼Œç¦æ­¢ç‚¹å‡»èƒŒæ™¯å…³é—­
        if(closeBtn) closeBtn.style.display = 'none';
        // ç®€å•çš„é˜²æ­¢ç‚¹å‡»èƒŒæ™¯å…³é—­é€»è¾‘ (è¦†ç›– onclick)
        modal.onclick = (e) => e.stopPropagation(); 
    } else {
        // æ™®é€šæ¨¡å¼ï¼šæ˜¾ç¤ºå…³é—­æŒ‰é’®
        if(closeBtn) closeBtn.style.display = 'block';
        modal.onclick = (e) => { 
            if(e.target === modal) modal.style.display = 'none'; 
        };
    }
    
    // æ˜¾ç¤ºå¼¹çª—
    modal.style.display = 'flex';
}

// 2. æäº¤å¯†ç ä¿®æ”¹ (åŒæ­¥äº‘ç«¯)
async function submitUserPasswordChange() {
    // æ£€æŸ¥æ•°æ®åº“è¿æ¥
    if (!sbClient) return alert("âŒ äº‘ç«¯æœªè¿æ¥ï¼Œæ— æ³•ä¿®æ”¹å¯†ç ã€‚");
    
    const user = JSON.parse(sessionStorage.getItem('CURRENT_USER'));
    if (!user) return alert("æœªæ£€æµ‹åˆ°ç™»å½•ç”¨æˆ·ï¼Œè¯·åˆ·æ–°é‡è¯•ã€‚");

    // è·å–è¾“å…¥å€¼
    const oldPass = document.getElementById('upm-old').value.trim();
    const newPass = document.getElementById('upm-new').value.trim();
    const confirmPass = document.getElementById('upm-confirm').value.trim();

    // åŸºç¡€æ ¡éªŒ
    if (!oldPass || !newPass) return alert("å¯†ç ä¸èƒ½ä¸ºç©º");
    if (newPass !== confirmPass) return alert("ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´");
    if (newPass.length < 6) return alert("æ–°å¯†ç é•¿åº¦è‡³å°‘éœ€è¦ 6 ä½ï¼Œå»ºè®®ä½¿ç”¨å­—æ¯+æ•°å­—ç»„åˆ");
    if (oldPass === newPass) return alert("æ–°å¯†ç ä¸èƒ½ä¸æ—§å¯†ç ç›¸åŒ");

    UI.loading(true, "æ­£åœ¨éªŒè¯å¹¶æ›´æ–°å¯†ç ...");

    try {
        // A. éªŒè¯æ—§å¯†ç æ˜¯å¦æ­£ç¡® (å¿…é¡»å»æ•°æ®åº“æŸ¥ï¼Œé˜²æ­¢æœ¬åœ°ç¯¡æ”¹)
        const { data: verifyData, error: verifyError } = await sbClient
            .from('system_users')
            .select('*')
            .eq('username', user.name)
            .eq('password', oldPass)
            .maybeSingle();

        if (verifyError) {
            throw new Error("éªŒè¯æ—§å¯†ç æ—¶å‡ºé”™: " + verifyError.message);
        }

        if (!verifyData) {
            UI.loading(false);
            return alert("âŒ æ—§å¯†ç é”™è¯¯ï¼è¯·æ£€æŸ¥åé‡è¯•ã€‚");
        }

        // B. æ‰§è¡Œæ›´æ–°æ“ä½œ
        const { error: updateError } = await sbClient
            .from('system_users')
            .update({ password: newPass })
            .eq('username', user.name); 

        UI.loading(false);

        if (updateError) {
            throw new Error("æ›´æ–°å¯†ç å¤±è´¥: " + updateError.message);
        }

        // C. æˆåŠŸåå¤„ç†
        alert("âœ… å¯†ç ä¿®æ”¹æˆåŠŸï¼\n\nä¸ºäº†å®‰å…¨èµ·è§ï¼Œè¯·ä½¿ç”¨æ–°å¯†ç é‡æ–°ç™»å½•ã€‚");
        document.getElementById('user-password-modal').style.display = 'none';
        
        // å¼ºåˆ¶ç™»å‡º
        Auth.logout(); 

    } catch (e) {
        UI.loading(false);
        console.error(e);
        alert("âŒ ä¿®æ”¹å¤±è´¥ï¼š" + e.message);
    }
}
</script>

<!-- æ ¸å¿ƒé€»è¾‘è„šæœ¬ -->
<script src="./assets/js/app.js"></script>

<script>
    // âœ‹ ğŸ”´ [å·²ç§»é™¤]ï¼šåˆ é™¤äº†æ•´ä¸ª MobApp å¯¹è±¡åŠå…¶æ‰€æœ‰é€»è¾‘ï¼Œç¡®ä¿æ‰‹æœºç«¯ä¸å†åŠ è½½æç®€ç‰ˆä»£ç  ğŸ”´
</script>
<button id="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" 
        style="position: fixed; bottom: 30px; left: 30px; width: 45px; height: 45px; 
               border-radius: 50%; background: rgba(30, 41, 59, 0.8); color: white; 
               border: none; cursor: pointer; display: none; z-index: 999; 
               box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;">
    <i class="ti ti-arrow-up" style="font-size: 20px;"></i>
</button>

<script>
    // ç›‘å¬æ»šåŠ¨ï¼Œè‡ªåŠ¨æ˜¾ç¤º/éšè—æŒ‰é’®
    window.addEventListener('scroll', () => {
        const btn = document.getElementById('back-to-top');
        if (window.scrollY > 300) {
            btn.style.display = 'block';
            btn.style.opacity = '1';
        } else {
            btn.style.display = 'none';
        }
    });
</script>
<!-- ä¿®æ”¹å¯†ç æ¨¡æ€æ¡† -->
<div id="user-password-modal" class="modal" style="display: none; z-index: 70000;">
    <div class="modal-content" style="max-width: 400px;">
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px;">
            <h3 style="color:var(--primary); margin:0;"><i class="ti ti-lock"></i> ä¿®æ”¹ä¸ªäººå¯†ç </h3>
            <button onclick="document.getElementById('user-password-modal').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button>
        </div>
        
        <div style="display:flex; flex-direction:column; gap:15px;">
            <div>
                <label style="font-size:12px; font-weight:bold; color:#666;">å½“å‰æ—§å¯†ç </label>
                <input type="password" id="upm-old" placeholder="è¾“å…¥å½“å‰å¯†ç " style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px;">
            </div>
            <div>
                <label style="font-size:12px; font-weight:bold; color:#666;">æ–°å¯†ç  (å»ºè®®å­—æ¯+æ•°å­—)</label>
                <input type="password" id="upm-new" placeholder="è¾“å…¥æ–°å¯†ç " style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px;">
            </div>
            <div>
                <label style="font-size:12px; font-weight:bold; color:#666;">ç¡®è®¤æ–°å¯†ç </label>
                <input type="password" id="upm-confirm" placeholder="å†æ¬¡è¾“å…¥æ–°å¯†ç " style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px;">
            </div>
            
            <button class="btn btn-primary" onclick="submitUserPasswordChange()" style="padding:12px; margin-top:10px;">
                ç¡®è®¤ä¿®æ”¹å¹¶åŒæ­¥
            </button>
        </div>
    </div>
</div>

<!-- 1. å®¶é•¿ç«¯ï¼šç”³è¯‰æäº¤å¼¹çª— -->
<div id="issue-submit-modal" class="modal" style="display: none; z-index: 75000;">
    <div class="modal-content" style="max-width: 500px;">
        <div style="border-bottom:1px solid #eee; padding-bottom:15px; margin-bottom:15px;">
            <h3 style="color:#b45309; margin:0; font-size:18px;">ğŸ“ æˆç»©æ ¸æŸ¥ç”³è¯·</h3>
            <p style="font-size:12px; color:#666; margin-top:5px;">è¯·å¡«å†™å…·ä½“é—®é¢˜ï¼Œæ•™åŠ¡å¤„å°†åœ¨æ ¸å®åå¤„ç†ã€‚</p>
        </div>
        
        <div style="display:grid; gap:15px;">
            <!-- éšè—åŸŸï¼šè‡ªåŠ¨å¡«å……å­¦ç”Ÿä¿¡æ¯ -->
            <div style="background:#f9fafb; padding:10px; border-radius:6px; font-size:13px; color:#374151; display:flex; gap:10px;">
                <input type="text" id="issue-student-school" readonly style="flex:1; border:none; background:transparent; font-weight:bold;">
                <input type="text" id="issue-student-class" readonly style="width:60px; border:none; background:transparent; font-weight:bold;">
                <input type="text" id="issue-student-name" readonly style="width:80px; border:none; background:transparent; font-weight:bold;">
            </div>

            <div>
                <label style="font-size:12px; font-weight:bold; color:#374151;">é—®é¢˜ç±»å‹</label>
                <select id="issue-type" style="width:100%; padding:8px; border:1px solid #d1d5db; border-radius:6px; margin-top:5px;">
                    <option value="ç¼ºè€ƒ/é›¶åˆ†">âŒ æ˜¾ç¤ºç¼ºè€ƒ/é›¶åˆ† (å®é™…å·²è€ƒ)</option>
                    <option value="åˆ†æ•°é”™è¯¯">ğŸ“‰ åˆ†æ•°ä¸é¢„ä¼°ä¸¥é‡ä¸ç¬¦</option>
                    <option value="ä¿¡æ¯æœ‰è¯¯">ğŸ†” å§“å/è€ƒå·é”™è¯¯</option>
                    <option value="å…¶ä»–">ğŸ“ å…¶ä»–é—®é¢˜</option>
                </select>
            </div>

            <div>
                <label style="font-size:12px; font-weight:bold; color:#374151;">å…·ä½“è¯´æ˜ (å¿…å¡«)</label>
                <textarea id="issue-desc" rows="4" placeholder="ä¾‹å¦‚ï¼šæ•°å­¦è¯•å·å·²äº¤ï¼Œä½†ç³»ç»Ÿæ˜¾ç¤º0åˆ†ã€‚å¤§è‡´é¢„ä¼°åˆ†æ•°ä¸º90åˆ†å·¦å³ã€‚" style="width:100%; padding:10px; border:1px solid #d1d5db; border-radius:6px; margin-top:5px; font-size:14px;"></textarea>
            </div>

            <div>
                <label style="font-size:12px; font-weight:bold; color:#374151;">è”ç³»ç”µè¯ (é€‰å¡«)</label>
                <input type="text" id="issue-contact" placeholder="æ–¹ä¾¿è€å¸ˆå›è®¿" style="width:100%; padding:8px; border:1px solid #d1d5db; border-radius:6px; margin-top:5px;">
            </div>

            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn btn-gray" style="flex:1;" onclick="document.getElementById('issue-submit-modal').style.display='none'">å–æ¶ˆ</button>
                <button class="btn btn-primary" style="flex:1; background:#b45309;" onclick="IssueManager.submit()">ğŸš€ æäº¤ç”³è¯·</button>
            </div>
        </div>
    </div>
</div>

<!-- 2. ç®¡ç†å‘˜ç«¯ï¼šæ¶ˆæ¯å¤„ç†ä¸­å¿ƒ -->
<div id="admin-issue-modal" class="modal" style="display: none; z-index: 76000;">
    <div class="modal-content" style="max-width: 800px; height: 80vh; display: flex; flex-direction: column;">
        <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:10px;">
            <div style="display:flex; align-items:center; gap:10px;">
                <!-- åŠ¨æ€æ ‡é¢˜ ID -->
                <h3 style="color:var(--primary); margin:0;" id="issue-modal-title"><i class="ti ti-bell"></i> ç”³è¯‰åé¦ˆä¸­å¿ƒ</h3>
                <button class="btn btn-sm btn-gray" onclick="IssueManager.loadIssues()"><i class="ti ti-refresh"></i> åˆ·æ–°</button>
            </div>
            <button onclick="document.getElementById('admin-issue-modal').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button>
        </div>
        
        <!-- æ“ä½œå·¥å…·æ  (åŒ…å«æ­£å¸¸æ¨¡å¼å’Œå†å²æ¨¡å¼ä¸¤å¥—æŒ‰é’®) -->
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            
            <!-- A. æ­£å¸¸æ¨¡å¼çš„æ“ä½œæŒ‰é’® -->
            <div style="display:flex; gap:10px;" id="issue-normal-actions">
                <button class="btn btn-sm btn-danger" onclick="IssueManager.batchSoftDelete()">
                    <i class="ti ti-trash"></i> æ‰¹é‡åˆ é™¤ (æ”¾å…¥å›æ”¶ç«™)
                </button>
                <div style="font-size:12px; color:#666; display:flex; align-items:center;">
                    <input type="checkbox" id="issue-check-all" onchange="IssueManager.toggleSelectAll(this)" style="margin-right:5px;"> å…¨é€‰
                </div>
            </div>
            
            <!-- B. å†å²è®°å½•æ¨¡å¼çš„æ“ä½œæŒ‰é’® (é»˜è®¤éšè—) -->
            <div style="display:none; gap:10px;" id="issue-history-actions">
                <button class="btn btn-sm btn-danger" style="background:#b91c1c; border-color:#991b1b;" onclick="IssueManager.batchHardDelete()">
                    <i class="ti ti-trash-x"></i> å½»åº•ç²‰ç¢é€‰ä¸­
                </button>
                <button class="btn btn-sm btn-green" onclick="IssueManager.batchRestore()">
                    <i class="ti ti-rotate"></i> è¿˜åŸé€‰ä¸­
                </button>
                <div style="font-size:12px; color:#666; display:flex; align-items:center;">
                    <input type="checkbox" id="issue-history-check-all" onchange="IssueManager.toggleSelectAll(this)" style="margin-right:5px;"> å…¨é€‰
                </div>
            </div>

            <!-- C. åˆ‡æ¢è§†å›¾æŒ‰é’® -->
            <div>
                <button class="btn btn-sm btn-gray" id="btn-issue-history" onclick="IssueManager.toggleHistoryView()">
                    <i class="ti ti-history"></i> æŸ¥çœ‹åˆ é™¤å†å²
                </button>
            </div>
        </div>

        <!-- æç¤ºæ¡ -->
        <div id="issue-tip-bar" style="background:#fffbeb; color:#92400e; padding:10px; border-radius:6px; font-size:12px; margin-bottom:10px;">
            <i class="ti ti-info-circle"></i> æç¤ºï¼šå¤„ç†å®Œé—®é¢˜åï¼Œè¯·ç‚¹å‡»â€œæ ‡è®°å·²é˜…/è§£å†³â€ã€‚ç‚¹å‡»â€œæ‰¹é‡åˆ é™¤â€ä¼šå°†è®°å½•ç§»å…¥å†å²è®°å½•ã€‚
        </div>

        <!-- åˆ—è¡¨å®¹å™¨ -->
        <div id="admin-issue-list" style="flex:1; overflow-y:auto; background:#f9fafb; padding:10px; border-radius:8px; border:1px solid #e5e7eb;">
            <!-- JS åŠ¨æ€åŠ è½½å†…å®¹ -->
        </div>
    </div>
</div>

<!-- 3. ç®¡ç†å‘˜ç«¯ï¼šæ“ä½œæ—¥å¿—ç®¡ç†ä¸­å¿ƒ -->
<div id="admin-log-modal" class="modal" style="display: none; z-index: 77000;">
    <div class="modal-content" style="max-width: 900px; height: 85vh; display: flex; flex-direction: column;">
        <!-- æ ‡é¢˜æ  -->
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:10px;">
            <div style="display:flex; align-items:center; gap:10px;">
                <h3 style="color:#333; margin:0;" id="log-modal-title"><i class="ti ti-history"></i> ç³»ç»Ÿæ“ä½œæ—¥å¿—</h3>
                <button class="btn btn-sm btn-gray" onclick="Logger.loadLogs()"><i class="ti ti-refresh"></i> åˆ·æ–°</button>
            </div>
            <button onclick="document.getElementById('admin-log-modal').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button>
        </div>
        
        <!-- æ“ä½œæ  -->
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <!-- æ­£å¸¸æ¨¡å¼æŒ‰é’® -->
            <div style="display:flex; gap:10px;" id="log-normal-actions">
                <button class="btn btn-sm btn-danger" onclick="Logger.batchSoftDelete()">
                    <i class="ti ti-trash"></i> æ‰¹é‡åˆ é™¤
                </button>
                <div style="font-size:12px; color:#666; display:flex; align-items:center;">
                    <input type="checkbox" id="log-check-all" onchange="Logger.toggleSelectAll(this)" style="margin-right:5px;"> å…¨é€‰
                </div>
            </div>
            
            <!-- å†å²æ¨¡å¼æŒ‰é’® -->
            <div style="display:none; gap:10px;" id="log-history-actions">
                <button class="btn btn-sm btn-danger" style="background:#b91c1c;" onclick="Logger.batchHardDelete()">
                    <i class="ti ti-trash-x"></i> å½»åº•ç²‰ç¢é€‰ä¸­
                </button>
                <button class="btn btn-sm btn-green" onclick="Logger.batchRestore()">
                    <i class="ti ti-rotate"></i> è¿˜åŸé€‰ä¸­
                </button>
                <div style="font-size:12px; color:#666; display:flex; align-items:center;">
                    <input type="checkbox" id="log-history-check-all" onchange="Logger.toggleSelectAll(this)" style="margin-right:5px;"> å…¨é€‰
                </div>
            </div>

            <!-- è§†å›¾åˆ‡æ¢ -->
            <div>
                <button class="btn btn-sm btn-gray" id="btn-log-history" onclick="Logger.toggleHistoryView()">
                    <i class="ti ti-recycle"></i> æ—¥å¿—å›æ”¶ç«™
                </button>
            </div>
        </div>

        <!-- åˆ—è¡¨å®¹å™¨ -->
        <div id="admin-log-list" style="flex:1; overflow-y:auto; background:#f9fafb; padding:0; border:1px solid #e5e7eb; border-radius:4px;">
            <!-- è¡¨æ ¼å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
        </div>
        
        <!-- åº•éƒ¨ç®€å•åˆ†é¡µæˆ–ç»Ÿè®¡ -->
        <div style="padding-top:10px; font-size:12px; color:#999; text-align:right;">
            æ˜¾ç¤ºæœ€è¿‘ 100 æ¡è®°å½•
        </div>
    </div>
</div>

<!-- 4. é€šç”¨ï¼šè´¦å·æœç´¢ä¸å¯†ç ç®¡ç† (å¤šè§’è‰²æƒé™) -->
<div id="account-manager-modal" class="modal" style="display: none; z-index: 78000;">
    <div class="modal-content" style="max-width: 700px; height: 80vh; display: flex; flex-direction: column;">
        
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px;">
            <h3 style="color:var(--primary); margin:0;"><i class="ti ti-user-search"></i> è´¦å·æœç´¢ä¸ç®¡ç†</h3>
            <button onclick="document.getElementById('account-manager-modal').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button>
        </div>

        <!-- æœç´¢åŒº -->
        <div style="background:#f8fafc; padding:15px; border-radius:8px; border:1px solid #e2e8f0; margin-bottom:15px;">
            <div style="display:flex; gap:10px;">
                <input type="text" id="acc-search-input" placeholder="è¾“å…¥å§“åæˆ–è´¦å·è¿›è¡ŒæŸ¥æ‰¾..." 
                       style="flex:1; padding:10px; border:1px solid #cbd5e1; border-radius:6px;"
                       onkeydown="if(event.key==='Enter') AccountManager.search()">
                <button class="btn btn-primary" onclick="AccountManager.search()">
                    <i class="ti ti-search"></i> æœç´¢
                </button>
            </div>
            <div id="acc-permission-hint" style="font-size:12px; color:#64748b; margin-top:8px;">
                <!-- JS ä¼šåœ¨è¿™é‡Œæ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„æƒé™èŒƒå›´æç¤º -->
            </div>
        </div>

        <!-- åˆ—è¡¨å®¹å™¨ -->
        <div class="table-wrap" style="flex:1; overflow-y:auto; box-shadow:none; border:1px solid #e2e8f0;">
            <table id="acc-result-table">
                <thead>
                    <tr>
                        <th>è´¦å·/å§“å</th>
                        <th>è§’è‰²</th>
                        <th>ç­çº§/èŒƒå›´</th>
                        <th>å½“å‰å¯†ç </th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="5" style="text-align:center; padding:30px; color:#999;">è¯·è¾“å…¥å…³é”®å­—æœç´¢</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 5. æ•°æ®ç»¼åˆç®¡ç†åå° (æˆç»©/æ•™å¸ˆ/æ¡£æ¡ˆ) -->
<div id="data-manager-modal" class="modal" style="display: none; z-index: 79000;">
    <div class="modal-content" style="max-width: 900px; height: 90vh; display: flex; flex-direction: column;">
        
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px;">
            <!-- âœ‹ ğŸ”´ [æ—§ä»£ç ]ï¼šæ ‡é¢˜ -->
            <h3 style="color:#0f172a; margin:0;"><i class="ti ti-database-edit"></i> æ•™åŠ¡æ•°æ®ç»¼åˆç®¡ç†</h3>
            <!-- ğŸŸ¢ [æ–°ä»£ç ]ï¼šä¿®æ”¹æ ‡é¢˜ï¼Œä½“ç°äº‘ç«¯å±æ€§ -->
            <h3 style="color:#0f172a; margin:0;"><i class="ti ti-cloud-cog"></i> äº‘ç«¯æ•™åŠ¡æ•°æ®ç»¼åˆæ§åˆ¶å°</h3>
            <!-- âœ‹ ğŸŸ¢ [ä¿®æ”¹ç»“æŸ] -->

            <div style="display:flex; gap:10px;">
                <button class="btn btn-sm btn-purple" onclick="DataManager.saveAndSync()">
                    <i class="ti ti-cloud-upload"></i> ä¿å­˜ä¿®æ”¹å¹¶åŒæ­¥äº‘ç«¯
                </button>
                <button onclick="document.getElementById('data-manager-modal').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">&times;</button>
            </div>
        </div>

        <!-- é¡¶éƒ¨ Tab åˆ‡æ¢ -->
        <div style="display:flex; gap:10px; margin-bottom:15px; border-bottom:1px solid #e2e8f0; padding-bottom:10px; overflow-x:auto;">
            <div class="login-tab active" id="tab-data-stu" onclick="DataManager.switchTab('student')">
                <i class="ti ti-users"></i> å­¦ç”Ÿæˆç»©
            </div>
            
            <div class="login-tab" id="tab-data-tea" onclick="DataManager.switchTab('teacher')">
                <i class="ti ti-id"></i> æ•™å¸ˆä»»è¯¾
            </div>
                        
            <div class="login-tab" id="tab-data-params" onclick="DataManager.switchTab('params')">
                <i class="ti ti-settings"></i> å¹´çº§æŒ‡æ ‡å‚æ•°
            </div>
            <div class="login-tab" id="tab-data-targets" onclick="DataManager.switchTab('targets')">
                <i class="ti ti-target"></i> ç›®æ ‡äººæ•°ç®¡ç†
            </div>
                      
            <div class="login-tab" id="tab-data-sql" onclick="DataManager.switchTab('sql')">
                <i class="ti ti-terminal-2"></i> SQL æé€ŸæŸ¥è¯¢
            </div>
            <div class="login-tab" id="tab-data-cloud" onclick="DataManager.switchTab('cloud')">
                <i class="ti ti-cloud"></i> äº‘ç«¯å­˜æ¡£ç®¡ç†
            </div>
            <div class="login-tab" id="tab-data-history" onclick="DataManager.switchTab('history')">
                <i class="ti ti-history"></i> å†å²æ•°æ®å¯¹æ¯”
            </div>
        </div>

        <!-- æœç´¢å·¥å…·æ  (ä»…åœ¨å­¦ç”Ÿ/æ•™å¸ˆ Tab æ˜¾ç¤º) -->
        <div id="dm-search-bar" style="background:#f8fafc; padding:10px; border-radius:8px; border:1px solid #e2e8f0; margin-bottom:10px; display:flex; gap:10px;">
            <input type="text" id="dm-search-input" placeholder="è¾“å…¥å§“å/ç­çº§/è€ƒå·ç­›é€‰..." 
                   style="flex:1; padding:8px; border:1px solid #cbd5e1; border-radius:4px;"
                   oninput="DataManager.renderCurrentTab()">
            <button class="btn btn-sm btn-primary" onclick="DataManager.renderCurrentTab()">æœç´¢</button>
            <span id="dm-stu-selected-count" style="align-self:center; font-size:12px; color:#475569; white-space:nowrap;">å·²é€‰ 0 é¡¹</span>
            <button class="btn btn-sm btn-danger" id="dm-stu-batch-delete" onclick="DataManager.deleteSelectedStudents()" disabled style="opacity:0.6; white-space:nowrap;">æ‰¹é‡åˆ é™¤</button>
        </div>

        <!-- åˆ—è¡¨å®¹å™¨ -->
        <div class="table-wrap" style="flex:1; overflow-y:auto; box-shadow:none; border:1px solid #e2e8f0;">
            <!-- å­¦ç”Ÿè¡¨ -->
            <table id="dm-student-table" style="font-size:12px;">
                <thead>
                    <tr><th style="width:40px; text-align:center;"><input type="checkbox" id="dm-stu-select-all" onchange="DataManager.toggleStudentSelectAll(this.checked)"></th><th>å­¦æ ¡</th><th>ç­çº§</th><th>å§“å</th><th>è€ƒå·</th><th>æ€»åˆ†</th><th>æ“ä½œ</th></tr>
                </thead>
                <tbody></tbody>
            </table>

            <!-- ==================== æ•™å¸ˆä»»è¯¾ç®¡ç†åŒºåŸŸ ==================== -->
            <div id="dm-teacher-area" style="display:none;">
                <!-- é¡¶éƒ¨æ§åˆ¶æ  -->
                <div style="background:#f8fafc; padding:12px; border-bottom:2px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:12px; position:sticky; top:0; z-index:10; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                    
                    <!-- å·¦ä¾§ï¼šå­¦æ ¡å’Œå­¦æœŸé€‰æ‹© -->
                    <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
                        <div style="display:flex; align-items:center; gap:6px;">
                            <label style="font-weight:bold; color:#334155; font-size:13px;">ğŸ« æœ¬æ ¡ï¼š</label>
                            <select id="dm-teacher-school-select" style="padding:6px 10px; width:160px; font-size:12px; border:1px solid #cbd5e1; border-radius:6px; outline:none;" onchange="DataManager.updateTeacherSchoolFilter()">
                                <option value="">-- æ˜¾ç¤ºå…¨éƒ¨ --</option>
                            </select>
                        </div>
                        
                        <div style="display:flex; align-items:center; gap:6px;">
                            <label style="font-weight:bold; color:#334155; font-size:13px;">ğŸ“… å­¦æœŸï¼š</label>
                            <select id="dm-teacher-term-select" style="padding:6px 10px; width:200px; font-size:12px; border:1px solid #cbd5e1; border-radius:6px; outline:none;" onchange="DataManager.switchTeacherTerm(this.value)"></select>
                        </div>
                    </div>

                    <!-- å³ä¾§ï¼šæ“ä½œæŒ‰é’®ç»„ -->
                    <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                        <button class="btn btn-sm btn-purple" onclick="CloudManager.loadTeachers()" title="ä»äº‘ç«¯åŒæ­¥æœ¬å­¦æœŸçš„æ•™å¸ˆä»»è¯¾æ•°æ®" style="padding:6px 12px; font-size:12px; display:flex; align-items:center; gap:4px;">
                            <i class="ti ti-cloud-download"></i> äº‘ç«¯åŒæ­¥
                        </button>

                        <button class="btn btn-sm btn-orange" onclick="CloudManager.saveTeachers()" title="ä¿å­˜å½“å‰æ•™å¸ˆä»»è¯¾æ•°æ®åˆ°äº‘ç«¯" style="padding:6px 12px; font-size:12px; display:flex; align-items:center; gap:4px;">
                            <i class="ti ti-cloud-upload"></i> ä¸Šä¼ äº‘ç«¯
                        </button>

                        <button class="btn btn-sm btn-green" onclick="document.getElementById('dm-teacher-file').click()" title="å¯¼å…¥Excelæ ¼å¼çš„æ•™å¸ˆä»»è¯¾è¡¨" style="padding:6px 12px; font-size:12px; display:flex; align-items:center; gap:4px;">
                            <i class="ti ti-file-import"></i> Excelå¯¼å…¥
                        </button>
                        <input type="file" id="dm-teacher-file" accept=".xlsx,.xls" hidden onchange="DataManager.handleTeacherUpload(this)">
                        
                        <button class="btn btn-sm btn-primary" onclick="DataManager.addTeacher()" title="æ‰‹åŠ¨æ·»åŠ ä¸€æ¡æ•™å¸ˆä»»è¯¾è®°å½•" style="padding:6px 12px; font-size:12px; display:flex; align-items:center; gap:4px;">
                            <i class="ti ti-plus"></i> æ‰‹åŠ¨æ–°å¢
                        </button>
                        
                        <button class="btn btn-sm" onclick="downloadTemplate('teacher')" title="ä¸‹è½½æ•™å¸ˆä»»è¯¾è¡¨Excelæ¨¡æ¿" style="padding:6px 12px; font-size:12px; background:white; border:1px solid #cbd5e1; color:#475569; display:flex; align-items:center; gap:4px;">
                            <i class="ti ti-download"></i> ä¸‹è½½æ¨¡æ¿
                        </button>
                    </div>
                </div>

                <!-- æç¤ºä¿¡æ¯æ  -->
                <div style="background:#eff6ff; border-left:4px solid #3b82f6; padding:10px 15px; margin:10px; font-size:12px; color:#1e40af; border-radius:4px;">
                    <div style="display:flex; align-items:center; gap:8px;">
                        <i class="ti ti-info-circle" style="font-size:16px;"></i>
                        <div>
                            <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>
                            <ul style="margin:5px 0 0 20px; padding:0; line-height:1.6;">
                                <li>é€‰æ‹©å­¦æœŸåï¼Œå¯ä»¥ä»äº‘ç«¯åŒæ­¥æˆ–å¯¼å…¥Excelæ–‡ä»¶</li>
                                <li>Excelæ ¼å¼è¦æ±‚ï¼š<strong>ç­çº§</strong>ã€<strong>å­¦ç§‘</strong>ã€<strong>æ•™å¸ˆå§“å</strong> ä¸‰åˆ—</li>
                                <li>å¯¼å…¥åæ•°æ®è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°ï¼Œç‚¹å‡»ã€Œä¸Šä¼ äº‘ç«¯ã€å¯åŒæ­¥åˆ°äº‘ç«¯æ•°æ®åº“</li>
                                <li>æ•™å¸ˆä»»è¯¾æ•°æ®ä¼šåœ¨ã€Œç­çº§æ•™å­¦ç®¡ç†ã€ç­‰æ¨¡å—ä¸­è‡ªåŠ¨å¼•ç”¨</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- æ•™å¸ˆä»»è¯¾è¡¨æ ¼ -->
                <div style="margin:10px;">
                    <table id="dm-teacher-table" style="font-size:12px; width:100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background:#f8fafc; border-bottom:2px solid #e2e8f0;">
                                <th style="padding:10px; text-align:left; font-weight:bold; color:#475569; border-right:1px solid #e2e8f0; width:20%;">å­¦æ ¡</th>
                                <th style="padding:10px; text-align:left; font-weight:bold; color:#475569; border-right:1px solid #e2e8f0; width:15%;">ç­çº§</th>
                                <th style="padding:10px; text-align:left; font-weight:bold; color:#475569; border-right:1px solid #e2e8f0; width:15%;">å­¦ç§‘</th>
                                <th style="padding:10px; text-align:left; font-weight:bold; color:#475569; border-right:1px solid #e2e8f0; width:20%;">æ•™å¸ˆå§“å</th>
                                <th style="padding:10px; text-align:center; font-weight:bold; color:#475569; width:30%;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- æ¡£æ¡ˆç®¡ç†åŒºåŸŸ -->
            <!-- D. å¹´çº§æŒ‡æ ‡å‚æ•°è®¾ç½®åŒºåŸŸ (ä¿æŒä¸å˜ï¼Œä»…ä¸ºäº†å®šä½) -->
            <div id="dm-params-area" style="display:none; padding:20px;">
                <div style="background:#f0f9ff; border:1px solid #bae6fd; padding:20px; border-radius:8px;">
                    <h4 style="color:#0369a1; margin-bottom:15px; border-bottom:1px dashed #bae6fd; padding-bottom:10px;">
                        <i class="ti ti-settings"></i> å¹´çº§åˆ’çº¿å‚æ•°é…ç½®
                    </h4>
                    <div id="dm-params-tip" style="display:none; background:#fff7ed; border:1px dashed #fdba74; color:#9a3412; padding:8px 10px; border-radius:6px; font-size:12px; margin-bottom:12px;">
                        æç¤ºï¼šå½“å‰é 9 å¹´çº§æœŸä¸­/æœŸæœ«ï¼Œå‚æ•°ä»…ç”¨äºé¢„è®¾ï¼Œä¸å‚ä¸è®¡ç®—ã€‚
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                        <div>
                            <label style="font-weight:bold; display:block; margin-bottom:5px;">æŒ‡æ ‡ä¸€ (ä¼˜ç”Ÿçº¿) åˆ’çº¿åæ¬¡ï¼š</label>
                            <input type="number" id="dm_ind1_input" class="mob-input" style="background:white;" placeholder="ä¾‹å¦‚: 500">
                            <p style="font-size:12px; color:#64748b; margin-top:5px;">å…¨é•‡æ€»åˆ†æ’åç¬¬ N åçš„åˆ†æ•°å°†ä½œä¸ºä¼˜ç”Ÿçº¿ã€‚</p>
                        </div>
                        <div>
                            <label style="font-weight:bold; display:block; margin-bottom:5px;">æŒ‡æ ‡äºŒ (æ™®é«˜çº¿) åˆ’çº¿åæ¬¡ï¼š</label>
                            <input type="number" id="dm_ind2_input" class="mob-input" style="background:white;" placeholder="ä¾‹å¦‚: 1200">
                            <p style="font-size:12px; color:#64748b; margin-top:5px;">å…¨é•‡æ€»åˆ†æ’åç¬¬ N åçš„åˆ†æ•°å°†ä½œä¸ºåŠæ ¼/æ™®é«˜çº¿ã€‚</p>
                        </div>
                    </div>
                    <div style="margin-top:20px; text-align:right;">
                        <button class="btn btn-primary" onclick="DataManager.saveParamsLocally()">
                            <i class="ti ti-device-floppy"></i> æš‚å­˜å‚æ•° (éœ€ç‚¹å‡»å³ä¸Šè§’ä¿å­˜åŒæ­¥)
                        </button>
                    </div>
                </div>
            </div>

            <!-- ğŸ‘‡ğŸ‘‡ğŸ‘‡ âœ‹ ğŸ”´ [ä¿®æ”¹å¼€å§‹]ï¼šä¿®æ”¹ç›®æ ‡ç®¡ç†åŒºåŸŸï¼Œæ”¹ä¸ºæ–‡ä»¶å¯¼å…¥æ¨¡å¼ ğŸ”´ âœ‹ ğŸ‘‡ğŸ‘‡ğŸ‘‡ -->
            <!-- E. ç›®æ ‡äººæ•°ç®¡ç†åŒºåŸŸ -->
            <div id="dm-targets-area" style="display:none; padding:15px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <h4 style="margin:0; color:#166534;"><i class="ti ti-target"></i> å„æ ¡ç›®æ ‡äººæ•°ç®¡ç†</h4>
                    
                    <!-- ğŸŸ¢ [æ–°ä»£ç ]ï¼šæ”¹ä¸ºå¯¼å…¥æŒ‰é’® + éšè—çš„æ–‡ä»¶è¾“å…¥æ¡† -->
                    <div>
                        <button class="btn btn-sm btn-green" onclick="document.getElementById('dm-target-file').click()">
                            <i class="ti ti-file-import"></i> å¯¼å…¥ç›®æ ‡äººæ•°æ–‡ä»¶ (.xlsx)
                        </button>
                        <input type="file" id="dm-target-file" accept=".xlsx,.xls" hidden onchange="DataManager.handleTargetUpload(this)">
                        
                        <a href="javascript:void(0)" style="font-size:12px; margin-left:10px; color:#666; text-decoration:underline;" onclick="alert('Excelæ ¼å¼è¦æ±‚ï¼š\nç¬¬ä¸€åˆ—ï¼šå­¦æ ¡åç§°\nç¬¬äºŒåˆ—ï¼šæŒ‡æ ‡ä¸€ç›®æ ‡äººæ•°\nç¬¬ä¸‰åˆ—ï¼šæŒ‡æ ‡äºŒç›®æ ‡äººæ•°')">æ ¼å¼è¯´æ˜</a>
                    </div>
                    <!-- ğŸ‘† ğŸŸ¢ [ä¿®æ”¹ç»“æŸ] -->
                </div>
                
                <div class="info-bar" style="margin-bottom:10px;">
                    ğŸ’¡ æç¤ºï¼šå¯¼å…¥åè¯·ç‚¹å‡»å³ä¸Šè§’ã€ä¿å­˜ä¿®æ”¹å¹¶åŒæ­¥äº‘ç«¯ã€‘æŒ‰é’®ï¼Œä»¥é˜²æ­¢åˆ·æ–°åä¸¢å¤±ã€‚
                </div>

                <div class="table-wrap" style="box-shadow:none; border:1px solid #e2e8f0; max-height: 60vh; overflow-y: auto;">
                    <table class="comparison-table" style="font-size:13px;">
                        <thead>
                            <tr>
                                <th>å­¦æ ¡åç§°</th>
                                <th style="background:#e0f2fe;">æŒ‡æ ‡ä¸€ç›®æ ‡ (äºº)</th>
                                <th style="background:#fff7ed;">æŒ‡æ ‡äºŒç›®æ ‡ (äºº)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="dm-targets-tbody">
                            <!-- JS åŠ¨æ€æ¸²æŸ“ -->
                        </tbody>
                    </table>
                </div>
            </div>
        
        <div id="dm-sql-area" style="display:none; padding:15px; height:100%; flex-direction:column;">
            <!-- æç¤ºä¸å¸¸ç”¨è¯­å¥ -->
            <div style="margin-bottom:10px; display:flex; gap:10px; flex-wrap:wrap;">
                <button class="btn btn-sm btn-gray" onclick="DataManager.setQuickSQL('base')">ğŸ“‹ æŸ¥å‰10å</button>
                <button class="btn btn-sm btn-gray" onclick="DataManager.setQuickSQL('count')">ğŸ“Š å„æ ¡äººæ•°</button>
                <button class="btn btn-sm btn-gray" onclick="DataManager.setQuickSQL('avg')">ğŸ“ˆ å„ç­å‡åˆ†</button>
                <button class="btn btn-sm btn-gray" onclick="DataManager.setQuickSQL('failed')">ğŸ“‰ ä¸åŠæ ¼åå•</button>
                <button class="btn btn-sm btn-gray" onclick="DataManager.setQuickSQL('teacher')">ğŸ‘©â€ğŸ« æŸ¥ä»»è¯¾å­¦ç”Ÿ</button>
                <div style="flex:1; text-align:right; font-size:12px; color:#666; align-self:center;">
                    è¡¨å: <b>students</b> (æˆç»©), <b>teachers</b> (ä»»è¯¾)
                </div>
            </div>

            <!-- å†å²ä¸æ”¶è— -->
            <div style="margin-bottom:10px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
                <select id="dm-sql-history-select" style="min-width:220px; padding:6px 8px; border:1px solid #cbd5e1; border-radius:6px; font-size:12px;" onchange="DataManager.applySQLHistory(this.value)">
                    <option value="">ğŸ•˜ æœ€è¿‘/æ”¶è—</option>
                </select>
                <input id="dm-sql-history-name" type="text" placeholder="æ”¶è—åç§°(å¯é€‰)" style="padding:6px 8px; border:1px solid #cbd5e1; border-radius:6px; font-size:12px; width:180px;">
                <button class="btn btn-sm btn-green" onclick="DataManager.saveNamedSQL()">â­ ä¿å­˜æ”¶è—</button>
                <button class="btn btn-sm btn-gray" onclick="DataManager.clearSQLHistory()">ğŸ§¹ æ¸…ç©ºå†å²</button>
            </div>

            <!-- Talk to Data è‡ªç„¶è¯­è¨€æŸ¥æ•° -->
            <div style="margin-bottom:10px; display:flex; gap:8px; flex-wrap:wrap; align-items:center; background:#f8fafc; border:1px dashed #cbd5e1; border-radius:8px; padding:8px;">
                <input id="dm-nlq-input" type="text" placeholder="ä¾‹å¦‚ï¼šæ‰¾å‡º701ç­ç‰©ç†ä¸åŠæ ¼ä½†æ•°å­¦å‰10åçš„å­¦ç”Ÿ" style="flex:1; min-width:280px; padding:6px 8px; border:1px solid #cbd5e1; border-radius:6px; font-size:12px;">
                <button class="btn btn-sm btn-purple" onclick="talkToData()">ğŸ’¬ è‡ªç„¶è¯­è¨€æŸ¥æ•°</button>
                <span id="dm-nlq-status" style="font-size:12px; color:#64748b;"></span>
            </div>

            <!-- SQL è¾“å…¥æ¡† -->
            <textarea id="dm-sql-input" style="width:100%; height:120px; background:#1e293b; color:#a5b4fc; font-family:'Consolas', monospace; padding:10px; border-radius:6px; font-size:14px; border:1px solid #475569; resize:none;" placeholder="åœ¨æ­¤è¾“å…¥ SQL è¯­å¥..."></textarea>
            
            <!-- æ“ä½œæ  -->
            <div style="margin:10px 0; display:flex; justify-content:space-between;">
                <div id="sql-status-msg" style="font-size:12px; color:#ef4444; font-weight:bold;"></div>
                <div>
                    <button class="btn btn-sm btn-green" onclick="DataManager.exportSQLResult()">ğŸ“¥ å¯¼å‡ºç»“æœ Excel</button>
                    <button class="btn btn-primary" onclick="DataManager.runSQL()"><i class="ti ti-player-play"></i> æ‰§è¡ŒæŸ¥è¯¢ (Run)</button>
                </div>
            </div>

            <!-- ç»“æœè¡¨æ ¼å®¹å™¨ -->
            <div class="table-wrap" style="flex:1; overflow:auto; border:1px solid #e2e8f0; border-radius:4px; box-shadow:none;">
                <table id="dm-sql-table" style="font-size:12px; width:100%;">
                    <thead><tr><th>æŸ¥è¯¢ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="dm-cloud-area" style="display:none; padding:15px; flex-direction:column; height:100%;">
            <div class="info-bar">
                <i class="ti ti-cloud"></i> <strong>æˆ‘çš„äº‘ç«¯æ•°æ®ç®¡ç†ï¼š</strong> 
                æ­¤å¤„åˆ—å‡ºæ‚¨ä¸Šä¼ åˆ°äº‘ç«¯çš„æ‰€æœ‰å¤‡ä»½ï¼ˆåŒ…æ‹¬è‡ªåŠ¨ä¿å­˜å’Œæ‰‹åŠ¨å¤‡ä»½ï¼‰ã€‚æ‚¨å¯ä»¥åˆ é™¤æ—§çš„å­˜æ¡£ä»¥é‡Šæ”¾ç©ºé—´ã€‚
                <br><span style="color:red; font-size:11px;">* æ³¨æ„ï¼šåˆ é™¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œã€‚</span>
            </div>
            <div id="dm-cloud-summary" style="background:#f8fafc; border:1px dashed #cbd5e1; border-radius:8px; padding:10px; font-size:12px; color:#475569; margin:10px 0;">
                ğŸ“Œ äº‘ç«¯æ‘˜è¦å°†åœ¨æ­¤æ˜¾ç¤º
            </div>
            <div style="display:flex; gap:12px; align-items:center; font-size:12px; color:#475569; margin-bottom:8px;">
                <label><input type="checkbox" id="cloud-filter-current" checked onchange="DataManager.renderCloudBackups()"> ä»…å½“å‰é¡¹ç›®</label>
                <label><input type="checkbox" id="cloud-filter-snapshots" checked onchange="DataManager.renderCloudBackups()"> æ˜¾ç¤ºå¿«ç…§</label>
            </div>
            <div style="display:flex; gap:8px; align-items:center; font-size:12px; color:#475569; margin-bottom:8px;">
                <span id="cloud-selected-count">å·²é€‰ 0 é¡¹</span>
                <button class="btn btn-sm btn-danger" id="btn-cloud-batch-delete" onclick="DataManager.deleteSelectedCloudBackups()" disabled title="è¯·å…ˆå‹¾é€‰éœ€è¦åˆ é™¤çš„å­˜æ¡£" style="opacity:0.6;">
                    <i class="ti ti-trash"></i> æ‰¹é‡åˆ é™¤
                </button>
            </div>
            <div class="table-wrap" style="flex:1; overflow-y:auto;">
                <table class="comparison-table" id="dm-cloud-table">
                    <thead>
                        <tr>
                            <th style="width:44px; text-align:center;"><input type="checkbox" id="dm-cloud-select-all" onchange="DataManager.toggleCloudSelectAll(this.checked)" title="å…¨é€‰/å–æ¶ˆå…¨é€‰"></th>
                            <th>å­˜æ¡£ Key (é¡¹ç›®å)</th>
                            <th>ä¸Šä¼ æ—¶é—´</th>
                            <th>æ•°æ®å¤§å°</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        
        <div id="dm-history-area" style="display:none; padding:15px; flex-direction:column; height:100%;">
            <div style="background:#f0fdf4; border:1px solid #86efac; padding:15px; border-radius:8px; margin-bottom:15px;">
                <h4 style="margin:0 0 10px 0; color:#166534;"><i class="ti ti-file-import"></i> ä¸Šä¼ å†å²è€ƒè¯•æ•°æ® (ç”¨äºè¿›é€€æ­¥åˆ†æ)</h4>
                <div style="font-size:12px; color:#15803d; line-height:1.6; margin-bottom:10px;">
                    <strong>ğŸ“‚ æ™ºèƒ½è§£æè§„åˆ™ï¼š</strong><br>
                    1. <strong>å¤šæ ¡è¯†åˆ«ï¼š</strong> ç³»ç»Ÿå°†è¯»å– Excel çš„ <span style="background:white; padding:0 4px; border:1px dashed #ccc;">Sheetåç§°</span> ä½œä¸ºå­¦æ ¡åç§°ã€‚<br>
                    2. <strong>åŒ¹é…é”®å€¼ï¼š</strong> å¯¹æ¯”åˆ†æå°†ä¸¥æ ¼åŸºäº <span style="background:white; padding:0 4px; border:1px dashed #ccc;">[ç­çº§] + [å§“å]</span> è¿›è¡Œé”šå®šã€‚<br>
                    3. <strong>åŒ¿åå¤„ç†ï¼š</strong> è‹¥è¡¨æ ¼ä¸­ç¼ºå°‘å§“ååˆ—ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ ‡è®°ä¸ºâ€œæ— åæ°_åºå·â€ï¼Œä»…ä½œæ ¡å†…äººæ•°ç»Ÿè®¡ï¼Œä¸å‚ä¸ä¸ªäººè¿›é€€æ­¥ã€‚<br>
                    4. <strong>å•æ ¡æ¨¡å¼ï¼š</strong> è‹¥ä»…æ£€æµ‹åˆ°ä¸€ä¸ªå­¦æ ¡ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨éšè—â€œå…¨é•‡æ’åâ€åˆ—ï¼Œè½¬ä¸ºæ ¡å†…æ·±åº¦å¯¹æ¯”ã€‚
                </div>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-green" onclick="document.getElementById('dm-history-file').click()">
                        <i class="ti ti-upload"></i> ç‚¹å‡»ä¸Šä¼ å†å² Excel
                    </button>
                    <input type="file" id="dm-history-file" accept=".xlsx,.xls" hidden onchange="DataManager.handleHistoryUpload(this)">
                    <span id="dm-history-status" style="align-self:center; font-size:12px; color:#666;">æš‚æœªä¸Šä¼ </span>
                </div>
            </div>

            <div class="sub-header">ğŸ“Š å†å²å¯¹æ¯”æ•°æ®é¢„è§ˆ</div>
            <div class="table-wrap" style="flex:1; overflow-y:auto;">
                <table id="dm-history-preview-table" style="font-size:12px;">
                    <thead>
                        <tr>
                            <th>å­¦æ ¡ (Sheetå)</th>
                            <th>ç­çº§</th>
                            <th>å§“å</th>
                            <th>ä¸Šæ¬¡æ€»åˆ†</th>
                            <th>ä¸Šæ¬¡æ ¡æ’</th>
                            <th>ä¸Šæ¬¡é•‡æ’</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="6" style="text-align:center; padding:20px; color:#999;">è¯·ä¸Šä¼ æ–‡ä»¶é¢„è§ˆæ•°æ®</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
     
        <!-- åˆ†é¡µæ§ä»¶ (ä»…åœ¨å­¦ç”Ÿ/æ•™å¸ˆ Tab æ˜¾ç¤º) -->
        <div id="dm-pagination" style="padding-top:10px; text-align:right; font-size:12px; color:#666; display:flex; justify-content:flex-end; gap:10px; align-items:center;">
            <button class="btn btn-sm btn-gray" onclick="DataManager.changePage(-1)">ä¸Šä¸€é¡µ</button>
            <span id="dm-page-info">1 / 1</span>
            <button class="btn btn-sm btn-gray" onclick="DataManager.changePage(1)">ä¸‹ä¸€é¡µ</button>
        </div>
    </div>
</div>

<!-- ================== æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–å·¥å…· ================== -->
<script>
    // å…¨å±€æ€§èƒ½ç›‘æ§å·¥å…·
    window.PerformanceMonitor = {
        // è·å–é¡µé¢æ€§èƒ½æ•°æ®
        getMetrics: function() {
            if (!window.performance || !performance.timing) {
                return { error: "æµè§ˆå™¨ä¸æ”¯æŒæ€§èƒ½API" };
            }
            
            const t = performance.timing;
            const metrics = {
                DNSè§£æ: t.domainLookupEnd - t.domainLookupStart,
                TCPè¿æ¥: t.connectEnd - t.connectStart,
                è¯·æ±‚å“åº”: t.responseEnd - t.requestStart,
                DOMè§£æ: t.domComplete - t.domLoading,
                é¡µé¢å®Œå…¨åŠ è½½: t.loadEventEnd - t.navigationStart,
                ç™½å±æ—¶é—´: t.responseStart - t.navigationStart,
                é¦–å±æ—¶é—´: t.domContentLoadedEventEnd - t.navigationStart
            };
            
            return metrics;
        },
        
        // æ‰“å°æ€§èƒ½æŠ¥å‘Š
        report: function() {
            const metrics = this.getMetrics();
            console.group('ğŸ“Š ç³»ç»Ÿæ€§èƒ½æŠ¥å‘Š');
            for (let key in metrics) {
                if (typeof metrics[key] === 'number') {
                    console.log(`${key}: ${metrics[key]}ms`);
                }
            }
            console.groupEnd();
            
            // æ£€æŸ¥å†…å­˜ä½¿ç”¨(ä»…Chrome)
            if (performance.memory) {
                const memory = performance.memory;
                console.log(`ğŸ’¾ å†…å­˜ä½¿ç”¨: ${(memory.usedJSHeapSize / 1048576).toFixed(2)}MB / ${(memory.jsHeapSizeLimit / 1048576).toFixed(2)}MB`);
            }
            
            return metrics;
        },
        
        // ä¼˜åŒ–å»ºè®®
        getSuggestions: function() {
            const metrics = this.getMetrics();
            const suggestions = [];
            
            if (metrics['é¡µé¢å®Œå…¨åŠ è½½'] > 5000) {
                suggestions.push('âš ï¸ é¡µé¢åŠ è½½æ—¶é—´è¶…è¿‡5ç§’ï¼Œå»ºè®®ä¼˜åŒ–ç½‘ç»œæˆ–å‡å°‘å¤–éƒ¨èµ„æº');
            }
            if (metrics['DOMè§£æ'] > 2000) {
                suggestions.push('âš ï¸ DOMè§£æè¾ƒæ…¢ï¼Œè€ƒè™‘å‡å°‘DOMèŠ‚ç‚¹æˆ–å»¶è¿ŸåŠ è½½éå…³é”®å†…å®¹');
            }
            if (performance.memory && performance.memory.usedJSHeapSize > 100 * 1048576) {
                suggestions.push('âš ï¸ å†…å­˜å ç”¨è¾ƒé«˜(>100MB)ï¼Œå»ºè®®å®šæœŸåˆ·æ–°é¡µé¢');
            }
            
            if (suggestions.length === 0) {
                suggestions.push('âœ… ç³»ç»Ÿè¿è¡Œè‰¯å¥½ï¼Œæ— éœ€ä¼˜åŒ–');
            }
            
            return suggestions;
        }
    };
    
    // å†…å­˜æ¸…ç†å·¥å…·
    window.MemoryCleaner = {
        clean: function() {
            console.log('ğŸ§¹ å¼€å§‹æ¸…ç†å†…å­˜...');
            
            // æ¸…ç†å¤§å‹å›¾è¡¨å®ä¾‹
            if (window.Chart && Chart.instances) {
                Object.values(Chart.instances).forEach(chart => {
                    if (chart && typeof chart.destroy === 'function') {
                        chart.destroy();
                    }
                });
                console.log('âœ… å·²æ¸…ç†å›¾è¡¨å®ä¾‹');
            }
            
            console.log('ğŸ’¡ å»ºè®®: åˆ·æ–°é¡µé¢ä»¥å®Œå…¨é‡Šæ”¾å†…å­˜');
            
            if (confirm('æ˜¯å¦åˆ·æ–°é¡µé¢ä»¥å®Œå…¨æ¸…ç†å†…å­˜?')) {
                location.reload();
            }
        }
    };
    
    // å¼€å‘æ¨¡å¼è‡ªåŠ¨æ€§èƒ½æ£€æµ‹
    if (localStorage.getItem('DEV_MODE') === 'true') {
        window.addEventListener('load', () => {
            setTimeout(() => {
                PerformanceMonitor.report();
                PerformanceMonitor.getSuggestions().forEach(s => console.log(s));
            }, 1000);
        });
    }
</script>

</body>
</html>
